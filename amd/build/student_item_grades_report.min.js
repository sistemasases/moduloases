'use strict';define(['jquery','block_ases/ases_jquery_datatable','core/notification','core/templates','block_ases/jquery.dataTables'],function(a,b,c,e){return{init:function init(){a(document).ready(function(){})},load_report:function load_report(f){function g(u){var w={data:u,bsort:0,columns:[{title:'C\xF3digo',name:'codigo_asignatura',data:'codigo_asignatura',description:'Identificador de la asignatura en formato Sede-Codigo-Grupo'},{title:'Nombre Asignatura',name:'nombre_asignatura',data:'nombre_asignatura',description:'Nombre completo de la asignatura'},{title:'Profesor',name:'nombre_profesor',data:'nombre_profesor',description:'Nombre completo de el profesor'},{title:'Notas',name:'notas',data:'notas',description:'Identificador de la asignatura en formato Sede-Codigo-Grupo'},{title:'Nota Final',name:'nota_final',data:'nota_final',description:'Nota final de la asignatura calculada con las categorias de notas terminadas'}],language:b.common_lang_config(),order:0};return w}function h(u,v){var w=[],x;for(x=0;x<v.length;x++)u.includes(v[x])&&w.push(x);return w}function k(u){a(p+' th').each(function(v){a(this).attr('title',u[v].description)})}function l(u,v){var w=u.data(),x=w.mdl_user_id,y='../managers/student_grades/student_item_grades_report_api.php/student_grades/item_summary/'+x;a.ajax({method:'get',url:y}).done(function(z){var A=g(z);u.child('<table id="student_item_grades_explicit'+x+'"></table>').show(),a('#student_item_grades_explicit'+x).DataTable(A),console.log(y)}).fail(function(z){v.removeClass('shown'),console.log(y),console.log(z)})}function m(){a(p+' tbody').on('click','td.details-control',function(){var u=a(this).closest('tr'),v=t.row(u);v.child.isShown()?(v.child.hide(),u.removeClass('shown')):(v.child('<img class="icon-loading" src="../icon/loading.gif"/>').show(),callback=function callback(w,x){x.child(w).show()},l(v,u),u.addClass('shown'))})}var o=function(){function u(v,w,x,y){this.est_items_perdidos=v?v:0,this.cantidad_estudiantes=x?x:0,this.est_mas_items_perdidos_que_ganados=w?w:0,this.est_mas_items_perdidos_que_ganados_porcentaje=y?y:0}return u.prototype.actualizar_porcentaje_est_mas_items_per_que_gan=function(v){var w=v?v:0;this.est_mas_items_perdidos_que_ganados_porcentaje=100*this.est_mas_items_perdidos_que_ganados/this.cantidad_estudiantes,this.est_mas_items_perdidos_que_ganados_porcentaje=this.est_mas_items_perdidos_que_ganados_porcentaje.toFixed(w)},u.return_total_report=function(v){var w=new u;w.cantidad_estudiantes=v.length;for(var x=0;x<v.length;x++)1<=v[x].cantidad_items_perdidos&&w.est_items_perdidos++,v[x].cantidad_items_perdidos>v[x].cantidad_items_ganados&&w.est_mas_items_perdidos_que_ganados++;return w.actualizar_porcentaje_est_mas_items_per_que_gan(),w},u}();a(document).on('click','#tableStudentItemGradesReport tbody tr td',function(){var v=a('#tableStudentItemGradesReport').DataTable(),w=v.cell(this).index().column;1<=w&&4>=w&&(location.href='student_profile.php'+location.search+'&student_code='+v.cell(v.row(this).index(),0).data().codigo)});var p='#tableStudentItemGradesReport';a(p).html('<img class="icon-loading" src="../icon/loading.gif"/>');var q=null,r=f.instance_id,t=null;(function(){a.ajax({method:'GET',url:'../managers/student_grades/student_item_grades_report_api.php/'+r,dataType:'json'}).done(function(u){a(p).html('');var v=o.return_total_report(u.data);e.render('block_ases/student_item_grades_report_summary',{resume_report:v}).then(function(w,x){e.appendNodeContents('.student_item_grades_report .summary',w,x)}).fail(function(){}),console.log(v),t=a(p).DataTable({data:u.data,bsort:u.bsort,columns:u.columns,language:u.language,order:u.order,initComplete:function initComplete(){var w,x}}),k(u.columns),m()}).fail(function(u){console.log(u)})})()}}});