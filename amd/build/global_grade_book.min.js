'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui'],function(a){return{read_only_view_styles:function read_only_view_styles(){a('.category .action-icon').hide(),a('#studentheader > a').bind('click',!1)},init:function init(){function f(o){a.ajax({type:'POST',data:{type:'update_grade_items',course:o},url:'../managers/grade_categories/grader_processing.php',async:!1,success:function success(r){'1'==r?console.log('update ok'):console.log('update fail')},dataType:'text',cache:'false',error:function error(r){console.log(r)}})}function g(o){var p=!1,q=o.val();return 5<q||0>q?(swal({title:'Ingrese un valor valido, entre 0 y 5. \n\rUsted ingres\xF3: '+q,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),o.val(n),p=!1):''==q&&''!=n?(o.val('0'),p=!0):''==q&&''==n||q==n?p=!1:p=!0,p}function h(){a('#user-grades a').removeAttr('href'),a('.cat').each(function(){var o=a(this).children().next('.text');o.attr('disabled',!0),o.css('font-weight','bold')}),a('.course').each(function(){var o=a(this).children().next('.text');o.attr('disabled',!0),o.css('font-weight','bold'),o.css('font-size',16)}),a('.header').children().each(function(){a(this).removeAttr('href')})}function j(o){a('#user-grades').children().children().each(function(){a(this).attr('data-uid')!=void 0&&(k(a(this).attr('data-uid'),o)?a(this).children('th').children().each(function(){a(this).removeAttr('href'),a(this).click(function(){var p=a(this).parent().parent().attr('data-uid'),q=a('#idmoodle_'+p).attr('data-code'),s='student_profile.php'+location.search+'&student_code='+q})}):a(this).remove())})}function k(o,p){for(var q=0;q<p.length;q++)if(p[q].split('_')[1]===o)return!0;return!1}function l(){var o=[];return a('#students-pilos').children().each(function(){o.push(a(this).attr('id'))}),o}function m(){for(var q,o=window.location.search.split('&'),p=0;p<o.length;p++)if(q=o[p].split('='),'?id_course'==q[0]||'id_course'==q[0]){var r=q[1];return r}}var n;a(document).ready(function(){var o=l();if(j(o),h(),0!=a('.gradingerror').length){location.origin+'/moodle/grade/report/grader/index.php?id='+m();swal({title:'Recalculando \xEDtems.',text:'Debido al proceso de actualizaci\xF3n del campus virtual se debe realizar este paso.\nGracias por su paciencia \nDe seguir presentando este problema, por favor dirigirse al area de sistemas Ases',type:'warning',showCancelButton:!1,confirmButtonClass:'btn-danger',confirmButtonText:'Continuar',closeOnConfirm:!1},function(){f(m()),location.reload()})}}),a(document).on('blur','.text',function(){if(g(a(this))){var o=a(this).attr('id').split('_'),p=o[1],q=o[2],r=a(this).val(),s=m();a.ajax({type:'POST',data:{user:p,item:q,finalgrade:r,course:s},url:'../managers/grade_categories/grader_processing.php',async:!1,success:function success(u){var v=u.nota;if(!0!=v)swal('Error','Error al actualizar la nota','error');else if(console.log('Nota actualizada'),3>r){var w=u.monitor,x=u.practicante,y=u.profesional;!0==w?console.log('mensaje al monitor enviado correctamente'):(console.log('error monitor'),swal('Error','Error al enviar correo al monitor','error')),!0==x?console.log('mensaje al practicante enviado correctamente'):(console.log('error practicante'),swal('Error','Error al enviar correo al practicante','error')),!0==y?console.log('mensaje al profesional enviado correctamente'):(console.log('error profesional'),swal('Error','Error al enviar correo al profesional','error'))}},dataType:'json',cache:'false',error:function error(u){console.log(u)}})}}),a(document).on('focus','.text',function(){n=a(this).val()}),a(document).on('keypress','.text',function(o){var p=document.all?o.keyCode:o.which;return 8==p||46==p||(patron=/[0-9]/,tecla_final=String.fromCharCode(p),patron.test(tecla_final))}),a(document).on('click','.reload',function(){location.reload()})}}});