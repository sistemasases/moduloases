define(['jquery','block_ases/bootstrap','block_ases/d3','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2','block_ases/Chart'],function(e,a,t,o,r,s,n){function l(O){for(O=O.toLowerCase(),i=0;i<O.length;i++)if(-1!='abcdefghyjklmn\xF1opqrstuvwxyz'.indexOf(O.charAt(i),0))return 1;return 0}function d(O){for(i=0;i<O.length;i++)if(-1!='0123456789'.indexOf(O.charAt(i),0))return 1;return 0}function c(O){var z=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return z.test(O)?1:0}function v(){var O=e('#modal_dropout'),z=e('.mymodal-close'),j=e('#goback_backdrop');j.on('click',function(){O.hide()}),z.on('click',function(){O.hide()})}function h(){var O=e('#modal_peer_tracking'),z=e('.mymodal-close'),j=e('#cancel_peer_tracking');j.on('click',function(){O.hide()}),z.on('click',function(){O.hide()});var P=e('.panel-heading.heading_semester_tracking');P.on('click',function(){'collapsed'==e(this).parent().attr('class')?(e('h4>span',this).removeClass('glyphicon-chevron-left'),e('h4>span',this).addClass('glyphicon-chevron-down')):(e('h4>span',this).removeClass('glyphicon-chevron-down'),e('h4>span',this).addClass('glyphicon-chevron-left'))})}function f(){var O=e('#modal_risk_span'),z=e('#modal_risk_close');O.on('click',function(){e('#modal_risk_graph').hide()}),z.on('click',function(){e('#modal_risk_graph').hide()})}function k(){e('#date').datepicker({dateFormat:'yy-mm-dd'});for(var O=new Date,z=O.getDate(),j=O.getMonth()+1,P=O.getFullYear(),L=O.getMinutes(),M=O.getHours(),q='',N=0;24>N;N++)N==M?(10>M&&(M='0'+M),q+='<option value="'+M+'" selected>'+M+'</option>'):q+=10>N?'<option value="0'+N+'">0'+N+'</option>':'<option value="'+N+'">'+N+'</option>';for(var V='',N=0;60>N;N++)N==L?(10>L&&(L='0'+L),V+='<option value="'+L+'" selected>'+L+'</option>'):V+=10>N?'<option value="0'+N+'">0'+N+'</option>':'<option value="'+N+'">'+N+'</option>';e('#h_ini').append(q),e('#m_ini').append(V),e('#h_fin').append(q),e('#m_fin').append(V),e('#infomonitor').addClass('hide'),e('#seguimiento').find('input:text, textarea').val(''),e('#seguimiento').find('input:radio,input:checkbox').prop('checked',!1),e('#upd_seg').attr('disabled',!1),e('#upd_seg').attr('title',''),e('#seguimiento').find('select, textarea, input').attr('disabled',!1),e('#no_value_individual').hide(),e('#no_value_familiar').hide(),e('#no_value_academic').hide(),e('#no_value_economic').hide(),e('#no_value_life').hide(),e('#id_tracking_peer').val(''),e('#place').val(''),e('#topic_textarea').val(''),e('#objetivos').val(''),e('#individual').val(''),e('#familiar').val(''),e('#academico').val(''),e('#economico').val(''),e('#vida_uni').val(''),e('#observaciones').val(''),e('#no_value_individual').prop('checked',!0),e('#no_value_familiar').prop('checked',!0),e('#no_value_academic').prop('checked',!0),e('#no_value_economic').prop('checked',!0),e('#no_value_life').prop('checked',!0)}function b(){var O=e('#tracking_peer_form'),z=e('#modal_peer_tracking'),j=O.serializeArray(),P=E(document.location.search),L=y(j);if('success'!=L)swal({title:'Advertencia',text:L,type:'warning',html:!0});else{j.push({name:'func',value:'save_tracking_peer'});var M=e('#id_ases').val();j.push({name:'id_ases',value:M}),j.push({name:'id_instance',value:P.instanceid}),e.ajax({type:'POST',data:j,url:'../../ases/managers/student_profile/studentprofile_serverproc.php',success:function success(q){swal({title:q.title,text:q.msg,type:q.type},function(){z.hide();var N=E(document.location.search);N.tab?location.reload():location.href=location.search+'&tab=socioed_tab'})},dataType:'json',cache:'false',error:function error(q){console.log(q)}})}}function y(O){var z=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/,j=z.exec(O[1].value);return''==O[1].value?'Debe introducir la fecha en la cual se realiz\xF3 el seguimiento':null===j?'La fecha no sigue el patr\xF3n yyyy-mm-dd. Ejemplo 2017-10-13':''==O[2].value?'Debe introducir el lugar donde se realiz\xF3 el seguimiento':''==O[7].value?'El campo tema se encuentra vacio':''==O[8].value?'El campo objetivos se encuentra vacio':parseInt(O[5].value)<parseInt(O[3].value)?'La hora de finalizaci\xF3n debe ser mayor a la hora inicial':parseInt(O[3].value)==parseInt(O[5].value)&&parseInt(O[6].value)<=parseInt(O[4].value)?'La hora de finalizaci\xF3n debe ser mayor a la hora inicial':''!=O[9].value&&0==O[10].value?'El riesgo asociado al campo Actividad Invidual no est\xE1 marcado. Si usted escribi\xF3 informaci\xF3n en el campo Actividad Individual debe marcar un nivel de riesgo.':''!=O[11].value&&0==O[12].value?'El riesgo asociado al campo Actividad Familiar no est\xE1 marcado. Si usted escribi\xF3 informaci\xF3n en el campo Actividad Familiar debe marcar un nivel de riesgo.':''!=O[13].value&&0==O[14].value?'El riesgo asociado al campo Actividad Acad\xE9mico no est\xE1 marcado. Si usted escribi\xF3 informaci\xF3n en el campo Actividad Acad\xE9mico debe marcar un nivel de riesgo.':''!=O[15].value&&0==O[16].value?'El riesgo asociado al campo Actividad Econ\xF3mico no est\xE1 marcado. Si usted escribi\xF3 informaci\xF3n en el campo Actividad Econ\xF3mico debe marcar un nivel de riesgo.':''!=O[17].value&&0==O[18].value?'El riesgo asociado al campo Actividad Vida Universitaria no est\xE1 marcado. Si usted escribi\xF3 informaci\xF3n en el campo Actividad Vida Universitaria debe marcar un nivel de riesgo.':''==O[9].value&&0!=O[10].value?'Usted ha marcado el nivel de riesgo asociado a la actividad Individual, debe digitar informaci\xF3n en el campo Actividad Individual. O puede utilizar el icono (<span style=\'color:gray;\' class=\'glyphicon glyphicon-erase\'></span>) de limpiar riesgo.':''==O[11].value&&0!=O[12].value?'Usted ha marcado el nivel de riesgo asociado a la actividad Familiar, debe digitar informaci\xF3n en el campo Actividad Familiar. O puede utilizar el icono (<span style=\'color:gray;\' class=\'glyphicon glyphicon-erase\'></span>) de limpiar riesgo.':''==O[13].value&&0!=O[14].value?'Usted ha marcado el nivel de riesgo asociado a la actividad Acad\xE9mico, debe digitar informaci\xF3n en el campo Actividad Acad\xE9mico. O puede utilizar el icono (<span style=\'color:gray;\' class=\'glyphicon glyphicon-erase\'></span>) de limpiar riesgo.':''==O[15].value&&0!=O[16].value?'Usted ha marcado el nivel de riesgo asociado a la actividad Econ\xF3mico, debe digitar informaci\xF3n en el campo Actividad Econ\xF3mico. O puede utilizar el icono (<span style=\'color:gray;\' class=\'glyphicon glyphicon-erase\'></span>) de limpiar riesgo.':''==O[17].value&&0!=O[18].value?'Usted ha marcado el nivel de riesgo asociado a la actividad Vida Universitaria, debe digitar informaci\xF3n en el campo Actividad Vida Universitaria. O puede utilizar el icono (<span style=\'color:gray;\' class=\'glyphicon glyphicon-erase\'></span>) de limpiar riesgo.':'success'}function E(){for(var M,z=[],j=document.location.search.substring(1),P=j.split('&'),L=0;L<P.length;L++)M=P[L].split('='),z[M[0]]=M[1];return z}function x(O){k();var z=new Date(e('#'+O+' .date_tracking_peer').text()),j=e('#'+O+' .place_tracking_peer').text(),P=e('#'+O+' .init_time_tracking_peer').text(),L=e('#'+O+' .ending_time_tracking_peer').text(),M=e('#'+O+' .topic_tracking_peer').text(),q=e('#'+O+' .objectives_tracking_peer').text(),N=e('#'+O+' .individual_tracking_peer').text(),V=e('#'+O+' .ind_risk_tracking_peer').text(),R=e('#'+O+' .familiar_tracking_peer').text(),D=e('#'+O+' .fam_risk_tracking_peer').text(),U=e('#'+O+' .academico_tracking_peer').text(),F=e('#'+O+' .aca_risk_tracking_peer').text(),G=e('#'+O+' .economico_tracking_peer').text(),H=e('#'+O+' .econ_risk_tracking_peer').text(),Y=e('#'+O+' .lifeu_tracking_peer').text(),K=e('#'+O+' .lifeu_risk_tracking_peer').text(),W=e('#'+O+' .observations_tracking_peer').text(),Z={};Z.bajo=1,Z.medio=2,Z.alto=3;var Q=z.getFullYear(),X=z.getMonth()+1;Q+=10>z.getMonth()?'-0'+X:'-'+X,Q+=10>z.getDate()?'-0'+z.getDate():'-'+z.getDate();var J=P.substring(0,2),ee=P.substring(3,5),ae=L.substring(0,2),te=L.substring(3,5);e('#h_ini option[value="'+J+'"]').attr('selected',!0),e('#m_ini option[value="'+ee+'"]').attr('selected',!0),e('#h_fin option[value="'+ae+'"]').attr('selected',!0),e('#m_fin option[value="'+te+'"]').attr('selected',!0);var ie=Z[V.toLowerCase()],oe=Z[D.toLowerCase()],re=Z[H.toLowerCase()],se=Z[F.toLowerCase()],ne=Z[K.toLowerCase()];''==V?e('input[name=\'riesgo_ind\'][value=\'0\']').prop('checked',!0):e('input[name=\'riesgo_ind\'][value=\''+ie+'\']').prop('checked',!0),''==D?e('input[name=\'riesgo_familiar\'][value=\'0\']').prop('checked',!0):e('input[name=\'riesgo_familiar\'][value=\''+oe+'\']').prop('checked',!0),''==H?e('input[name=\'riesgo_econom\'][value=\'0\']').prop('checked',!0):e('input[name=\'riesgo_econom\'][value=\''+re+'\']').prop('checked',!0),''==F?e('input[name=\'riesgo_aca\'][value=\'0\']').prop('checked',!0):e('input[name=\'riesgo_aca\'][value=\''+se+'\']').prop('checked',!0),''==K?e('input[name=\'riesgo_uni\'][value=\'0\']').prop('checked',!0):e('input[name=\'riesgo_uni\'][value=\''+ne+'\']').prop('checked',!0),e('#date').val(Q),e('#place').val(j),e('#topic_textarea').val(M),e('#objetivos').val(q),e('#individual').val(N),e('#familiar').val(R),e('#academico').val(U),e('#economico').val(G),e('#vida_uni').val(Y),e('#observaciones').val(W),e('#id_tracking_peer').val(O);var le=e('#modal_peer_tracking');le.show()}function w(O){e.ajax({type:'POST',data:{func:'delete_tracking_peer',id_tracking:O},url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(z){swal(z.title,z.msg,z.status);var j=E(document.location.search);j.tab?location.reload():location.href=location.search+'&tab=socioed_tab'},dataType:'json',cache:'false',error:function error(z){swal(z.title,z.msg,z.status)}})}function T(O){e.ajax({type:'POST',data:{func:'is_student',code_student:O},url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(z){if('1'==z){var j=E(document.location.search),P=document.location+'',L=P.split('?'),M=L[0]+'?courseid='+j.courseid+'&instanceid='+j.instanceid+'&student_code='+O;location.href=M}else swal('Error','No se encuentra un estudiante asociado al c\xF3digo ingresado','error')},dataType:'text',cache:'false',error:function error(){swal('Error','Error al comunicarse con el servidor, por favor intentelo nuevamente.','error')}})}function B(){for(var O=0;O<Object.keys(datos.informacion).length;O++){var z=[],j,P=[],L=[],M=[];j=datos.informacion[O].dimension;for(var q=0;'false'==datos.informacion[O].datos[q].end;)P.push(datos.informacion[O].datos[q].fecha),L.push(datos.informacion[O].datos[q].color),M.push(datos.informacion[O].datos[q].riesgo),++q;z.push(j),z.push(P),z.push(L),z.push(M),datosGraficables.push(z)}}function S(){B();var O=I(datosGraficables[0],ctx_individual),z=I(datosGraficables[1],ctx_familiar),j=I(datosGraficables[2],ctx_academico),P=I(datosGraficables[3],ctx_economico),L=I(datosGraficables[4],ctx_vida_universitaria)}function I(O,z){return new n(z,{type:'line',data:{labels:O[1],datasets:[{label:'Nivel de riesgo',fill:!1,lineTension:0,pointBackgroundColor:O[2],data:O[3],backgroundColor:'black',borderColor:'black',borderWidth:3,pointRadius:5,pointHoverRadius:7}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,max:3,min:0}}]}}})}return{init:function init(O){e('#cohorts_table tbody').find('td').each(function(){if(-1!=e(this).text().indexOf('Condici\xF3n de Excepci\xF3n')){var G=e('#cond_excepcion_alias').text().trim(),H=e('#cond_excepcion_name').text().trim();e(this).append('-'),e(this).append(G),e(this).attr('title',H)}});var z=document.getElementById('municipio_act').value,j=e('#latitude').val(),P=e('#longitude').val();document.getElementById('mapa').innerHTML=1079==z?'<iframe class=\'col-xs-12 col-sm-12 col-md-12 col-lg-12\' height=\'396\' frameborder=\'0\' style=\'border:0\' src=\'https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin='+j+','+P+'&destination=3.3759493,-76.5355789&mode=transit\'></iframe>':'<iframe class=\'col-xs-12 col-sm-12 col-md-12 col-lg-12\' height=\'396\' frameborder=\'0\' style=\'border:0\' src=\'https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin='+j+','+P+'&destination=3.3759493,-76.5355789&mode=driving\'></iframe>',e(document).on('click','#table_vive_con tbody tr td button',function(){e(this).parent().parent().remove()}),e('#input_button_add_person').click(function(){var G='';G+='<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td>',G+='<td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td>',G+='<td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>',e('#table_vive_con').find('tbody').append(G)}),e('[data-toggle="tooltip"]').tooltip();var L=E(document.location.search),M=e('.panel-collapse.collapse.in'),q=this;e('#asignados').select2({width:'resolve',height:'resolve',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),e('#asignados').on('change',function(){var G=e('#asignados').val(),H=G.split(' ')[0];T(H)});for(var N=0,V=O.length;N<V;N++)e('#select-'+O[N].academic_program_id+' option[value='+O[N].program_status+']').attr('selected',!0),'1'==O[N].program_status&&e('#tr-'+O[N].id_moodle_user).addClass('is-active'),'1'==O[N].tracking_status&&e('#div_flags_'+O[N].academic_program_id).prop('checked',!0);var R='',D=e('#div_cohorts').height();e('#div-icon-edit').height(D),this.edit_profile(q),e('div.slider.round').click(function(G){R=G.target.parentElement.children[0].checked}),e('.input-tracking').on('change',{current_tracking_status:R},function(){q.update_tracking_status(R,e(this),O,q)});var U='';switch(e('.select_statuses_program').on('focus',function(G){U=G.target.value}),e('.select_statuses_program').on('change',{current_status:U},function(){q.update_status_program(U,e(this))}),e('#icon-tracking').on('click',function(){q.update_status_ases(L)}),L.tab){case'socioed_tab':e('#general_li').removeClass('active'),e('#socioed_li').addClass('active'),e('#general_tab').removeClass('active'),e('#socioed_tab').addClass('active'),M.removeClass('in'),e('#collapseOne').addClass('in');break;default:M.removeClass('in');}var F=e('#modal_peer_tracking');v(),h(),f(),e('#button_add_track').on('click',function(){e('#save_seg').removeClass('hide'),e('#div_created').addClass('hide'),e('#upd_seg').addClass('hide'),e('#myModalLabel').attr('name','PARES'),F.show(),k()}),e('#view_form_update_profile_image').on('click',function(){e('#profile_image_update').show()}),e('#send-profile-image').on('click',function(){var G=new FormData;G.append('mdl_user_id',e('#id_moodle').val()),G.append('new_image_file',document.getElementById('profile-image-input').files[0]),G.append('func','update_user_image'),e.ajax({url:'../managers/student_profile/studentprofile_serverproc.php',data:G,cache:!1,contentType:!1,processData:!1,method:'POST',type:'POST',success:function success(H){alert(H)},error:function error(H){console.log(H)}}),console.log(G)}),e('#save_tracking_btn').on('click',function(){b()}),e('fieldset').removeClass('hidden'),e('#clean_individual_risk').on('click',function(){e('#no_value_individual').prop('checked',!0)}),e('#clean_familiar_risk').on('click',function(){e('#no_value_familiar').prop('checked',!0)}),e('#clean_academic_risk').on('click',function(){e('#no_value_academic').prop('checked',!0)}),e('#clean_economic_risk').on('click',function(){e('#no_value_economic').prop('checked',!0)}),e('#clean_life_risk').on('click',function(){e('#no_value_life').prop('checked',!0)}),e('.btn-primary.edit_peer_tracking').on('click',function(){var G=e(this).attr('id'),H=G.substring(14);x(H)}),e('.btn-danger.delete_peer_tracking').on('click',function(){var G=e(this).attr('id'),H=G.substring(21);swal({title:'Advertencia',text:'\xBFEst\xE1 seguro(a) que desea borrar este seguimiento?',type:'warning',showCancelButton:!0,confirmButtonText:'Si',cancelButtonText:'No',closeOnConfirm:!1},function(Y){Y&&w(H)})}),e('#view_graph_radial_button').on('click',function(){q.graph_radial()}),e('#view_graphic_risk_button').click(function(){e('#modal_riesgos').fadeIn(200),S()}),e('#mymodal-riesgo-close').click(function(){e('#modal_riesgos').fadeOut(200)})},equalize:function equalize(){e(document).ready(function(){0==document.getElementById('genero').value&&(e('#lb_otro').show(),e('#div_otro_genero').show()),0==document.getElementById('act_simultanea').value&&(e('#lb_otro_act').show(),e('#div_otro_act').show());var O=e('.equalize').map(function(){return e(this).height()}).get(),z=Math.max.apply(null,O);e('.equalize').height(z)})},update_status_program:function update_status_program(O,z){var j=z.attr('id').split('-')[1],P=z.val(),L=z.parent().parent().attr('id').split('-')[1],M={func:'update_status_program',program_id:j,status:P,student_id:L};swal({title:'Advertencia',text:'\xBFEst\xE1 seguro que desea cambiar el estado del programa?',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Si',cancelButtonText:'No',closeOnConfirm:!1},function(q){q?e.ajax({type:'POST',data:M,url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(N){'ACTIVO'==e('#select-'+M.program_id).val()?e('#tr-'+M.student_id).addClass('is-active'):e('#tr-'+M.student_id).removeClass('is-active'),swal(N.title,N.msg,N.status)},dataType:'json',cache:'false',error:function error(N){swal(N.title,N.msg,N.status)}}):e('#select-'+M.program_id).val(O)})},update_status_ases:function update_status_ases(O){var z=e('#input_status_ases').val(),j;switch(z){case'seguimiento':j='sinseguimiento';break;case'sinseguimiento':j='seguimiento';break;case'noasignado':j='seguimiento';break;default:}if('sinseguimiento'==z)swal('Advertencia','No es posible realizar esta acci\xF3n. Al estudiante se le realiza seguimiento desde otra instancia.','warning');else{var P={func:'update_status_ases',current_status:z,new_status:j,instance_id:O.instanceid,code_student:O.student_code};swal({title:'Advertencia',text:'\xBFEst\xE1 seguro que desea cambiar el estado de seguimiento del estudiante en esta instancia? El estado pasar\xE1 de \''+z+'\' a \''+j+'\'',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Si',cancelButtonText:'No'},function(L){L&&('sinseguimiento'==j?(modal_dropout=e('#modal_dropout'),modal_dropout.show(),e('#save_changes_dropout').on('click',function(){P.id_reason_dropout=e('#reasons_select').val(),P.observation=e('#description_dropout').val(),e.ajax({type:'POST',data:P,url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(M){z=j,e('#input_status_ases').val(j),'seguimiento'==M.previous_status?(e('#icon-tracking').removeClass('i-tracking-t'),e('#icon-tracking').addClass('i-tracking-n'),e('#tip_ases_status').html('Se realiza seguimiento en otra instancia')):'sinseguimiento'==M.previous_status?(e('#icon-tracking').removeClass('i-tracking-f'),e('#icon-tracking').addClass('i-tracking-t'),e('#tip_ases_status').html('Se realiza seguimiento en esta instancia')):''==M.previous_status&&(e('#icon-tracking').removeClass('i-tracking-n'),e('#icon-tracking').addClass('i-tracking-t'),e('#tip_ases_status').html('No se realiza seguimiento')),modal_dropout.hide(),swal(M.title,M.msg,M.status)},dataType:'json',cache:'false',error:function error(M){modal_dropout.hide(),swal(M.title,M.msg,M.status)}})})):'seguimiento'==j&&e.ajax({type:'POST',data:P,url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(M){z=j,e('#input_status_ases').val(j),'seguimiento'==M.previous_status?(e('#icon-tracking').removeClass('i-tracking-t'),e('#icon-tracking').addClass('i-tracking-n'),e('#tip_ases_status').html('Se realiza seguimiento en otra instancia')):'sinseguimiento'==M.previous_status?(e('#icon-tracking').removeClass('i-tracking-f'),e('#icon-tracking').addClass('i-tracking-t'),e('#tip_ases_status').html('Se realiza seguimiento en esta instancia')):''==M.previous_status&&(e('#icon-tracking').removeClass('i-tracking-n'),e('#icon-tracking').addClass('i-tracking-t'),e('#tip_ases_status').html('Se realiza seguimiento en esta instancia'))},dataType:'json',cache:'false',error:function error(M){console.log(M)}}).then(function(M){swal(M.title,M.msg,M.status)}))})}},update_tracking_status:function update_tracking_status(O,z,j,P){has_tracking_status=!1,!1==O?(has_tracking_status=P.validate_tracking_statuses(j),has_tracking_status.tracking_status&&swal({title:'\xBFEst\xE1 seguro/a de cambiar el estado?',text:'Se alternar\xE1 el perfil de Moodle asociado al estudiante al cual se el realiza seguimiento',type:'warning',showCancelButton:!0,confirmButtonColor:'#d51b23',confirmButtonText:'Si',cancelButtonText:'No',closeOnConfirm:!0,allowEscapeKey:!1},function(L){if(L){e('.input-tracking').prop('checked',!1),z.prop('checked',!0);var M=e('#id_ases').val(),q=z[0].id;q=q.split('_')[2],e.ajax({type:'POST',data:{func:'update_tracking_status',id_ases_student:M,id_academic_program:q},url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(N){setTimeout(function(){swal(N.title,N.msg,N.status)},100)},dataType:'json',cache:'false',error:function error(N){setTimeout(function(){swal(N.title,N.msg,N.status)},100)}})}else O?z.prop('checked',!0):z.prop('checked',!1)})):z.prop('checked',!0)},validate_tracking_statuses:function validate_tracking_statuses(O){for(has_tracking_status=!1,i=0;i<O.length;i++)if(1==O[i].tracking_status){has_tracking_status=!0;break}return O[i]},get_url_parameters:function get_url_parameters(){for(var M,z=[],j=document.location.search.substring(1),P=j.split('&'),L=0;L<P.length;L++)M=P[L].split('='),z[M[0]]=M[1];return z},graph_radial:function graph_radial(){var O=document.getElementById('canvas_radial_graph').getContext('2d'),z,j,P,L,M;z=0==e('#individual_risk').attr('data-risk-level')?4:e('#individual_risk').attr('data-risk-level'),j=0==e('#familiar_risk').attr('data-risk-level')?4:e('#familiar_risk').attr('data-risk-level'),P=0==e('#academic_risk').attr('data-risk-level')?4:e('#academic_risk').attr('data-risk-level'),L=0==e('#economic_risk').attr('data-risk-level')?4:e('#economic_risk').attr('data-risk-level'),M=0==e('#life_risk').attr('data-risk-level')?4:e('#life_risk').attr('data-risk-level'),e('#modal_radial_graph').fadeIn(200);var q={labels:['Individual','Familiar','Acad\xE9mico','Econ\xF3mico','Vida universitaria'],datasets:[{data:[4-z,4-j,4-P,4-L,4-M],backgroundColor:'rgba(255, 99, 132, 0.4)',borderColor:['rgba(255,99,132,1)'],borderWidth:2,fontsize:12}]},V=new n(O,{type:'radar',data:q,options:{scale:{ticks:{beginAtZero:!0,min:0,max:3,stepSize:1,display:!1},pointLabels:{fontSize:12},scaleLabel:{fontsize:10}},legend:{display:!1}}})},edit_profile:function edit_profile(O){var z=e('#ficha_estudiante').serializeArray(),j=document.getElementById('otro_genero').value,P=document.getElementById('otro_act_simultanea').value,L;e('#span-icon-edit').on('click',function(){e(this).hide(),e('#tip-edit').hide(),e('#span-icon-save-profile').show(),e('#tip-save').show(),e('#span-icon-cancel-edit').show(),e('#tip-cancel').show(),e('#tipo_doc').prop('disabled',!1),e('#num_doc').prop('readonly',!1),e('#icetex_status').prop('disabled',!1),e('#pais').prop('disabled',!1),e('#genero').prop('disabled',!1),e('#cond_excepcion').prop('disabled',!1),e('#act_simultanea').prop('disabled',!1),e('#etnia').prop('disabled',!1),e('#municipio_act').prop('disabled',!1),e('#otro_act_simultanea').prop('disabled',!1),e('#otro_genero').prop('disabled',!1),e('#otro_genero').prop('required',!1),e('#otro_act_simultanea').prop('required',!1),e('#estado_civil').prop('disabled',!1),e('#observacion').prop('readonly',!1),e('.select_statuses_program').prop('disabled',!1),e('.input_fields_general_tab').prop('readonly',!1),e('.bt_delete_person').css('visibility','visible'),e('.input-tracking').prop('disabled',!1),e('#div_add_persona_vive').show(),e('#edit_person_vive').show(),document.getElementById('mapa').innerHTML='';var M=e('#latitude').val(),q=e('#longitude').val(),N=e('#id_ases').val(),V=e('#select_neighborhood').val(),R=e('#select_geographic_risk').val(),D,U,G=new google.maps.LatLng(3.3759493,-76.5355789),D=new google.maps.Map(document.getElementById('mapa'),{center:G,zoom:14}),Y=new google.maps.Marker({position:{lat:3.3759493,lng:-76.5355789},map:D,title:'Universidad del Valle'}),K=new google.maps.InfoWindow;K.setContent('Universidad del Valle'),K.open(D,Y),L=new google.maps.Marker({position:{lat:parseFloat(M),lng:parseFloat(q)},map:D}),U=new google.maps.Geocoder,infowindow=new google.maps.InfoWindow,infowindow.setContent('Residencia Estudiante'),infowindow.open(D,L),google.maps.event.addListener(D,'click',function(W){U.geocode({latLng:W.latLng},function(Z,Q){Q==google.maps.GeocoderStatus.OK?Z[0]?(L?L.setPosition(W.latLng):L=new google.maps.Marker({position:W.latLng,map:D}),infowindow.setContent(Z[0].formatted_address+'<br/> Coordenadas: '+Z[0].geometry.location),infowindow.open(D,L)):console.log('No se encontraron resultados'):console.log('Geocodificaci\xF3n  ha fallado debido a: '+Q)})}),e('#genero').on('click',function(){0==document.getElementById('genero').value?(e('#div_otro_genero').show(),e('#lb_otro').show(),e('#otro_genero').prop('required',!0)):(e('#div_otro_genero').hide(),e('#lb_otro').hide(),e('#otro_genero').prop('required',!1))}),e('#act_simultanea').on('click',function(){0==document.getElementById('act_simultanea').value?(e('#div_otro_act').show(),e('#lb_otro_act').show(),e('#otro_act_simultanea').prop('required',!0)):(e('#div_otro_act').hide(),e('#lb_otro_act').hide(),e('#otro_act_simultanea').prop('required',!1))})}),e('#span-icon-cancel-edit').on('click',{form:z},function(M){swal({title:'\xBFDesea cancelar la edici\xF3n?',text:'Los cambios no guardados se perder\xE1n',type:'warning',showCancelButton:!0,confirmButtonColor:'#d51b23',confirmButtonText:'Si',cancelButtonText:'No',closeOnConfirm:!0,allowEscapeKey:!1},function(q){q&&(O.cancel_edition(),O.revert_changes(M.data.form))})}),e('#span-icon-save-profile').on('click',function(){var M=e('#ficha_estudiante').serializeArray(),q=O.validate_form(M);if('error'==q.status)swal(q.title,q.msg,q.status);else{var N=[],V,R=[],D=[];e('.table_vive_con td').find(':input').each(function(){'name_person'==e(this).attr('name')&&R.push(e(this).val()),'parentesco_person'==e(this).attr('name')&&D.push(e(this).val())});for(var U=0;U<R.length;U++)V={name:R[U],parentesco:D[U]},N.push(V);N=JSON.stringify(N),O.save_form_edit_profile(M,O,j,P,N,L),e('#otro_genero').prop('disabled',!0),e('#otro_act_simultanea').prop('disabled',!0),e('#otro_genero').prop('required',!1),e('#otro_act_simultanea').prop('required',!1)}})},validate_form:function validate_form(O){for(field in O){var z={};switch(z.title='\xC9xito',z.msg='El formulario fue validado con \xE9xito',z.status='success',O[field].name){case'estrato':if(0>O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe ser negativo',z;if(6<O[field].value)return z.title='Error',z.status='error',z.msg='El campo a\xF1o de '+O[field].name+' no debe ser mayor al permitido',z;if(l(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener letras',z;break;case'ingreso':if(0>O[field].value)return z.title='Error',z.status='error',z.msg='El campo a\xF1o de '+O[field].name+' no debe ser negativo',z;var j=new Date,P=j.getFullYear();if(O[field].value>P)return z.title='Error',z.status='error',z.msg='El campo a\xF1o de '+O[field].name+' no debe ser mayor al actual',z;if(l(O[field].value))return z.title='Error',z.status='error',z.msg='El campo a\xF1o de '+O[field].name+' no debe contener letras',z;break;case'puntaje_icfes':if(0>O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe ser negativo',z;if(500<O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe ser mayor al permitido',z;if(l(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener letras',z;break;case'hijos':if(''==O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' es obligatorio',z;if(0>O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe ser negativo',z;if(l(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener letras',z;break;case'name_person':if(''==O[field].value)return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' es obligatorio',z;if(d(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener n\xFAmeros',z;break;case'otro_genero':if(''==document.getElementById('otro_genero').value&&e('#otro_genero').attr('required'))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' es obligatorio',z;if(d(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener n\xFAmeros',z;break;case'otro_act_simultanea':if(''==document.getElementById('otro_act_simultanea').value&&e('#otro_act_simultanea').attr('required'))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' es obligatorio',z;if(d(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no debe contener n\xFAmeros',z;break;case'num_doc':case'tel_res':case'celular':case'tel_acudiente':if(l(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' solo debe contener n\xFAmeros',z;;break;case'emailpilos':if(console.log(c(O[field].value)),!c(O[field].value))return z.title='Error',z.status='error',z.msg='El campo '+O[field].name+' no tiene el formato de un correo electr\xF3nico',z;;}}return z},save_form_edit_profile:function save_form_edit_profile(O,z,j,P,L,M){function N(H){var Y,K;null==H?(Y=M.getPosition().lat(),K=M.getPosition().lng()):(Y=H.geometry.location.lat(),K=H.geometry.location.lng());var W=e('#id_ases').val(),Z=e('#select_neighborhood').val(),Q=e('#select_geographic_risk').val(),X=document.getElementById('municipio_act').value,J=new google.maps.DirectionsService,ee;1079==X?(document.getElementById('mapa').innerHTML='<iframe class=\'col-xs-12 col-sm-12 col-md-12 col-lg-12\' height=\'396\' frameborder=\'0\' style=\'border:0\' src=\'https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin='+Y+','+K+'&destination=3.3759493,-76.5355789&mode=transit\' allowfullscreen></iframe>',ee={origin:{lat:Y,lng:K},destination:{lat:3.3759493,lng:-76.5355789},travelMode:'TRANSIT'}):(document.getElementById('mapa').innerHTML='<iframe class=\'col-xs-12 col-sm-12 col-md-12 col-lg-12\' height=\'396\' frameborder=\'0\' style=\'border:0\' src=\'https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin='+Y+','+K+'&destination=3.3759493,-76.5355789&mode=driving\' allowfullscreen></iframe>',ee={origin:{lat:Y,lng:K},destination:{lat:3.3759493,lng:-76.5355789},travelMode:'DRIVING'}),J.route(ee,function(ae){var ie=ae.routes[0].legs[0].distance.value,oe=ae.routes[0].legs[0].duration.value;e.ajax({type:'POST',data:{func:'save_geographic_info',id_ases:W,latitude:Y,longitude:K,neighborhood:Z,geographic_risk:Q,duration:oe,distance:ie},url:'../managers/student_profile/geographic_serverproc.php',success:function success(re){console.log(re)},dataType:'json',cache:'false',error:function error(re){console.log(re)}})})}e.ajax({type:'POST',data:{func:'save_profile',form:O,option1:j,option2:P,vive_con:L},url:'../managers/student_profile/studentprofile_serverproc.php',success:function success(H){swal(H.title,H.msg,H.status)},dataType:'json',cache:'false',error:function error(H){swal(H.title,H.msg,H.status)}});var V=document.getElementById('municipio_act'),R=V.options[V.selectedIndex].text,D=document.getElementById('direccion_res').value,U=D+' '+R;console.log('Query: '+U);var G=document.getElementById('mapa');service=new google.maps.places.PlacesService(G),service.findPlaceFromQuery({query:U,fields:['photos','formatted_address','name','rating','opening_hours','geometry']},function(H){var K;if(null!=H)for(var W=0;W<H.length;W++){K=H[W];break}N(K)}),z.cancel_edition()},cancel_edition:function cancel_edition(){e('#span-icon-cancel-edit').hide(),e('#tip-cancel').hide(),e('#span-icon-save-profile').hide(),e('#tip-save').hide(),e('#span-icon-edit').show(),e('#tip-edit').show(),e('#tipo_doc').prop('disabled',!0),e('#num_doc').prop('readonly',!0),e('#icetex_status').prop('disabled',!0),e('#genero').prop('disabled',!0),e('#cond_excepcion').prop('disabled',!0),e('#act_simultanea').prop('disabled',!0),e('#etnia').prop('disabled',!0),e('#municipio_act').prop('disabled',!0),e('#estado_civil').prop('disabled',!0),e('#pais').prop('disabled',!0),e('#observacion').prop('readonly',!0),e('.select_statuses_program').prop('disabled',!0),e('.input_fields_general_tab').prop('readonly',!0),e('.input-tracking').prop('disabled',!0),e('.bt_delete_person').css('visibility','hidden')},revert_changes:function revert_changes(O){for(field in O)e('#'+O[field].name).val(O[field].value);location.reload(!0)}}});