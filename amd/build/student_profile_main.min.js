/*
 * @package    block_ases
 * @copyright  ASES
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define(["jquery","block_ases/bootstrap","block_ases/d3","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/Chart","block_ases/mustache","block_ases/loading_indicator","block_ases/academic_profile_main","block_ases/socioed_profile_main","block_ases/geographic_main","block_ases/discapacity_tracking_main","core/templates","core/modal_factory"],function(e,a,t,o,r,n,s,c,l,d,u,p,m,v,g){return{init:function(a){var t=this,o=e("#municipio_act").val(),r=e("#latitude").val(),n=e("#longitude").val();let s=new google.maps.LatLng(3.3741569,-76.5355235),c=new google.maps.LatLng(3.431626,-76.546822);var d=document.querySelector("#cod_programa_activo").dataset.info[1],u="6"===d||"8"===d?c:s;let p=e("#nil-links-span");g.create({type:g.types.ALERT,title:"Atenci\xf3n",body:`Al estudiante no se le ha subido el documento de Autorizaci\xf3n de Tratamiento de Datos Personales. Por favor hacerlo a la brevedad posible. <a target=_blank href="https://drive.google.com/file/d/19MpvhUrAvfh4NmEWqZGOacxy3tMmpNAY/view">Enlace al documento</a>`,footer:"test"},p).done(function(e){p.length>0&&p.click()}),"CALI"==o?document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+n+"&destination="+u.lat()+","+u.lng()+"&mode=transit'></iframe>":document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+n+"&destination="+u.lat()+","+u.lng()+"&mode=driving'></iframe>",e("#field_doc_dtddp").hide(),e("#socioed_li").one("click",{tab_name:"socioed"},f),e("#academic_li").one("click",{tab_name:"academic"},f),e("#geographic_li").one("click",{tab_name:"geographic"},f),e("#discapacity_tracking_li").one("click",{tab_name:"discapacity_tracking"},f),e("#geographic_li").on("click",function(){e("#mapa").appendTo("#geographic_map")}),e("#general_li").click(function(){e("#mapa").appendTo("#movableMap")}),e(document).on("click","#table_vive_con tbody tr td button",function(){e(this).parent().parent().remove()}),e("#cohorts_table tbody").find("td").each(function(){if(-1!=e(this).text().indexOf("Condici\xf3n de Excepci\xf3n")){var a=e("#cond_excepcion_alias").text().trim(),t=e("#cond_excepcion_name").text().trim();e(this).append("-"),e(this).append(a),e(this).attr("title",t)}}),e("#input_button_add_person").click(function(){let a="";a+='<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td>',a+='<td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td>',a+='<td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>',e("#table_vive_con").find("tbody").append(a)}),e('[data-toggle="tooltip"]').tooltip();var m=A(document.location.search),v=e(".panel-collapse.collapse.in");e("#asignados").select2({width:"resolve",height:"resolve",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#asignados").on("change",function(){var a,t;t=e("#asignados").val().split(" ")[0],e.ajax({type:"POST",data:JSON.stringify({function:"is_student",params:[t]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){if(1==JSON.parse(e)){var a=A(document.location.search),o=String(document.location).split("?")[0]+"?courseid="+a.courseid+"&instanceid="+a.instanceid+"&student_code="+t;location.href=o}else swal("Error","No se encuentra un estudiante asociado al c\xf3digo ingresado","error")},dataType:"text",cache:"false",error:function(e){swal("Error","Error al comunicarse con el servidor, por favor int\xe9ntelo nuevamente.","error")}})});for(var k=0,$=a.length;k<$;k++)e("#select-"+a[k].academic_program_id+" option[value="+a[k].program_status+"]").attr("selected",!0),"1"==a[k].program_status&&e("#tr-"+a[k].id_moodle_user).addClass("is-active"),"1"==a[k].tracking_status&&e("#div_flags_"+a[k].academic_program_id).prop("checked",!0);var y="",_=e("#div_cohorts").height();e("#div-icon-edit").height(_),this.edit_profile(t),e("div.slider.round").click(function(e){y=e.target.parentElement.children[0].checked}),e(".input-tracking").on("change",{current_tracking_status:y},function(){t.update_tracking_status(y,e(this),a,t)});var x="";(e(".select_statuses_program").on("focus",function(e){x=e.target.value}),e(".select_statuses_program").on("change",{current_status:x},function(){t.update_status_program(x,e(this))}),e("#icetex_status").on("click",{previous_status:e("#icetex_status option:selected").text()},E),e("#icon-tracking").on("click",function(){"seguimiento"==e("#input_status_ases").val()&&t.update_status_ases(m)}),"socioed_tab"===m.tab)?(e("#general_li").removeClass("active"),e("#socioed_li").addClass("active"),e("#general_tab").removeClass("active"),e("#socioed_tab").addClass("active"),v.removeClass("in"),e("#collapseOne").addClass("in")):v.removeClass("in");var w,T,B,S,O,j,z=e("#modal_peer_tracking");w=e("#modal_dropout"),T=e(".mymodal-close"),e("#goback_backdrop").on("click",function(){w.hide()}),T.on("click",function(){w.hide()}),B=e("#modal_peer_tracking"),S=e(".mymodal-close"),e("#cancel_peer_tracking").on("click",function(){B.hide()}),S.on("click",function(){B.hide()}),e(".panel-heading.heading_semester_tracking").on("click",function(){"collapsed"==e(this).parent().attr("class")?(e("h4>span",this).removeClass("glyphicon-chevron-left"),e("h4>span",this).addClass("glyphicon-chevron-down")):(e("h4>span",this).removeClass("glyphicon-chevron-down"),e("h4>span",this).addClass("glyphicon-chevron-left"))}),O=e("#modal_risk_span"),j=e("#modal_risk_close"),O.on("click",function(){e("#modal_risk_graph").hide()}),j.on("click",function(){e("#modal_risk_graph").hide()}),e("#button_add_track").on("click",function(){e("#save_seg").removeClass("hide"),e("#div_created").addClass("hide"),e("#upd_seg").addClass("hide"),e("#myModalLabel").attr("name","PARES"),z.show(),C()}),e("#view_form_update_profile_image").on("click",function(){e("#profile_image_update").show()}),e("#send-profile-image").on("click",function(){l.show();var a=e("#id_moodle").val(),t=document.getElementById("profile-image-input").files[0];e.ajax({url:"../managers/student_profile/studentprofile_api.php",data:JSON.stringify({function:"update_user_image",params:[a,t]}),cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",success:function(e){l.hide(),alert(e)},error:function(e){l.hide(),console.log(e)}})}),e("#save_tracking_btn").on("click",function(){(function a(){var t=e("#tracking_peer_form"),o=e("#modal_peer_tracking"),r=t.serializeArray(),n=A(document.location.search),s=function e(a){var t=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/.exec(a[1].value);if(""==a[1].value)return"Debe introducir la fecha en la cual se realiz\xf3 el seguimiento";if(null===t)return"La fecha no sigue el patr\xf3n yyyy-mm-dd. Ejemplo 2017-10-13";if(""==a[2].value)return"Debe introducir el lugar donde se realiz\xf3 el seguimiento";if(""==a[7].value)return"El campo tema se encuentra vacio";if(""==a[8].value)return"El campo objetivos se encuentra vacio";else if(parseInt(a[5].value)<parseInt(a[3].value))return"La hora de finalizaci\xf3n debe ser mayor a la hora inicial";else if(parseInt(a[3].value)==parseInt(a[5].value)&&parseInt(a[6].value)<=parseInt(a[4].value))return"La hora de finalizaci\xf3n debe ser mayor a la hora inicial";else if(""!=a[9].value&&0==a[10].value)return"El riesgo asociado al campo Actividad Invidual no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Individual debe marcar un nivel de riesgo.";else if(""!=a[11].value&&0==a[12].value)return"El riesgo asociado al campo Actividad Familiar no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Familiar debe marcar un nivel de riesgo.";else if(""!=a[13].value&&0==a[14].value)return"El riesgo asociado al campo Actividad Acad\xe9mico no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Acad\xe9mico debe marcar un nivel de riesgo.";else if(""!=a[15].value&&0==a[16].value)return"El riesgo asociado al campo Actividad Econ\xf3mico no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Econ\xf3mico debe marcar un nivel de riesgo.";else if(""!=a[17].value&&0==a[18].value)return"El riesgo asociado al campo Actividad Vida Universitaria no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Vida Universitaria debe marcar un nivel de riesgo.";else if(""==a[9].value&&0!=a[10].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Individual, debe digitar informaci\xf3n en el campo Actividad Individual. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[11].value&&0!=a[12].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Familiar, debe digitar informaci\xf3n en el campo Actividad Familiar. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[13].value&&0!=a[14].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Acad\xe9mico, debe digitar informaci\xf3n en el campo Actividad Acad\xe9mico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[15].value&&0!=a[16].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Econ\xf3mico, debe digitar informaci\xf3n en el campo Actividad Econ\xf3mico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[17].value&&0!=a[18].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Vida Universitaria, debe digitar informaci\xf3n en el campo Actividad Vida Universitaria. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else return"success"}(r);if("success"!=s)swal({title:"Advertencia",text:s,type:"warning",html:!0});else{r.push({name:"func",value:"save_tracking_peer"});var c=e("#id_ases").val();r.push({name:"id_ases",value:c}),r.push({name:"id_instance",value:n.instanceid}),e.ajax({type:"POST",data:r,url:"../../ases/managers/student_profile/studentprofile_serverproc.php",success:function(e){swal({title:e.title,text:e.msg,type:e.type},function(){o.hide(),A(document.location.search).tab?location.reload():location.href=location.search+"&tab=socioed_tab"})},dataType:"json",cache:"false",error:function(e){console.log(e)}})}})()}),e("fieldset").removeClass("hidden"),e("#clean_individual_risk").on("click",function(){e("#no_value_individual").prop("checked",!0)}),e("#clean_familiar_risk").on("click",function(){e("#no_value_familiar").prop("checked",!0)}),e("#clean_academic_risk").on("click",function(){e("#no_value_academic").prop("checked",!0)}),e("#clean_economic_risk").on("click",function(){e("#no_value_economic").prop("checked",!0)}),e("#clean_life_risk").on("click",function(){e("#no_value_life").prop("checked",!0)}),e(".btn-primary.edit_peer_tracking").on("click",function(){var a,t,o,r,n,s,c,l,d,u,p,m,v,g,f,h,b,k,$,y,_,E,x,w,A,T,B,S,O,j,z;t=e(this).attr("id").substring(14),C(),o=new Date(e("#"+t+" .date_tracking_peer").text()),r=e("#"+t+" .place_tracking_peer").text(),n=e("#"+t+" .init_time_tracking_peer").text(),s=e("#"+t+" .ending_time_tracking_peer").text(),c=e("#"+t+" .topic_tracking_peer").text(),l=e("#"+t+" .objectives_tracking_peer").text(),d=e("#"+t+" .individual_tracking_peer").text(),u=e("#"+t+" .ind_risk_tracking_peer").text(),p=e("#"+t+" .familiar_tracking_peer").text(),m=e("#"+t+" .fam_risk_tracking_peer").text(),v=e("#"+t+" .academico_tracking_peer").text(),g=e("#"+t+" .aca_risk_tracking_peer").text(),f=e("#"+t+" .economico_tracking_peer").text(),h=e("#"+t+" .econ_risk_tracking_peer").text(),b=e("#"+t+" .lifeu_tracking_peer").text(),k=e("#"+t+" .lifeu_risk_tracking_peer").text(),$=e("#"+t+" .observations_tracking_peer").text(),y={},y.bajo=1,y.medio=2,y.alto=3,_=o.getFullYear(),E=o.getMonth()+1,10>o.getMonth()?_+="-0"+E:_+="-"+E,10>o.getDate()?_+="-0"+o.getDate():_+="-"+o.getDate(),x=n.substring(0,2),w=n.substring(3,5),A=s.substring(0,2),T=s.substring(3,5),e('#h_ini option[value="'+x+'"]').attr("selected",!0),e('#m_ini option[value="'+w+'"]').attr("selected",!0),e('#h_fin option[value="'+A+'"]').attr("selected",!0),e('#m_fin option[value="'+T+'"]').attr("selected",!0),B=y[u.toLowerCase()],S=y[m.toLowerCase()],O=y[h.toLowerCase()],j=y[g.toLowerCase()],z=y[k.toLowerCase()],""!=u?e("input[name='riesgo_ind'][value='"+B+"']").prop("checked",!0):e("input[name='riesgo_ind'][value='0']").prop("checked",!0),""!=m?e("input[name='riesgo_familiar'][value='"+S+"']").prop("checked",!0):e("input[name='riesgo_familiar'][value='0']").prop("checked",!0),""!=h?e("input[name='riesgo_econom'][value='"+O+"']").prop("checked",!0):e("input[name='riesgo_econom'][value='0']").prop("checked",!0),""!=g?e("input[name='riesgo_aca'][value='"+j+"']").prop("checked",!0):e("input[name='riesgo_aca'][value='0']").prop("checked",!0),""!=k?e("input[name='riesgo_uni'][value='"+z+"']").prop("checked",!0):e("input[name='riesgo_uni'][value='0']").prop("checked",!0),e("#date").val(_),e("#place").val(r),e("#topic_textarea").val(c),e("#objetivos").val(l),e("#individual").val(d),e("#familiar").val(p),e("#academico").val(v),e("#economico").val(f),e("#vida_uni").val(b),e("#observaciones").val($),e("#id_tracking_peer").val(t),e("#modal_peer_tracking").show()}),e(".btn-danger.delete_peer_tracking").on("click",function(){var a=e(this).attr("id").substring(21);swal({title:"Advertencia",text:"\xbfEst\xe1 seguro(a) que desea borrar este seguimiento?",type:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){var o;t&&(o=a,e.ajax({type:"POST",data:{func:"delete_tracking_peer",id_tracking:o},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){swal(e.title,e.msg,e.status),A(document.location.search).tab?location.reload():location.href=location.search+"&tab=socioed_tab"},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.status)}}))})}),e("#view_graph_radial_button").on("click",function(){t.graph_radial()}),e("#view_graphic_risk_button").off("click",b),e("#view_graphic_risk_button").one("click",h),e("#mymodal-riesgo-close").click(function(){e("#modal_riesgos").fadeOut(200)})},equalize:function(){e(document).ready(function(){0==document.getElementById("genero").value&&(e("#lb_otro").show(),e("#div_otro_genero").show()),0==document.getElementById("act_simultanea").value&&(e("#lb_otro_act").show(),e("#div_otro_act").show());var a=e(".equalize").map(function(){return e(this).height()}).get(),t=Math.max.apply(null,a);e(".equalize").height(t),e("#birthdate").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,onChangeMonthYear:function(a,t,o){e(this).datepicker("setDate",new Date(a,t-1,o.selectedDay))},onClose:function(a,t){e("#birthdate").prop("disabled",!1)}}),e("#birthdate").on("click",function(){e("#birthdate").prop("disabled",!0)})})},update_status_program:function(a,t){var o=t.parent().parent().attr("id").split("-")[1],r=t.attr("id").split("-")[1],n=t.val();swal({title:"Advertencia",text:"\xbfEst\xe1 seguro que desea cambiar el estado del programa?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){t?(l.show(),e.ajax({type:"POST",data:JSON.stringify({function:"update_status_program",params:[o,r,n]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?("ACTIVO"==e("#select-"+r).val()?e("#tr-"+o).addClass("is-active"):e("#tr-"+o).removeClass("is-active"),swal(a.title,a.message,a.type)):console.log(a)},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.type)}}),l.hide()):e("#select-"+data.program_id).val(a)})},update_status_ases:function(a){swal({title:"Advertencia",text:"\xbfEst\xe1 seguro de que desea cambiar el estado de seguimiento del estudiante en esta instancia? El estado pasar\xe1 de 'seguimiento' a 'sin seguimiento'",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No"},function(t){t&&((modal_dropout=e("#modal_dropout")).show(),e("#save_changes_dropout").on("click",function(){l.show();var t=e("#id_ases").val(),o=e("#reasons_select").val(),r=e("#description_dropout").val();e.ajax({type:"POST",data:JSON.stringify({function:"update_ases_status",params:[t,a.instanceid,a.student_code,o,r]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){l.hide(),0==a.status_code?(e("#input_status_ases").val("sinseguimiento"),e("#tip_ases_status").html("No se realiza seguimiento en esta instancia"),e("#icon-tracking").removeClass("i-tracking-t"),e("#icon-tracking").addClass("i-tracking"),modal_dropout.hide(),swal(a.title,a.message,a.type)):-7==a.status_code||-8==a.status_code?swal(a.title,a.error_message,a.type):console.log(a)},dataType:"json",cache:"false",error:function(e){l.hide(),modal_dropout.hide(),swal(e.title,e.message,e.type)}})}))})},update_tracking_status:function(a,t,o,r){has_tracking_status=!1,!1==a?(has_tracking_status=r.validate_tracking_statuses(o)).tracking_status&&swal({title:"\xbfEst\xe1 seguro/a de cambiar el estado?",text:"Se alternar\xe1 el perfil de Moodle asociado al estudiante al cual se el realiza seguimiento",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(o){if(o){l.show(),e(".input-tracking").prop("checked",!1),t.prop("checked",!0);var r=e("#id_ases").val(),n=t[0].id;n=n.split("_")[2],e.ajax({type:"POST",data:JSON.stringify({function:"update_tracking_status",params:[r,n]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){l.hide(),setTimeout(function(){0==e.status_code||-9==e.status_code?swal(e.title,e.message,e.type):console.log(e)},100)},dataType:"json",cache:"false",error:function(e){l.hide(),setTimeout(function(){swal(e.title,e.msg,e.status)},100)}})}else a?t.prop("checked",!0):t.prop("checked",!1)}):t.prop("checked",!0)},validate_tracking_statuses:function(e){for(i=0,has_tracking_status=!1;i<e.length;i++)if(1==e[i].tracking_status){has_tracking_status=!0;break}return e[i]},get_url_parameters:function(e){for(var a=[],t=document.location.search.substring(1).split("&"),o=0;o<t.length;o++){var r=t[o].split("=");a[r[0]]=r[1]}return a},graph_radial:function(){var a,t,o,r,n,c=document.getElementById("canvas_radial_graph").getContext("2d");a=0==e("#individual_risk").attr("data-risk-level")?4:e("#individual_risk").attr("data-risk-level"),t=0==e("#familiar_risk").attr("data-risk-level")?4:e("#familiar_risk").attr("data-risk-level"),o=0==e("#academic_risk").attr("data-risk-level")?4:e("#academic_risk").attr("data-risk-level"),r=0==e("#economic_risk").attr("data-risk-level")?4:e("#economic_risk").attr("data-risk-level"),n=0==e("#life_risk").attr("data-risk-level")?4:e("#life_risk").attr("data-risk-level"),e("#modal_radial_graph").fadeIn(200);var l={labels:["Individual","Familiar","Acad\xe9mico","Econ\xf3mico","Vida universitaria"],datasets:[{data:[4-a,4-t,4-o,4-r,4-n],backgroundColor:"rgba(255, 99, 132, 0.4)",borderColor:["rgba(255,99,132,1)"],borderWidth:2,fontsize:12}]};new s(c,{type:"radar",data:l,options:{scale:{ticks:{beginAtZero:!0,min:0,max:3,stepSize:1,display:!1},pointLabels:{fontSize:12},scaleLabel:{fontsize:10}},legend:{display:!1}}})},edit_profile:function(a){var t=e("#ficha_estudiante").serializeArray(),o=document.getElementById("otro_genero").value,r=document.getElementById("otro_act_simultanea").value;e("#span-icon-edit").on("click",function(){e(this).hide(),e("#tip-edit").hide(),e("#span-icon-save-profile").show(),e("#tip-save").show(),e("#span-icon-cancel-edit").show(),e("#tip-cancel").show(),e("#i_tipo_doc").prop("disabled",!1),e("#num_doc").prop("readonly",!1),e("#email").prop("readonly",!1),e("#icetex_status").prop("disabled",!1),e("#pais").prop("disabled",!1),e("#genero").prop("disabled",!1),e("#s_sexo").prop("disabled",!1),e("#cond_excepcion").prop("disabled",!1),e("#act_simultanea").prop("disabled",!1),e("#etnia").prop("disabled",!1),e("#otro_act_simultanea").prop("disabled",!1),e("#otro_genero").prop("disabled",!1),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1),e("#s_estado_civil").prop("disabled",!1),e("#observacion").prop("readonly",!1),e(".select_statuses_program").prop("disabled",!1),e("#field_doc_dtddp").show(),e(".input_fields_general_tab").prop("readonly",!1),e(".bt_delete_person").css("visibility","visible"),e(".input-tracking").prop("disabled",!1),e("#div_add_persona_vive").show(),e("#edit_person_vive").show(),e("#age").hide(),e("#birthdate").show(),e("#link_doc_dtddp").bind("click",function(e){e.preventDefault()}),e("#link_doc_dtddp").css("color","black").css("text-decoration","none"),e("#genero").on("click",function(){0==document.getElementById("genero").value?(e("#div_otro_genero").show(),e("#lb_otro").show(),e("#otro_genero").prop("required",!0)):(e("#div_otro_genero").hide(),e("#lb_otro").hide(),e("#otro_genero").prop("required",!1))}),e("#act_simultanea").on("click",function(){0==document.getElementById("act_simultanea").value?(e("#div_otro_act").show(),e("#lb_otro_act").show(),e("#otro_act_simultanea").prop("required",!0)):(e("#div_otro_act").hide(),e("#lb_otro_act").hide(),e("#otro_act_simultanea").prop("required",!1))})}),e("#span-icon-cancel-edit").on("click",{form:t},function(e){swal({title:"\xbfDesea cancelar la edici\xf3n?",text:"Los cambios no guardados se perder\xe1n",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(t){t&&(a.cancel_edition(),a.revert_changes(e.data.form))})}),e("#span-icon-save-profile").on("click",function(){var t=e("#ficha_estudiante").serializeArray(),n=new Date,s=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();t.push({name:"ult_modificacion",value:s});var c=a.validate_form(t);if("error"==c.status)swal(c.title,c.msg,c.status);else{var l,d=[],u=[],p=[];e(".table_vive_con td").find(":input").each(function(){"name_person"==e(this).attr("name")&&u.push(e(this).val()),"parentesco_person"==e(this).attr("name")&&p.push(e(this).val())});for(var m=0;m<u.length;m++)l={name:u[m],parentesco:p[m]},d.push(l);d=JSON.stringify(d),a.save_form_edit_profile(t,a,o,r,d),e("#otro_genero").prop("disabled",!0),e("#otro_act_simultanea").prop("disabled",!0),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1)}})},validate_form:function(a){for(o in a){var t={},o=a[o];switch(t.title="\xc9xito",t.msg="El formulario fue validado con \xe9xito",t.status="success",o.name){case"email":let r=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(o.value);if(null===r||r[0]!==o.value)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no cumple con el formato institucional. Si no cuenta con el "+o.name+" institucional del estudiante, ingrese `temporal@correounivalle.edu.co', y el "+o.name+" alternativo en el campo correspondiente de la informaci\xf3n del estudiante.",t;break;case"fecha_nac":if(null==/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/.exec(o.value))return t.title="Error",t.status="error",t.msg="El campo 'fecha de nacimiento' no cumple con el formato de fecha aceptado (yyyy-mm-dd).",t;o.value+=" 00:00:00";break;case"estrato":if(o.value<0)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe ser negativo",t;if(o.value>6)return t.title="Error",t.status="error",t.msg="El campo a\xf1o de "+o.name+" no debe ser mayor al permitido",t;if(k(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener letras",t;if(y(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener s\xedmbolos",t;break;case"ingreso":if(o.value<0)return t.title="Error",t.status="error",t.msg="El campo a\xf1o de "+o.name+" no debe ser negativo",t;let n=new Date().getFullYear();if(o.value>n)return t.title="Error",t.status="error",t.msg="El campo a\xf1o de "+o.name+" no debe ser mayor al actual",t;if(k(o.value))return t.title="Error",t.status="error",t.msg="El campo a\xf1o de "+o.name+" no debe contener letras",t;break;case"puntaje_icfes":if(o.value<0)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe ser negativo",t;if(o.value>500)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe ser mayor al permitido",t;if(k(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener letras",t;break;case"hijos":if(""==o.value)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" es obligatorio",t;if(o.value<0)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe ser negativo",t;if(k(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener letras",t;break;case"name_person":if(""==o.value)return t.title="Error",t.status="error",t.msg="El campo "+o.name+" es obligatorio",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener n\xfameros",t;break;case"otro_genero":if(""==document.getElementById("otro_genero").value&&e("#otro_genero").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" es obligatorio",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener n\xfameros",t;break;case"otro_act_simultanea":if(""==document.getElementById("otro_act_simultanea").value&&e("#otro_act_simultanea").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" es obligatorio",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener n\xfameros",t;break;case"num_doc":case"tel_res":case"celular":case"tel_acudiente":if(k(o.value)||y(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" solo debe contener n\xfameros",t;break;case"acudiente":if(y(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener s\xedmbolos",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no debe contener n\xfameros",t;break;case"name_person":if(y(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" (Nombre persona con quien vive) no debe contener s\xedmbolos",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" (Nombre persona con quien vive) no debe contener n\xfameros",t;break;case"parentesco_person":if(y(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" (Parentesco persona con quien vive) no debe contener s\xedmbolos",t;if($(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" (Parentesco persona con quien vive) no debe contener n\xfameros",t;break;case"emailpilos":if(!_(o.value))return t.title="Error",t.status="error",t.msg="El campo "+o.name+" no tiene el formato de un correo electr\xf3nico",t}}return t},save_form_edit_profile:function(a,t,o,r,n){l.show(),e.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[a,o,r,n]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){l.hide(),e("#link_doc_dtddp").attr("href",e("#field_doc_dtddp").prop("value")),0==a.status_code&&swal(a.title,a.message,a.type)},dataType:"json",cache:"false",error:function(e){l.hide(),swal(e.title,e.msg,e.type)}}),t.cancel_edition()},cancel_edition:function(){e("#span-icon-cancel-edit").hide(),e("#tip-cancel").hide(),e("#span-icon-save-profile").hide(),e("#tip-save").hide(),e("#span-icon-edit").show(),e("#tip-edit").show(),e("#i_tipo_doc").prop("disabled",!0),e("#num_doc").prop("readonly",!0),e("#email").prop("readonly",!0),e("#icetex_status").prop("disabled",!0),e("#genero").prop("disabled",!0),e("#s_sexo").prop("disabled",!0),e("#cond_excepcion").prop("disabled",!0),e("#act_simultanea").prop("disabled",!0),e("#etnia").prop("disabled",!0),e("#s_estado_civil").prop("disabled",!0),e("#pais").prop("disabled",!0),e("#observacion").prop("readonly",!0),e(".select_statuses_program").prop("disabled",!0),e("#field_doc_dtddp").hide(),e(".input_fields_general_tab").prop("readonly",!0),e(".input-tracking").prop("disabled",!0),e(".bt_delete_person").css("visibility","hidden"),e("#age").show(),e("#birthdate").hide(),e("#link_doc_dtddp").css("color","").css("text-decoration",""),e("#link_doc_dtddp").unbind("click")},revert_changes:function(a){for(field in a)e("#"+a[field].name).val(a[field].value);location.reload(!0)}};function f(a){l.show();var t=e("#id_ases").val(),o=a.data.tab_name,r=document.querySelector("#dphpforms_block_instance").dataset.info;e(".active").removeClass("active"),e("#"+o+"_li").addClass("active"),e.ajax({type:"POST",data:JSON.stringify({function:"load_tabs",params:[t,o,r]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?v.renderForPromise("block_ases/view_"+o+"_tab_sp",a.data_response,"moove").then(({html:a,js:t})=>{switch(v.appendNodeContents(".tab-content",a,t),e("#"+o+"_tab").addClass("active"),l.hide(),o){case"socioed":u.init();break;case"academic":d.init();break;case"geographic":p.init(),e("#mapa").appendTo("#geographic_map");break;case"tracing_others":break;case"discapacity_tracking":m.init()}}).catch(e=>console.error(e)):console.log(a)},dataType:"json",cache:"false",error:function(e){console.log(e)}}),l.hide()}function h(){l.show();var a=e("#id_ases").val(),t=document.querySelector("#peer_tracking_info"),o=JSON.parse(t?t.dataset.info:null);e.ajax({type:"POST",data:JSON.stringify({function:"load_risk_info",params:[a,o]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?(function a(t){for(var o=[],r=["individual","familiar","academico","economico","vida_universitaria"],n=0;n<Object.keys(t).length;n++){for(var s=[],c=[],l=[],d=[],u=r[n],p=t[u][0].datos,m=0;"false"==p.end;)c.push(p.fecha),l.push(p.color),d.push(p.riesgo),m+=1,p=t[u][m].datos;s.push(u),s.push(c),s.push(l),s.push(d),o.push(s)}e("#risk_graphic_info").attr("data-info",JSON.stringify(o))}(a.data_response),e("#modal_riesgos").fadeIn(200),S(),e("#view_graphic_risk_button").on("click",b)):console.log(a)},dataType:"json",cache:"false",error:function(e){console.log(e)}}),l.hide()}function b(){e("#modal_riesgos").fadeIn(200),S()}function k(e){for(i=0,e=e.toLowerCase();i<e.length;i++)if(-1!="abcdefghyjklmn\xf1opqrstuvwxyz".indexOf(e.charAt(i),0))return 1;return 0}function $(e){for(i=0;i<e.length;i++)if(-1!="0123456789".indexOf(e.charAt(i),0))return 1;return 0}function y(e){for(i=0;i<e.length;i++)if(-1!="|\xb0!\xa1'@#$%&/()=\xbf?+{}[]-+*.,<>;:_^~".indexOf(e.charAt(i),0))return 1;return 0}function _(e){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)?1:0}function E(a){var t=a.data.previous_status;e("#icetex_status").change(function(){var a=e("#icetex_status option:selected").text();swal({title:"\xbfEst\xe1 seguro/a de realizar este cambio?",text:"El estado Icetex del estudiante pasar\xe1 de "+t+" a "+a,type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(a){var o,r;a?(l.show(),o=e("#id_ases").val(),r=e("#icetex_status").val(),e.ajax({type:"POST",data:JSON.stringify({function:"save_icetex_status",params:[o,r]}),dataType:"json",cache:"false",url:"../../ases/managers/student_profile/studentprofile_api.php",success:function(e){0==e.status_code?swal({title:e.title,text:e.message,type:e.type}):console.log(e)},error:function(e){swal("Error","No se puede contactar con el servidor.","error")}}),l.hide()):e("#icetex_status").val(t)})})}function x(){var a;e("#estadoAses").on("focus",function(){a=e("#estadoAses option:selected").text()}).change(function(){var t=e("#estadoAses option:selected").text();"RETIRADO"==t?(e("#modal_dropout").show(),e("#save_changes_dropout").click(function(){""==e("reasons_select").val()?swal({title:"Error",text:"Seleccione un m\xf3tivo",type:"error"}):w()})):"APLAZADO"==t?(e("#modal_dropout").show(),e("#save_changes_dropout").click(function(){""==e("reasons_select").val()?swal({title:"Error",text:"Seleccione un m\xf3tivo",type:"error"}):w()})):"NO REGISTRA"==t?swal({title:"Error",text:"Por favor seleccione un Estado Ases.",type:"error"}):swal({title:"\xbfEst\xe1 seguro/a de realizar este cambio?",text:"El estado ASES del estudiante pasar\xe1 de "+a+" a "+t,type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(t){if(t){var o=w();swal(o.title,o.msg,resul_status.status)}else e("#estadoAses").val(a)})})}function w(){var a=[],t=e("#estadoAses").val(),o=e("#id_ases").val(),r=e("#reasons_select").val(),n=e("#description_dropout").val();a.push({name:"func",value:"save_ases_status"}),a.push({name:"new_status",value:t}),a.push({name:"id_ases",value:o}),""!=r&&a.push({name:"id_reason",value:r}),""!=n&&a.push({name:"observations",value:n}),e.ajax({type:"POST",data:a,url:"../../ases/managers/student_profile/studentprofile_serverproc.php",success:function(a){swal({title:a.title,text:a.msg,type:a.type}),e("#modal_dropout").hide(),e("#description_dropout").val(""),e("#no_reason_option").attr("selected","selected")},dataType:"json",cache:"false",error:function(e){swal("Error","El estado no fue actualizado. Error al contactarse con el servidor.","error")}})}function C(){e("#date").datepicker({dateFormat:"yy-mm-dd"});var a=new Date;a.getDate(),a.getMonth(),a.getFullYear();for(var t=a.getMinutes(),o=a.getHours(),r="",n=0;n<24;n++)n==o?(o<10&&(o="0"+o),r+='<option value="'+o+'" selected>'+o+"</option>"):n<10?r+='<option value="0'+n+'">0'+n+"</option>":r+='<option value="'+n+'">'+n+"</option>";for(var s="",n=0;n<60;n++)n==t?(t<10&&(t="0"+t),s+='<option value="'+t+'" selected>'+t+"</option>"):n<10?s+='<option value="0'+n+'">0'+n+"</option>":s+='<option value="'+n+'">'+n+"</option>";e("#h_ini").append(r),e("#m_ini").append(s),e("#h_fin").append(r),e("#m_fin").append(s),e("#infomonitor").addClass("hide"),e("#seguimiento").find("input:text, textarea").val(""),e("#seguimiento").find("input:radio,input:checkbox").prop("checked",!1),e("#upd_seg").attr("disabled",!1),e("#upd_seg").attr("title",""),e("#seguimiento").find("select, textarea, input").attr("disabled",!1),e("#no_value_individual").hide(),e("#no_value_familiar").hide(),e("#no_value_academic").hide(),e("#no_value_economic").hide(),e("#no_value_life").hide(),e("#id_tracking_peer").val(""),e("#place").val(""),e("#topic_textarea").val(""),e("#objetivos").val(""),e("#individual").val(""),e("#familiar").val(""),e("#academico").val(""),e("#economico").val(""),e("#vida_uni").val(""),e("#observaciones").val(""),e("#no_value_individual").prop("checked",!0),e("#no_value_familiar").prop("checked",!0),e("#no_value_academic").prop("checked",!0),e("#no_value_economic").prop("checked",!0),e("#no_value_life").prop("checked",!0)}function A(e){for(var a=[],t=document.location.search.substring(1).split("&"),o=0;o<t.length;o++){var r=t[o].split("=");a[r[0]]=r[1]}return a}function T(){var a=e("#idtalentos").val();e.ajax({type:"POST",data:{id:a},url:"../managers/get_risk.php",success:function(e){if(e.individual)var a=parseInt(e.individual.calificacion_riesgo);else var a=0;if(e.familiar)var t=parseInt(e.familiar.calificacion_riesgo);else var t=0;if(e.economico)var o=parseInt(e.economico.calificacion_riesgo);else var o=0;if(e.academico)var r=parseInt(e.academico.calificacion_riesgo);else var r=0;if(e.vida_universitaria)var n=parseInt(e.vida_universitaria.calificacion_riesgo);else var n=0;if(e.geografico)var s=parseInt(e.geografico.calificacion_riesgo);else var s=0;a>0&&(a=4-a),t>0&&(t=4-t),o>0&&(o=4-o),n>0&&(n=4-n),r>0&&(r=4-r),riskGraphic(a,t,o,r,n,s)},dataType:"json",error:function(e){console.log(e)}})}function B(){var a=[],t=[],o=e("input:radio[name=riesgo_ind]:checked").val(),r=e("input:radio[name=riesgo_familiar]:checked").val(),n=e("input:radio[name=riesgo_aca]:checked").val(),s=e("input:radio[name=riesgo_econom]:checked").val(),c=e("input:radio[name=riesgo_uni]:checked").val();"3"==o&&(a.push("Individual"),t.push(e("#individual").val())),"3"==r&&(a.push("Familiar"),t.push(e("#familiar").val())),"3"==n&&(a.push("Acad\xe9mico"),t.push(e("#academico").val())),"3"==s&&(a.push("Econ\xf3mico"),t.push(e("#economico").val())),"3"==c&&(a.push("Vida universitaria"),t.push(e("#vida_uni").val()));var l=[];l.push({name:"function",value:"send_email"}),l.push({name:"id_student_moodle",value:e("#iduser").val()}),l.push({name:"id_student_pilos",value:e("#idtalentos").val()}),l.push({name:"risk_array",value:a}),l.push({name:"observations_array",value:t}),l.push({name:"date",value:e("#date").val()}),l.push({name:"url",value:window.location}),0!=a.length&&e.ajax({type:"POST",data:l,url:"../managers/seguimientos.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}function S(){var e=JSON.parse(document.querySelector("#risk_graphic_info").dataset.info);O(e[0],ctx_individual),O(e[1],ctx_familiar),O(e[2],ctx_academico),O(e[3],ctx_economico),O(e[4],ctx_vida_universitaria)}function O(e,a,t){return new s(a,{type:"line",data:{labels:e[1],datasets:[{label:"Nivel de riesgo",fill:!1,lineTension:0,pointBackgroundColor:e[2],data:e[3],backgroundColor:"black",borderColor:"black",borderWidth:3,pointRadius:5,pointHoverRadius:7}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,max:3,min:0}}]}}})}});