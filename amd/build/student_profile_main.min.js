define(["jquery","block_ases/bootstrap","block_ases/d3","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/Chart"],function(e,a,t,o,n,r,s){return{init:function(a){var t=this;e("#cohorts_table tbody").find("td").each(function(){if(-1!=e(this).text().indexOf("Condición de Excepción")){var a=e("#cond_excepcion_alias").text().trim(),t=e("#cond_excepcion_name").text().trim();e(this).append("-"),e(this).append(a),e(this).attr("title",t)}});var i=document.getElementById("municipio_act").value,o=e("#latitude").val(),n=e("#longitude").val();document.getElementById("mapa").innerHTML=1079==i?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+n+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+n+"&destination=3.3759493,-76.5355789&mode=driving'></iframe>",e("#geographic_li").click(function(){e("#mapa").appendTo("#geographic_map")}),e("#general_li").click(function(){e("#mapa").appendTo("#movableMap")}),e(document).on("click","#table_vive_con tbody tr td button",function(){e(this).parent().parent().remove()}),e("#input_button_add_person").click(function(){let a="";a+='<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td>',a+='<td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td>',a+='<td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>',e("#table_vive_con").find("tbody").append('<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td><td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td><td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>')}),e('[data-toggle="tooltip"]').tooltip();var r=p(document.location.search),s=e(".panel-collapse.collapse.in");e("#asignados").select2({width:"resolve",height:"resolve",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#asignados").on("change",function(){var a,t=e("#asignados").val().split(" ")[0];a=t,e.ajax({type:"POST",data:{func:"is_student",code_student:a},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){if("1"==e){var t=p(document.location.search),i=String(document.location),o=i.split("?"),n=o[0]+"?courseid="+t.courseid+"&instanceid="+t.instanceid+"&student_code="+a;location.href=n}else swal("Error","No se encuentra un estudiante asociado al código ingresado","error")},dataType:"text",cache:"false",error:function(e){swal("Error","Error al comunicarse con el servidor, por favor intentelo nuevamente.","error")}})});for(var l=0,c=a.length;l<c;l++)e("#select-"+a[l].academic_program_id+" option[value="+a[l].program_status+"]").attr("selected",!0),"1"==a[l].program_status&&e("#tr-"+a[l].id_moodle_user).addClass("is-active"),"1"==a[l].tracking_status&&e("#div_flags_"+a[l].academic_program_id).prop("checked",!0);var d="",_=e("#div_cohorts").height();e("#div-icon-edit").height(_),this.edit_profile(t),e("div.slider.round").click(function(e){d=e.target.parentElement.children[0].checked}),e(".input-tracking").on("change",{current_tracking_status:d},function(){t.update_tracking_status(d,e(this),a,t)});var g="";switch(e(".select_statuses_program").on("focus",function(e){g=e.target.value}),e(".select_statuses_program").on("change",{current_status:g},function(){t.update_status_program(g,e(this))}),e("#icon-tracking").on("click",function(){t.update_status_ases(r)}),r.tab){case"socioed_tab":e("#general_li").removeClass("active"),e("#socioed_li").addClass("active"),e("#general_tab").removeClass("active"),e("#socioed_tab").addClass("active"),s.removeClass("in"),e("#collapseOne").addClass("in");break;default:s.removeClass("in")}var v,f,h=e("#modal_peer_tracking");v=e("#modal_dropout"),f=e(".mymodal-close"),e("#goback_backdrop").on("click",function(){v.hide()}),f.on("click",function(){v.hide()}),function(){var a=e("#modal_peer_tracking"),t=e(".mymodal-close");e("#cancel_peer_tracking").on("click",function(){a.hide()}),t.on("click",function(){a.hide()}),e(".panel-heading.heading_semester_tracking").on("click",function(){"collapsed"==e(this).parent().attr("class")?(e("h4>span",this).removeClass("glyphicon-chevron-left"),e("h4>span",this).addClass("glyphicon-chevron-down")):(e("h4>span",this).removeClass("glyphicon-chevron-down"),e("h4>span",this).addClass("glyphicon-chevron-left"))})}(),function(){var a=e("#modal_risk_span"),t=e("#modal_risk_close");a.on("click",function(){e("#modal_risk_graph").hide()}),t.on("click",function(){e("#modal_risk_graph").hide()})}(),e("#button_add_track").on("click",function(){e("#save_seg").removeClass("hide"),e("#div_created").addClass("hide"),e("#upd_seg").addClass("hide"),e("#myModalLabel").attr("name","PARES"),h.show(),u()}),e("#view_form_update_profile_image").on("click",function(){e("#profile_image_update").show()}),e("#send-profile-image").on("click",function(){var a=new FormData;a.append("mdl_user_id",e("#id_moodle").val()),a.append("new_image_file",document.getElementById("profile-image-input").files[0]),a.append("func","update_user_image"),e.ajax({url:"../managers/student_profile/studentprofile_serverproc.php",data:a,cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",success:function(e){alert(e)},error:function(e){console.log(e)}}),console.log(a)}),e("#save_tracking_btn").on("click",function(){!function(){var a=e("#tracking_peer_form"),t=e("#modal_peer_tracking"),i=a.serializeArray(),o=p(document.location.search),n=function(e){var a=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/.exec(e[1].value);return""==e[1].value?"Debe introducir la fecha en la cual se realizó el seguimiento":null===a?"La fecha no sigue el patrón yyyy-mm-dd. Ejemplo 2017-10-13":""==e[2].value?"Debe introducir el lugar donde se realizó el seguimiento":""==e[7].value?"El campo tema se encuentra vacio":""==e[8].value?"El campo objetivos se encuentra vacio":parseInt(e[5].value)<parseInt(e[3].value)?"La hora de finalización debe ser mayor a la hora inicial":parseInt(e[3].value)==parseInt(e[5].value)&&parseInt(e[6].value)<=parseInt(e[4].value)?"La hora de finalización debe ser mayor a la hora inicial":""!=e[9].value&&0==e[10].value?"El riesgo asociado al campo Actividad Invidual no está marcado. Si usted escribió información en el campo Actividad Individual debe marcar un nivel de riesgo.":""!=e[11].value&&0==e[12].value?"El riesgo asociado al campo Actividad Familiar no está marcado. Si usted escribió información en el campo Actividad Familiar debe marcar un nivel de riesgo.":""!=e[13].value&&0==e[14].value?"El riesgo asociado al campo Actividad Académico no está marcado. Si usted escribió información en el campo Actividad Académico debe marcar un nivel de riesgo.":""!=e[15].value&&0==e[16].value?"El riesgo asociado al campo Actividad Económico no está marcado. Si usted escribió información en el campo Actividad Económico debe marcar un nivel de riesgo.":""!=e[17].value&&0==e[18].value?"El riesgo asociado al campo Actividad Vida Universitaria no está marcado. Si usted escribió información en el campo Actividad Vida Universitaria debe marcar un nivel de riesgo.":""==e[9].value&&0!=e[10].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Individual, debe digitar información en el campo Actividad Individual. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[11].value&&0!=e[12].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Familiar, debe digitar información en el campo Actividad Familiar. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[13].value&&0!=e[14].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Académico, debe digitar información en el campo Actividad Académico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[15].value&&0!=e[16].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Económico, debe digitar información en el campo Actividad Económico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[17].value&&0!=e[18].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Vida Universitaria, debe digitar información en el campo Actividad Vida Universitaria. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":"success"}(i);if("success"!=n)swal({title:"Advertencia",text:n,type:"warning",html:!0});else{i.push({name:"func",value:"save_tracking_peer"});var r=e("#id_ases").val();i.push({name:"id_ases",value:r}),i.push({name:"id_instance",value:o.instanceid}),e.ajax({type:"POST",data:i,url:"../../ases/managers/student_profile/studentprofile_serverproc.php",success:function(e){swal({title:e.title,text:e.msg,type:e.type},function(){t.hide();var e=p(document.location.search);e.tab?location.reload():location.href=location.search+"&tab=socioed_tab"})},dataType:"json",cache:"false",error:function(e){console.log(e)}})}}()}),e("fieldset").removeClass("hidden"),e("#clean_individual_risk").on("click",function(){e("#no_value_individual").prop("checked",!0)}),e("#clean_familiar_risk").on("click",function(){e("#no_value_familiar").prop("checked",!0)}),e("#clean_academic_risk").on("click",function(){e("#no_value_academic").prop("checked",!0)}),e("#clean_economic_risk").on("click",function(){e("#no_value_economic").prop("checked",!0)}),e("#clean_life_risk").on("click",function(){e("#no_value_life").prop("checked",!0)}),e(".btn-primary.edit_peer_tracking").on("click",function(){!function(a){u();var t=new Date(e("#"+a+" .date_tracking_peer").text()),i=e("#"+a+" .place_tracking_peer").text(),o=e("#"+a+" .init_time_tracking_peer").text(),n=e("#"+a+" .ending_time_tracking_peer").text(),r=e("#"+a+" .topic_tracking_peer").text(),s=e("#"+a+" .objectives_tracking_peer").text(),l=e("#"+a+" .individual_tracking_peer").text(),c=e("#"+a+" .ind_risk_tracking_peer").text(),d=e("#"+a+" .familiar_tracking_peer").text(),p=e("#"+a+" .fam_risk_tracking_peer").text(),m=e("#"+a+" .academico_tracking_peer").text(),_=e("#"+a+" .aca_risk_tracking_peer").text(),g=e("#"+a+" .economico_tracking_peer").text(),v=e("#"+a+" .econ_risk_tracking_peer").text(),f=e("#"+a+" .lifeu_tracking_peer").text(),h=e("#"+a+" .lifeu_risk_tracking_peer").text(),b=e("#"+a+" .observations_tracking_peer").text(),k=new Object;k.bajo=1,k.medio=2,k.alto=3;var y=t.getFullYear(),w=t.getMonth()+1;t.getMonth()<10?y+="-0"+w:y+="-"+w;t.getDate()<10?y+="-0"+t.getDate():y+="-"+t.getDate();var E=o.substring(0,2),x=o.substring(3,5),C=n.substring(0,2),B=n.substring(3,5);e('#h_ini option[value="'+E+'"]').attr("selected",!0),e('#m_ini option[value="'+x+'"]').attr("selected",!0),e('#h_fin option[value="'+C+'"]').attr("selected",!0),e('#m_fin option[value="'+B+'"]').attr("selected",!0);var I=k[c.toLowerCase()],T=k[p.toLowerCase()],A=k[v.toLowerCase()],S=k[_.toLowerCase()],z=k[h.toLowerCase()];""!=c?e("input[name='riesgo_ind'][value='"+I+"']").prop("checked",!0):e("input[name='riesgo_ind'][value='0']").prop("checked",!0);""!=p?e("input[name='riesgo_familiar'][value='"+T+"']").prop("checked",!0):e("input[name='riesgo_familiar'][value='0']").prop("checked",!0);""!=v?e("input[name='riesgo_econom'][value='"+A+"']").prop("checked",!0):e("input[name='riesgo_econom'][value='0']").prop("checked",!0);""!=_?e("input[name='riesgo_aca'][value='"+S+"']").prop("checked",!0):e("input[name='riesgo_aca'][value='0']").prop("checked",!0);""!=h?e("input[name='riesgo_uni'][value='"+z+"']").prop("checked",!0):e("input[name='riesgo_uni'][value='0']").prop("checked",!0);e("#date").val(y),e("#place").val(i),e("#topic_textarea").val(r),e("#objetivos").val(s),e("#individual").val(l),e("#familiar").val(d),e("#academico").val(m),e("#economico").val(g),e("#vida_uni").val(f),e("#observaciones").val(b),e("#id_tracking_peer").val(a),e("#modal_peer_tracking").show()}(e(this).attr("id").substring(14))}),e(".btn-danger.delete_peer_tracking").on("click",function(){var a=e(this).attr("id").substring(21);swal({title:"Advertencia",text:"¿Está seguro(a) que desea borrar este seguimiento?",type:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){t&&function(a){e.ajax({type:"POST",data:{func:"delete_tracking_peer",id_tracking:a},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){swal(e.title,e.msg,e.status);var a=p(document.location.search);a.tab?location.reload():location.href=location.search+"&tab=socioed_tab"},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.status)}})}(a)})}),e("#view_graph_radial_button").on("click",function(){t.graph_radial()}),e("#view_graphic_risk_button").click(function(){e("#modal_riesgos").fadeIn(200),function(){!function(){for(var e=0;e<Object.keys(datos.informacion).length;e++){var a,t=[],i=[],o=[],n=[];a=datos.informacion[e].dimension;for(var r=0;"false"==datos.informacion[e].datos[r].end;)i.push(datos.informacion[e].datos[r].fecha),o.push(datos.informacion[e].datos[r].color),n.push(datos.informacion[e].datos[r].riesgo),r+=1;t.push(a),t.push(i),t.push(o),t.push(n),datosGraficables.push(t)}}();m(datosGraficables[0],ctx_individual),m(datosGraficables[1],ctx_familiar),m(datosGraficables[2],ctx_academico),m(datosGraficables[3],ctx_economico),m(datosGraficables[4],ctx_vida_universitaria)}()}),e("#mymodal-riesgo-close").click(function(){e("#modal_riesgos").fadeOut(200)})},equalize:function(){e(document).ready(function(){0==document.getElementById("genero").value&&(e("#lb_otro").show(),e("#div_otro_genero").show()),0==document.getElementById("act_simultanea").value&&(e("#lb_otro_act").show(),e("#div_otro_act").show());var a=e(".equalize").map(function(){return e(this).height()}).get(),t=Math.max.apply(null,a);e(".equalize").height(t)})},update_status_program:function(a,t){var i={func:"update_status_program",program_id:t.attr("id").split("-")[1],status:t.val(),student_id:t.parent().parent().attr("id").split("-")[1]};swal({title:"Advertencia",text:"¿Está seguro que desea cambiar el estado del programa?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){t?e.ajax({type:"POST",data:i,url:"../managers/student_profile/studentprofile_serverproc.php",success:function(a){"ACTIVO"==e("#select-"+i.program_id).val()?e("#tr-"+i.student_id).addClass("is-active"):e("#tr-"+i.student_id).removeClass("is-active"),swal(a.title,a.msg,a.status)},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.status)}}):e("#select-"+i.program_id).val(a)})},update_status_ases:function(a){var t,i=e("#input_status_ases").val();switch(i){case"seguimiento":t="sinseguimiento";break;case"sinseguimiento":case"noasignado":t="seguimiento"}if("sinseguimiento"==i)swal("Advertencia","No es posible realizar esta acción. Al estudiante se le realiza seguimiento desde otra instancia.","warning");else{var o={func:"update_status_ases",current_status:i,new_status:t,instance_id:a.instanceid,code_student:a.student_code};swal({title:"Advertencia",text:"¿Está seguro que desea cambiar el estado de seguimiento del estudiante en esta instancia? El estado pasará de '"+i+"' a '"+t+"'",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No"},function(a){a&&("sinseguimiento"==t?(modal_dropout=e("#modal_dropout"),modal_dropout.show(),e("#save_changes_dropout").on("click",function(){o.id_reason_dropout=e("#reasons_select").val(),o.observation=e("#description_dropout").val(),e.ajax({type:"POST",data:o,url:"../managers/student_profile/studentprofile_serverproc.php",success:function(a){i=t,e("#input_status_ases").val(t),"seguimiento"==a.previous_status?(e("#icon-tracking").removeClass("i-tracking-t"),e("#icon-tracking").addClass("i-tracking-n"),e("#tip_ases_status").html("Se realiza seguimiento en otra instancia")):"sinseguimiento"==a.previous_status?(e("#icon-tracking").removeClass("i-tracking-f"),e("#icon-tracking").addClass("i-tracking-t"),e("#tip_ases_status").html("Se realiza seguimiento en esta instancia")):""==a.previous_status&&(e("#icon-tracking").removeClass("i-tracking-n"),e("#icon-tracking").addClass("i-tracking-t"),e("#tip_ases_status").html("No se realiza seguimiento")),modal_dropout.hide(),swal(a.title,a.msg,a.status)},dataType:"json",cache:"false",error:function(e){modal_dropout.hide(),swal(e.title,e.msg,e.status)}})})):"seguimiento"==t&&e.ajax({type:"POST",data:o,url:"../managers/student_profile/studentprofile_serverproc.php",success:function(a){i=t,e("#input_status_ases").val(t),"seguimiento"==a.previous_status?(e("#icon-tracking").removeClass("i-tracking-t"),e("#icon-tracking").addClass("i-tracking-n"),e("#tip_ases_status").html("Se realiza seguimiento en otra instancia")):"sinseguimiento"==a.previous_status?(e("#icon-tracking").removeClass("i-tracking-f"),e("#icon-tracking").addClass("i-tracking-t"),e("#tip_ases_status").html("Se realiza seguimiento en esta instancia")):""==a.previous_status&&(e("#icon-tracking").removeClass("i-tracking-n"),e("#icon-tracking").addClass("i-tracking-t"),e("#tip_ases_status").html("Se realiza seguimiento en esta instancia"))},dataType:"json",cache:"false",error:function(e){console.log(e)}}).then(function(e){swal(e.title,e.msg,e.status)}))})}},update_tracking_status:function(a,t,i,o){has_tracking_status=!1,0==a?(has_tracking_status=o.validate_tracking_statuses(i),has_tracking_status.tracking_status&&swal({title:"¿Está seguro/a de cambiar el estado?",text:"Se alternará el perfil de Moodle asociado al estudiante al cual se el realiza seguimiento",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(i){if(i){e(".input-tracking").prop("checked",!1),t.prop("checked",!0);var o=e("#id_ases").val(),n=t[0].id;n=n.split("_")[2],e.ajax({type:"POST",data:{func:"update_tracking_status",id_ases_student:o,id_academic_program:n},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){setTimeout(function(){swal(e.title,e.msg,e.status)},100)},dataType:"json",cache:"false",error:function(e){setTimeout(function(){swal(e.title,e.msg,e.status)},100)}})}else a?t.prop("checked",!0):t.prop("checked",!1)})):t.prop("checked",!0)},validate_tracking_statuses:function(e){for(has_tracking_status=!1,i=0;i<e.length;i++)if(1==e[i].tracking_status){has_tracking_status=!0;break}return e[i]},get_url_parameters:function(e){for(var a=[],t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var o=t[i].split("=");a[o[0]]=o[1]}return a},graph_radial:function(){var a,t,i,o,n,r=document.getElementById("canvas_radial_graph").getContext("2d");a=0==e("#individual_risk").attr("data-risk-level")?4:e("#individual_risk").attr("data-risk-level"),t=0==e("#familiar_risk").attr("data-risk-level")?4:e("#familiar_risk").attr("data-risk-level"),i=0==e("#academic_risk").attr("data-risk-level")?4:e("#academic_risk").attr("data-risk-level"),o=0==e("#economic_risk").attr("data-risk-level")?4:e("#economic_risk").attr("data-risk-level"),n=0==e("#life_risk").attr("data-risk-level")?4:e("#life_risk").attr("data-risk-level"),e("#modal_radial_graph").fadeIn(200);new s(r,{type:"radar",data:{labels:["Individual","Familiar","Académico","Económico","Vida universitaria"],datasets:[{data:[4-a,4-t,4-i,4-o,4-n],backgroundColor:"rgba(255, 99, 132, 0.4)",borderColor:["rgba(255,99,132,1)"],borderWidth:2,fontsize:12}]},options:{scale:{ticks:{beginAtZero:!0,min:0,max:3,stepSize:1,display:!1},pointLabels:{fontSize:12},scaleLabel:{fontsize:10}},legend:{display:!1}}})},edit_profile:function(a){var t,i=e("#ficha_estudiante").serializeArray(),o=document.getElementById("otro_genero").value,n=document.getElementById("otro_act_simultanea").value;e("#span-icon-edit").on("click",function(){e(this).hide(),e("#tip-edit").hide(),e("#span-icon-save-profile").show(),e("#tip-save").show(),e("#span-icon-cancel-edit").show(),e("#tip-cancel").show(),e("#tipo_doc").prop("disabled",!1),e("#num_doc").prop("readonly",!1),e("#email").prop("readonly",!1),e("#icetex_status").prop("disabled",!1),e("#pais").prop("disabled",!1),e("#genero").prop("disabled",!1),e("#sexo").prop("disabled",!1),e("#cond_excepcion").prop("disabled",!1),e("#act_simultanea").prop("disabled",!1),e("#etnia").prop("disabled",!1),e("#municipio_act").prop("disabled",!1),e("#otro_act_simultanea").prop("disabled",!1),e("#otro_genero").prop("disabled",!1),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1),e("#estado_civil").prop("disabled",!1),e("#observacion").prop("readonly",!1),e(".select_statuses_program").prop("disabled",!1),e(".input_fields_general_tab").prop("readonly",!1),e(".bt_delete_person").css("visibility","visible"),e(".input-tracking").prop("disabled",!1),e("#div_add_persona_vive").show(),e("#edit_person_vive").show();var i=e("#latitude").val(),o=e("#longitude").val();t=a.edit_map(i,o),e("#genero").on("click",function(){0==document.getElementById("genero").value?(e("#div_otro_genero").show(),e("#lb_otro").show(),e("#otro_genero").prop("required",!0)):(e("#div_otro_genero").hide(),e("#lb_otro").hide(),e("#otro_genero").prop("required",!1))}),e("#act_simultanea").on("click",function(){0==document.getElementById("act_simultanea").value?(e("#div_otro_act").show(),e("#lb_otro_act").show(),e("#otro_act_simultanea").prop("required",!0)):(e("#div_otro_act").hide(),e("#lb_otro_act").hide(),e("#otro_act_simultanea").prop("required",!1))})}),e("#span-icon-cancel-edit").on("click",{form:i},function(e){swal({title:"¿Desea cancelar la edición?",text:"Los cambios no guardados se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(t){t&&(a.cancel_edition(),a.revert_changes(e.data.form))})}),e("#span-icon-save-profile").on("click",function(){var i=e("#ficha_estudiante").serializeArray(),r=a.validate_form(i);if("error"==r.status)swal(r.title,r.msg,r.status);else{var s,l=[],c=[],d=[];e(".table_vive_con td").find(":input").each(function(){"name_person"==e(this).attr("name")&&c.push(e(this).val()),"parentesco_person"==e(this).attr("name")&&d.push(e(this).val())});for(var u=0;u<c.length;u++)s={name:c[u],parentesco:d[u]},l.push(s);l=JSON.stringify(l),a.save_form_edit_profile(i,a,o,n,l,t),e("#otro_genero").prop("disabled",!0),e("#otro_act_simultanea").prop("disabled",!0),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1)}})},validate_form:function(a){for(field in a){var t=new Object;switch(t.title="Éxito",t.msg="El formulario fue validado con éxito",t.status="success",a[field].name){case"email":let i=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(a[field].value);if(null===i)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no cumple con el formato institucional.",t;if(i[0]!==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no cumple con el formato institucional.",t;break;case"estrato":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(a[field].value>6)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser mayor al permitido",t;if(l(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"ingreso":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser negativo",t;let o=(new Date).getFullYear();if(a[field].value>o)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser mayor al actual",t;if(l(a[field].value))return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe contener letras",t;break;case"puntaje_icfes":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(a[field].value>500)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser mayor al permitido",t;if(l(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"hijos":if(""==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(l(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"name_person":if(""==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(c(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"otro_genero":if(""==document.getElementById("otro_genero").value&&e("#otro_genero").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(c(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"otro_act_simultanea":if(""==document.getElementById("otro_act_simultanea").value&&e("#otro_act_simultanea").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(c(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"num_doc":case"tel_res":case"celular":case"tel_acudiente":if(l(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" solo debe contener números",t;break;case"emailpilos":if(console.log(d(a[field].value)),!d(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no tiene el formato de un correo electrónico",t}}return t},save_form_edit_profile:function(a,t,i,o,n,r){e.ajax({type:"POST",data:{func:"save_profile",form:a,option1:i,option2:o,vive_con:n},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){swal(e.title,e.msg,e.status)},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.status)}});var s=document.getElementById("direccion_res").value,l=document.getElementById("municipio_act").value;document.getElementById("geographic_direccion").value=s,document.getElementById("geographic_ciudad").value=l;var c=document.getElementById("municipio_act"),d={query:s+" "+c.options[c.selectedIndex].text,fields:["photos","formatted_address","name","rating","opening_hours","geometry"]},u=document.getElementById("mapa");service=new google.maps.places.PlacesService(u),service.findPlaceFromQuery(d,function(a){var t;null!=a&&(t=a[0]);!function(a){var t,i;null!=a?(t=a.geometry.location.lat(),i=a.geometry.location.lng()):(t=r.getPosition().lat(),i=r.getPosition().lng());var o,n=e("#id_ases").val(),s=e("#select_neighborhood").val(),l=document.getElementById("municipio_act").value,c=new google.maps.DirectionsService;1079==l?(document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+i+"&destination=3.3759493,-76.5355789&mode=transit' allowfullscreen></iframe>",o={origin:{lat:t,lng:i},destination:{lat:3.3759493,lng:-76.5355789},travelMode:"TRANSIT"}):(document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+i+"&destination=3.3759493,-76.5355789&mode=driving' allowfullscreen></iframe>",o={origin:{lat:t,lng:i},destination:{lat:3.3759493,lng:-76.5355789},travelMode:"DRIVING"});c.route(o,function(a,o){var r=a.routes[0].legs[0].distance.value,c=a.routes[0].legs[0].duration.value,d=e("#direccion_res").val();e.ajax({type:"POST",data:JSON.stringify({func:"save_geographic_info",params:[n,t,i,s,c,r,d,l]}),url:"../managers/student_profile/geographic_api.php",success:function(e){console.log(e)},dataType:"json",cache:"false",error:function(e){console.log(e)}})})}(t)}),t.cancel_edition()},cancel_edition:function(){e("#span-icon-cancel-edit").hide(),e("#tip-cancel").hide(),e("#span-icon-save-profile").hide(),e("#tip-save").hide(),e("#span-icon-edit").show(),e("#tip-edit").show(),e("#tipo_doc").prop("disabled",!0),e("#num_doc").prop("readonly",!0),e("#email").prop("readonly",!0),e("#icetex_status").prop("disabled",!0),e("#genero").prop("disabled",!0),e("#sexo").prop("disabled",!0),e("#cond_excepcion").prop("disabled",!0),e("#act_simultanea").prop("disabled",!0),e("#etnia").prop("disabled",!0),e("#municipio_act").prop("disabled",!0),e("#estado_civil").prop("disabled",!0),e("#pais").prop("disabled",!0),e("#observacion").prop("readonly",!0),e(".select_statuses_program").prop("disabled",!0),e(".input_fields_general_tab").prop("readonly",!0),e(".input-tracking").prop("disabled",!0),e(".bt_delete_person").css("visibility","hidden")},revert_changes:function(a){for(field in a)e("#"+a[field].name).val(a[field].value);location.reload(!0)},edit_map:function(e,a){var t;document.getElementById("mapa").innerHTML="";var i=new google.maps.LatLng(3.3759493,-76.5355789),o={center:i,zoom:14},n=new google.maps.Map(document.getElementById("mapa"),o),r=new google.maps.Marker({position:i,map:n,title:"Universidad del Valle"}),s=new google.maps.InfoWindow;s.setContent("Universidad del Valle"),s.open(n,r);var l=new google.maps.Marker({position:{lat:parseFloat(e),lng:parseFloat(a)},map:n});t=new google.maps.Geocoder;var c=new google.maps.InfoWindow;return c.setContent("Residencia Estudiante"),c.open(n,l),google.maps.event.addListener(n,"click",function(e){t.geocode({latLng:e.latLng},function(a,t){t==google.maps.GeocoderStatus.OK?a[0]?(l?l.setPosition(e.latLng):l=new google.maps.Marker({position:e.latLng,map:n}),c.setContent(a[0].formatted_address+"<br/> Coordenadas: "+a[0].geometry.location),c.open(n,l)):console.log("No se encontraron resultados"):console.log("Geocodificación ha fallado debido a: "+t)})}),l}};function l(e){for(e=e.toLowerCase(),i=0;i<e.length;i++)if(-1!="abcdefghyjklmnñopqrstuvwxyz".indexOf(e.charAt(i),0))return 1;return 0}function c(e){for(i=0;i<e.length;i++)if(-1!="0123456789".indexOf(e.charAt(i),0))return 1;return 0}function d(e){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)?1:0}function u(){e("#date").datepicker({dateFormat:"yy-mm-dd"});for(var a=new Date,t=(a.getDate(),a.getMonth(),a.getFullYear(),a.getMinutes()),i=a.getHours(),o="",n=0;n<24;n++)n==i?(i<10&&(i="0"+i),o+='<option value="'+i+'" selected>'+i+"</option>"):o+=n<10?'<option value="0'+n+'">0'+n+"</option>":'<option value="'+n+'">'+n+"</option>";var r="";for(n=0;n<60;n++)n==t?(t<10&&(t="0"+t),r+='<option value="'+t+'" selected>'+t+"</option>"):r+=n<10?'<option value="0'+n+'">0'+n+"</option>":'<option value="'+n+'">'+n+"</option>";e("#h_ini").append(o),e("#m_ini").append(r),e("#h_fin").append(o),e("#m_fin").append(r),e("#infomonitor").addClass("hide"),e("#seguimiento").find("input:text, textarea").val(""),e("#seguimiento").find("input:radio,input:checkbox").prop("checked",!1),e("#upd_seg").attr("disabled",!1),e("#upd_seg").attr("title",""),e("#seguimiento").find("select, textarea, input").attr("disabled",!1),e("#no_value_individual").hide(),e("#no_value_familiar").hide(),e("#no_value_academic").hide(),e("#no_value_economic").hide(),e("#no_value_life").hide(),e("#id_tracking_peer").val(""),e("#place").val(""),e("#topic_textarea").val(""),e("#objetivos").val(""),e("#individual").val(""),e("#familiar").val(""),e("#academico").val(""),e("#economico").val(""),e("#vida_uni").val(""),e("#observaciones").val(""),e("#no_value_individual").prop("checked",!0),e("#no_value_familiar").prop("checked",!0),e("#no_value_academic").prop("checked",!0),e("#no_value_economic").prop("checked",!0),e("#no_value_life").prop("checked",!0)}function p(e){for(var a=[],t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var o=t[i].split("=");a[o[0]]=o[1]}return a}function m(e,a,t){return new s(a,{type:"line",data:{labels:e[1],datasets:[{label:"Nivel de riesgo",fill:!1,lineTension:0,pointBackgroundColor:e[2],data:e[3],backgroundColor:"black",borderColor:"black",borderWidth:3,pointRadius:5,pointHoverRadius:7}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,max:3,min:0}}]}}})}});