define(["jquery","block_ases/bootstrap","block_ases/datatables.net","block_ases/datatables.net-buttons","block_ases/buttons.flash","block_ases/jszip","block_ases/pdfmake","block_ases/buttons.html5","block_ases/buttons.print","block_ases/sweetalert","block_ases/select2","block_ases/jqueryui"],function(e,t,a,r,o,n,i,l,s,c,p,d){return{init:function(){function t(t,a,r){e.ajax({type:"POST",data:{course:t,element:a,type_e:r,type:"loadParentCat"},url:"../managers/grade_categories/grader_processing.php",success:function(t){e("#padre").html(t.html)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}function a(t,a,r){e.ajax({type:"POST",data:{type_ajax:"deleteElement",id:t,courseid:a,type:r},url:"../managers/grade_categories/grader_processing.php",success:function(e){e.error?swal("Error",e.error,"error"):(swal({title:"Listo",text:e.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200}),o(a))},dataType:"json",cache:"false",error:function(e){console.log(e)}})}function r(){for(var e=window.location.search.split("&"),t=0;t<e.length;t++){var a=e[t].split("=");if("?id_course"==a[0]||"id_course"==a[0])var r=a[1]}return r}function o(t){e.ajax({type:"POST",data:{course:t,type:"loadCat"},url:"../managers/grade_categories/grader_processing.php",success:function(t){e("#mymodalbody").html(t)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}function n(t,a){var n=e("#tipoItem").val(),p=r();if("CATEGORÍA"==n){if(c(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val(),m=i(e("#tipoCalificacion").prop("selectedIndex"));e.ajax({type:"POST",data:{course:p,parent:a,fullname:d,agregation:m,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("ÍTEM"==n){if(l(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val();e.ajax({type:"POST",data:{course:p,parent:a,fullname:d,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"item añadido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("PARCIAL"==n){if(s(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val();e.ajax({type:"POST",data:{course:p,parent:a,fullname:d,agregation:6,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}function i(e){switch(e){case 1:return 0;case 2:return 10}}function l(t){return""==e.trim(e("#inputNombre").val())?(swal({title:"Ingrese el nombre del ítem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1):10!=t||""!=e("#inputValor").val()||(swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1)}function s(t){return""==e.trim(e("#inputNombre").val())?(swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1):10!=t||""!=e("#inputValor").val()||(swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1)}function c(t){return 0==e("#tipoCalificacion").prop("selectedIndex")?(swal({title:"Seleccione el tipo de calificación de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1):""==e.trim(e("#inputNombre").val())?(swal({title:"Ingrese el nombre de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1):10!=t||""!=e("#inputValor").val()||(swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1)}var p;e(document).on("click","#wizard_button",function(){e("#modalCategories").modal({backdrop:!1}),e(".fondo").show(),id=r(),o(id)}),e(document).on("click",".mymodal-close",function(){location.reload(),e(".fondo").hide()}),e(document).on("click",".edit",function(){var a=e(this).attr("title");e("#titulo").text(a),e("#nombre_editar").show(),e("#label_nombre").show();var o=r(),n=e(this).attr("id");if(e("#save_edit").attr("name",n),"Editar Categoría"===a){e("#type_cal").show();var i=e(this).parent().parent().attr("id");e("#otro").hide(),10!=i&&0!=i&&6!=i&&(i=99,e("#otro").show()),e("#calific").prop("value",i);c="cat";if(-1==(d=e(this).parent().parent().text()).search("-")){nom_text=d.split("("),d=nom_text[0],l=nom_text[1],e("#peso").show(),l=(l=(l=(l=l.replace("(","")).replace(")","")).replace(" ","")).replace("%",""),p=l,e("#peso_editar").val(l);s=e(this).attr("data-maxweight");e(".maxweight-edit").attr("id",s)}else d=d.split("-")[0],e("#peso").hide()}else{e("#type_cal").hide();var l=e(this).parent().parent().prev().text();if("-"==l)e("#peso").hide(),e("#peso_editar").val(l);else{e("#peso").show(),l=(l=(l=(l=l.replace("(","")).replace(")","")).replace(" ","")).replace("%",""),e("#peso_editar").val(l);var s=e(this).parent().attr("id");e(".maxweight-edit").attr("id",s)}var c="it",d=e(this).parent().parent().prev().prev().attr("title");"Enlazar a la actividad Tarea"==d&&(e("#nombre_editar").hide(),e("#label_nombre").hide())}e("#nombre_editar").val(d),t(o,n,c),e("#edit").modal({backdrop:!1})}),e(document).on("click","#save_edit",function(){var t=e(this).attr("name"),a=e("#nombre_editar").val(),n=e("#peso_editar").val(),i=parseFloat(e(".maxweight-edit").attr("id"))+parseFloat(p),l=e("#calific").val(),s=e("#padre").val();if("-"==n&&(n=0),"99"==l&&(l=!1),n>i)swal({title:"Peso no valido.",text:"El peso ingresado supera el peso máximo posible de la categoria padre que es: "+i+"% \n Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else if(""!=a){"Ítem"==e("#titulo").text().split(" ")[1]?(type_e="it",l=!1):type_e="cat";var c=r();e.ajax({type:"POST",data:{course:c,element:t,type_e:type_e,newNombre:a,newPeso:n,newCalific:l,type:"editElement",parent:s},url:"../managers/grade_categories/grader_processing.php",success:function(t){t.error?swal("Error",t.error,"error"):(swal({title:"Listo",text:t.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1300}),e("#edit").modal("hide"),o(c),console.log(t))},dataType:"json",cache:"false",error:function(e){console.log(e)}})}else swal({title:"Ingrese el nuevo nombre del elemento",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}),e(document).on("click",".delete",function(){var t=e(this).parent().parent().parent().attr("id").split("_"),o=r(),n=t[1],i=t[0];if("cat"===i)l="esta categoría";else var l="este item";var s="Esta seguro que desea eliminar "+l+"?";swal({title:s,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+l,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?a(n,o,i):swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),e(document).on("click",".new",function(){if(e(this).parent().parent().children().next(".maxweight").attr("id")<=0)swal({title:"No se pueden crear mas categorías o ítems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de ésta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else{e(".new").prop("disabled",!0),e(".delete").prop("disabled",!0),e(".edit").prop("disabled",!0);var t=e("<div class = 'divForm'>");t.load("../templates/categories_form.html");var a=e(this).parent().parent();a.append('<hr style = "border-top: 1px solid #ddd">'),a.append(t),window.setTimeout(function(){10==a.attr("id")&&(e("#divPeso").show(),e("#inputValor").on("blur",function(){var t=e(this).val(),a=parseInt(e(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));(t<0||t>a)&&(swal({title:"El valor debe estar entre 0 y el peso máximo: "+a,text:"\n\rUsted ingresó: "+t,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),e(this).val(""))}),e("#inputValor").on("keypress",function(e){return tecla=document.all?e.keyCode:e.which,8==tecla||46==tecla||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),e("#tipoItem").on("change",function(){1==e(this).prop("selectedIndex")?e("#divTipeC").show():e("#divTipeC").hide()}),e("#save").on("click",function(){var t=e(this).parent().parent().parent().parent().attr("id"),a=e(this).parent().parent().parent().parent().parent().attr("id");n(t,a=a.split("_")[1])}),e("#cancel").on("click",function(){o(r())})},400)}})}}});