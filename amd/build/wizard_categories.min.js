'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui'],function(a){return{init:function init(){function g(r,s,t){a.ajax({type:'POST',data:{course:r,element:s,type_e:t,type:'loadParentCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(u){a('#padre').html(u.html)},dataType:'json',cache:'false',error:function error(u){console.log(u)}})}function h(r,s,t){a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:r,courseid:s,type:t},url:'../managers/grade_categories/grader_processing.php',success:function success(u){swal({title:'Listo',text:u.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1200}),k(s)},dataType:'json',cache:'false',error:function error(u){console.log(u)}})}function j(){for(var t,r=window.location.search.split('&'),s=0;s<r.length;s++)if(t=r[s].split('='),'?id_course'==t[0]||'id_course'==t[0])var u=t[1];return u}function k(r){a.ajax({type:'POST',data:{course:r,type:'loadCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(s){a('#mymodalbody').html(s)},dataType:'text',cache:'false',error:function error(s){console.log(s)}})}function l(r,s){var t=a('#tipoItem').val(),u=j();if('CATEGOR\xCDA'==t){if(p(r)){var v=a.trim(a('#inputNombre').val()),w=a('#inputValor').val(),x=m(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:u,parent:s,fullname:v,agregation:x,tipo:t,peso:w},url:'../managers/grade_categories/grader_processing.php',success:function success(y){1==y?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),k(u)):0==y&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if('\xCDTEM'==t){if(n(r)){var v=a.trim(a('#inputNombre').val()),w=a('#inputValor').val();a.ajax({type:'POST',data:{course:u,parent:s,fullname:v,tipo:t,peso:w},url:'../managers/grade_categories/grader_processing.php',success:function success(y){1==y?(swal({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),k(u)):0==y&&swal({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if(!('PARCIAL'==t))swal({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else if(o(r)){var v=a.trim(a('#inputNombre').val()),w=a('#inputValor').val();a.ajax({type:'POST',data:{course:u,parent:s,fullname:v,agregation:6,tipo:t,peso:w},url:'../managers/grade_categories/grader_processing.php',success:function success(y){1==y?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),k(u)):0==y&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}function m(r){switch(r){case 1:return 0;break;case 2:return 10;}}function n(r){var s=a.trim(a('#inputNombre').val());if(''==s)return swal({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==r){var t=a('#inputValor').val();if(''==t)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function o(r){var s=a.trim(a('#inputNombre').val());if(''==s)return swal({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==r){var t=a('#inputValor').val();if(''==t)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function p(r){if(0==a('#tipoCalificacion').prop('selectedIndex'))return swal({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;var s=a.trim(a('#inputNombre').val());if(''==s)return swal({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==r){var t=a('#inputValor').val();if(''==t)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}else;return!0}var q;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show(),id=j(),k(id)}),a(document).on('click','.mymodal-close',function(){location.reload(),a('.fondo').hide()}),a(document).on('click','.edit',function(){var r=a(this).attr('title');a('#titulo').text(r),a('#nombre_editar').show(),a('#label_nombre').show();var s=j(),t=a(this).attr('id');if(a('#save_edit').attr('name',t),'Editar Categor\xEDa'===r){a('#type_cal').show();var u=a(this).parent().parent().attr('id');a('#otro').hide(),10!=u&&0!=u&&6!=u&&(u=99,a('#otro').show()),a('#calific').prop('value',u);var v='cat',w=a(this).parent().parent().text();if(-1==w.search('-')){nom_text=w.split('('),w=nom_text[0],y=nom_text[1],a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),q=y,a('#peso_editar').val(y);var x=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',x)}else w=w.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var y=a(this).parent().parent().prev().text();if('-'==y)a('#peso').hide(),a('#peso_editar').val(y);else{a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),q=y,a('#peso_editar').val(y);var x=a(this).parent().attr('id');a('.maxweight-edit').attr('id',x)}var v='it',w=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==w&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(w),g(s,t,v),a('#edit').modal({backdrop:!1})}),a(document).on('click','#save_edit',function(){var r=a(this).attr('name'),s=a('#nombre_editar').val(),t=a('#peso_editar').val(),u=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(q),v=a('#calific').val(),w=a('#padre').val();if('-'==t&&(t=0),'99'==v)return void swal({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(t>u)return void swal({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+u+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(''==s)return void swal({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:'#d51b23'});var x=a('#titulo').text();'\xCDtem'==x.split(' ')[1]?(type_e='it',v=!1):type_e='cat';var y=j();a.ajax({type:'POST',data:{course:y,element:r,type_e:type_e,newNombre:s,newPeso:t,newCalific:v,type:'editElement',parent:w},url:'../managers/grade_categories/grader_processing.php',success:function success(z){z.error?swal('Error',z.error,'error'):(swal({title:'Listo',text:z.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),k(y),console.log(z))},dataType:'json',cache:'false',error:function error(z){console.log('AJAXerror'),console.log(z)}})}),a(document).on('click','.delete',function(){var r=a(this).parent().parent().parent().attr('id').split('_'),s=j(),t=r[1],u=r[0];if('cat'===u)var v='esta categor\xEDa';else var v='este item';swal({title:'Esta seguro que desea eliminar '+v+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+v,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(x){x?h(t,s,u):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on('click','.new',function(){var r=a(this).parent().parent().children().next('.maxweight').attr('id');if(0>=r)return void swal({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var s=a('<div class = \'divForm\'>');s.load('../templates/categories_form.html');var t=a(this).parent().parent();t.append('<hr style = "border-top: 1px solid #ddd">'),t.append(s),window.setTimeout(function(){var u=t.attr('id');10==u&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var v=a(this).val(),w=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>v||v>w)&&(swal({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+w,text:'\n\rUsted ingres\xF3: '+v,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),a(this).val(''))}),a('#inputValor').on('keypress',function(v){return!(tecla=document.all?v.keyCode:v.which,8!=tecla&&46!=tecla)||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),a('#tipoItem').on('change',function(){var v=a(this).prop('selectedIndex');1==v?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var v=a(this).parent().parent().parent().parent().attr('id'),w=a(this).parent().parent().parent().parent().parent().attr('id');w=w.split('_')[1],l(v,w)}),a('#cancel').on('click',function(){var v=j();k(v)})},400)})}}});