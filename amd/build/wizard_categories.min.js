'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui'],function(a){return{init:function init(){function f(q,r,s){a.ajax({type:'POST',data:{course:q,element:r,type_e:s,type:'loadParentCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(t){a('#padre').html(t.html)},dataType:'json',cache:'false',error:function error(t){console.log(t)}})}function g(q,r,s){a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:q,courseid:r,type:s},url:'../managers/grade_categories/grader_processing.php',success:function success(t){swal({title:'Listo',text:t.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1200}),j(r)},dataType:'json',cache:'false',error:function error(t){console.log(t)}})}function h(){for(var s,q=window.location.search.split('&'),r=0;r<q.length;r++)if(s=q[r].split('='),'?id_course'==s[0]||'id_course'==s[0])var t=s[1];return t}function j(q){a.ajax({type:'POST',data:{course:q,type:'loadCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(r){a('#mymodalbody').html(r)},dataType:'text',cache:'false',error:function error(r){console.log(r)}})}function k(q,r){var s=a('#tipoItem').val(),t=h();if('CATEGOR\xCDA'==s){if(o(q)){var u=a.trim(a('#inputNombre').val()),v=a('#inputValor').val(),w=l(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:t,parent:r,fullname:u,agregation:w,tipo:s,peso:v},url:'../managers/grade_categories/grader_processing.php',success:function success(x){1==x?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),j(t)):0==x&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if('\xCDTEM'==s){if(m(q)){var u=a.trim(a('#inputNombre').val()),v=a('#inputValor').val();a.ajax({type:'POST',data:{course:t,parent:r,fullname:u,tipo:s,peso:v},url:'../managers/grade_categories/grader_processing.php',success:function success(x){1==x?(swal({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),j(t)):0==x&&swal({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if(!('PARCIAL'==s))swal({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else if(n(q)){var u=a.trim(a('#inputNombre').val()),v=a('#inputValor').val();a.ajax({type:'POST',data:{course:t,parent:r,fullname:u,agregation:6,tipo:s,peso:v},url:'../managers/grade_categories/grader_processing.php',success:function success(x){1==x?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),j(t)):0==x&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}function l(q){switch(q){case 1:return 0;break;case 2:return 10;}}function m(q){var r=a.trim(a('#inputNombre').val());if(''==r)return swal({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==q){var s=a('#inputValor').val();if(''==s)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function n(q){var r=a.trim(a('#inputNombre').val());if(''==r)return swal({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==q){var s=a('#inputValor').val();if(''==s)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function o(q){if(0==a('#tipoCalificacion').prop('selectedIndex'))return swal({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;var r=a.trim(a('#inputNombre').val());if(''==r)return swal({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==q){var s=a('#inputValor').val();if(''==s)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}else;return!0}var p;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show(),id=h(),j(id)}),a(document).on('click','.mymodal-close',function(){location.reload(),a('.fondo').hide()}),a(document).on('click','.edit',function(){var q=a(this).attr('title');a('#titulo').text(q);var r=!1;a('#nombre_editar').show(),a('#label_nombre').show(),a('#alta').show(),a('#div_padres').show(),a(this).hasClass('curso')&&(r=!0,a('#alta').hide(),console.log('CURSO'),a('#nombre_editar').hide(),a('#label_nombre').hide(),a('#div_padres').hide());var s=h(),t=a(this).attr('id');if(a('#save_edit').attr('name',t),'Editar Categor\xEDa'===q){a('#type_cal').show();var u=a(this).parent().parent().attr('id');a('#otro').hide(),10!=u&&0!=u&&6!=u&&(u=99,a('#otro').show()),a('#calific').prop('value',u);var v='cat',w=a(this).parent().parent().text();if(-1==w.search('-')){nom_text=w.split('('),w=nom_text[0],y=nom_text[1],r||a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),p=y,a('#peso_editar').val(y);var x=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',x)}else w=w.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var y=a(this).parent().parent().prev().text();if('-'==y)a('#peso').hide(),a('#peso_editar').val(y);else{a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),p=y,a('#peso_editar').val(y);var x=a(this).parent().attr('id');a('.maxweight-edit').attr('id',x)}var v='it',w=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==w&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(w),f(s,t,v),a('#edit').modal({backdrop:!1})}),a(document).on('click','#save_edit',function(){var q=a(this).attr('name'),r=a('#nombre_editar').val(),s=a('#peso_editar').val(),t=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(p),u=a('#calific').val(),v=a('#padre').val();if('-'==s&&(s=0),'99'==u)return void swal({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(console.log('nombre: '+r+'\n peso:'+s+'\n MAXpeso:'+t+'\n new_calif: '+u),s>t)return void swal({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+t+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(''==r)return void swal({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:'#d51b23'});var w=a('#titulo').text();'\xCDtem'==w.split(' ')[1]?(type_e='it',u=!1):type_e='cat';var x=h();a.ajax({type:'POST',data:{course:x,element:q,type_e:type_e,newNombre:r,newPeso:s,newCalific:u,type:'editElement',parent:v},url:'../managers/grade_categories/grader_processing.php',success:function success(y){y.error?swal('Error',y.error,'error'):(swal({title:'Listo',text:y.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),j(x),console.log(y))},dataType:'json',cache:'false',error:function error(y){console.log('AJAXerror'),console.log(y)}})}),a(document).on('click','.delete',function(){var q=a(this).parent().parent().parent().attr('id').split('_'),r=h(),s=q[1],t=q[0];if('cat'===t)var u='esta categor\xEDa';else var u='este item';swal({title:'Esta seguro que desea eliminar '+u+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+u,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(w){w?g(s,r,t):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on('click','.new',function(){var q=a(this).parent().parent().children().next('.maxweight').attr('id');if(0>=q)return void swal({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var r=a('<div class = \'divForm\'>');r.load('../templates/categories_form.html');var s=a(this).parent().parent();s.append('<hr style = "border-top: 1px solid #ddd">'),s.append(r),window.setTimeout(function(){var t=s.attr('id');10==t&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var u=a(this).val(),v=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>u||u>v)&&(swal({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+v,text:'\n\rUsted ingres\xF3: '+u,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),a(this).val(''))}),a('#inputValor').on('keypress',function(u){return!(tecla=document.all?u.keyCode:u.which,8!=tecla&&46!=tecla)||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),a('#tipoItem').on('change',function(){var u=a(this).prop('selectedIndex');1==u?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var u=a(this).parent().parent().parent().parent().attr('id'),v=a(this).parent().parent().parent().parent().parent().attr('id');v=v.split('_')[1],k(u,v)}),a('#cancel').on('click',function(){var u=h();j(u)})},400)})}}});