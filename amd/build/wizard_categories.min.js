'use strict';define(['jquery','block_ases/bootstrap','block_ases/datatables.net','block_ases/datatables.net-buttons','block_ases/buttons.flash','block_ases/jszip','block_ases/pdfmake','block_ases/buttons.html5','block_ases/buttons.print','block_ases/sweetalert','block_ases/select2','block_ases/jqueryui'],function(a){return{init:function init(){function o(y,z,A){a.ajax({type:'POST',data:{course:y,element:z,type_e:A,type:'loadParentCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(B){a('#padre').html(B.html)},dataType:'json',cache:'false',error:function error(B){console.log(B)}})}function p(y,z,A){a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:y,courseid:z,type:A},url:'../managers/grade_categories/grader_processing.php',success:function success(B){swal({title:'Listo',text:B.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1200}),r(z)},dataType:'json',cache:'false',error:function error(B){console.log(B)}})}function q(){for(var A,y=window.location.search.split('&'),z=0;z<y.length;z++)if(A=y[z].split('='),'?id_course'==A[0]||'id_course'==A[0])var B=A[1];return B}function r(y){a.ajax({type:'POST',data:{course:y,type:'loadCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(z){a('#mymodalbody').html(z)},dataType:'text',cache:'false',error:function error(z){console.log(z)}})}function s(y,z){var A=a('#tipoItem').val(),B=q();if('CATEGOR\xCDA'==A){if(w(y)){var C=a.trim(a('#inputNombre').val()),D=a('#inputValor').val(),E=t(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:B,parent:z,fullname:C,agregation:E,tipo:A,peso:D},url:'../managers/grade_categories/grader_processing.php',success:function success(F){1==F?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),r(B)):0==F&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if('\xCDTEM'==A){if(u(y)){var C=a.trim(a('#inputNombre').val()),D=a('#inputValor').val();a.ajax({type:'POST',data:{course:B,parent:z,fullname:C,tipo:A,peso:D},url:'../managers/grade_categories/grader_processing.php',success:function success(F){1==F?(swal({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),r(B)):0==F&&swal({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if(!('PARCIAL'==A))swal({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else if(v(y)){var C=a.trim(a('#inputNombre').val()),D=a('#inputValor').val();a.ajax({type:'POST',data:{course:B,parent:z,fullname:C,agregation:6,tipo:A,peso:D},url:'../managers/grade_categories/grader_processing.php',success:function success(F){1==F?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),r(B)):0==F&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}function t(y){switch(y){case 1:return 0;break;case 2:return 10;}}function u(y){var z=a.trim(a('#inputNombre').val());if(''==z)return swal({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==y){var A=a('#inputValor').val();if(''==A)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function v(y){var z=a.trim(a('#inputNombre').val());if(''==z)return swal({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==y){var A=a('#inputValor').val();if(''==A)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function w(y){if(0==a('#tipoCalificacion').prop('selectedIndex'))return swal({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;var z=a.trim(a('#inputNombre').val());if(''==z)return swal({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==y){var A=a('#inputValor').val();if(''==A)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}else;return!0}var x;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show(),id=q(),r(id)}),a(document).on('click','.mymodal-close',function(){location.reload(),a('.fondo').hide()}),a(document).on('click','.edit',function(){var y=a(this).attr('title');a('#titulo').text(y),a('#nombre_editar').show(),a('#label_nombre').show();var z=q(),A=a(this).attr('id');if(a('#save_edit').attr('name',A),'Editar Categor\xEDa'===y){a('#type_cal').show();var B=a(this).parent().parent().attr('id');a('#otro').hide(),10!=B&&0!=B&&6!=B&&(B=99,a('#otro').show()),a('#calific').prop('value',B);var C='cat',D=a(this).parent().parent().text();if(-1==D.search('-')){nom_text=D.split('('),D=nom_text[0],F=nom_text[1],a('#peso').show(),F=F.replace('(',''),F=F.replace(')',''),F=F.replace(' ',''),F=F.replace('%',''),x=F,a('#peso_editar').val(F);var E=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',E)}else D=D.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var F=a(this).parent().parent().prev().text();if('-'==F)a('#peso').hide(),a('#peso_editar').val(F);else{a('#peso').show(),F=F.replace('(',''),F=F.replace(')',''),F=F.replace(' ',''),F=F.replace('%',''),x=F,a('#peso_editar').val(F);var E=a(this).parent().attr('id');a('.maxweight-edit').attr('id',E)}var C='it',D=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==D&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(D),o(z,A,C),a('#edit').modal({backdrop:!1})}),a(document).on('click','#save_edit',function(){var y=a(this).attr('name'),z=a('#nombre_editar').val(),A=a('#peso_editar').val(),B=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(x),C=a('#calific').val(),D=a('#padre').val();if('-'==A&&(A=0),'99'==C)return void swal({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(A>B)return void swal({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+B+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(''==z)return void swal({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:'#d51b23'});var E=a('#titulo').text();'\xCDtem'==E.split(' ')[1]?(type_e='it',C=!1):type_e='cat';var F=q();a.ajax({type:'POST',data:{course:F,element:y,type_e:type_e,newNombre:z,newPeso:A,newCalific:C,type:'editElement',parent:D},url:'../managers/grade_categories/grader_processing.php',success:function success(G){G.error?swal('Error',G.error,'error'):(swal({title:'Listo',text:G.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),r(F),console.log(G))},dataType:'json',cache:'false',error:function error(G){console.log('AJAXerror'),console.log(G)}})}),a(document).on('click','.delete',function(){var y=a(this).parent().parent().parent().attr('id').split('_'),z=q(),A=y[1],B=y[0];if('cat'===B)var C='esta categor\xEDa';else var C='este item';swal({title:'Esta seguro que desea eliminar '+C+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+C,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(E){E?p(A,z,B):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on('click','.new',function(){var y=a(this).parent().parent().children().next('.maxweight').attr('id');if(0>=y)return void swal({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var z=a('<div class = \'divForm\'>');z.load('../templates/categories_form.html');var A=a(this).parent().parent();A.append('<hr style = "border-top: 1px solid #ddd">'),A.append(z),window.setTimeout(function(){var B=A.attr('id');10==B&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var C=a(this).val(),D=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>C||C>D)&&(swal({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+D,text:'\n\rUsted ingres\xF3: '+C,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),a(this).val(''))}),a('#inputValor').on('keypress',function(C){return!(tecla=document.all?C.keyCode:C.which,8!=tecla&&46!=tecla)||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),a('#tipoItem').on('change',function(){var C=a(this).prop('selectedIndex');1==C?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var C=a(this).parent().parent().parent().parent().attr('id'),D=a(this).parent().parent().parent().parent().parent().attr('id');D=D.split('_')[1],s(C,D)}),a('#cancel').on('click',function(){var C=q();r(C)})},400)})}}});