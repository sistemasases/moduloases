'use strict';define(['jquery','block_ases/jscookie'],function(a,b){function c(j){a.ajax({type:'POST',url:'../managers/incident_manager/incident_api.php',data:JSON.stringify({'function':'get_ids_open_incidents',params:[]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(k){'function'==typeof j&&j(k.data_response)},failure:function failure(){}})}function d(j){0<j?a('title').text('('+j+') '+h):a('title').text(h)}function e(){if('true'==b.get('beep')){var j='notification_sound';document.getElementById('notification_sound').innerHTML='<audio autoplay="autoplay">'+('<source src="../resources/'+j+'.mp3" type="audio/mpeg">')+('<source src="../resources/'+j+'.ogg" type="audio/ogg">')+('<embed hidden="true" autostart="true" loop="false" src="../resources/'+j+'.mp3">')+'</audio>',b.set('beep','false')}}var f=!1,g=[],h=a('title').text();a('html').append('<div id="notification_sound" style="display:none;"></div>');var i=a('#menu_incidents_manager').find('.menu_a');return console.log('Incident notifier initialised'),{init:function init(){i.length&&(c(function(j){var k=j.length;d(k),0<k&&(f=!0,j.forEach(function(l){g.push(l.id)}),i.append(' <span id="incidents_counter" class="badge badge-secondary">'+j.length+'</span>'))}),setInterval(function(){c(function(j){var k=!1,l=j.length;if(d(l),0<l&&!f)f=!0,k=!0,b.set('beep',k),i.append(' <span id="incidents_counter" class="badge badge-secondary">'+j.length+'</span>');else if(0<l&&f){var m=!1,n=[];j.forEach(function(o){n.push(o.id),-1===g.indexOf(o.id)&&(m=!0)}),m&&(g=n,k=!0,b.set('beep',k),a('#incidents_counter').text(j.length))}else 0===l&&a('#incidents_counter').remove();k&&(e(),k=!1)})},3e3))}}});