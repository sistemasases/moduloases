'use strict';define(['jquery','block_ases/sweetalert','block_ases/jqueryui','block_ases/loading_indicator'],function(a,b,c,d){return a('head').append('<style>'+'            #ases_incident_system_box {                padding: 0.5em;                color:white;                cursor:pointer;                background-color:#d51b23;                position: fixed;                bottom: 0px;                left: 0px;                z-index: 9999;                height: 30px;            }            #incident_box {                position: fixed;                bottom: 0px;                left: 0px;                z-index: 9999;                height: 400px;                border:1px solid #d51b23;                width: 400px;                background-color:white;                display:none;            }            .inc_header{                height: 30px;                background-color:#d51b23;                padding: 0.5em;                color:white;            }            .inc_body{                padding: 0.7em;            }            #close_incident_box{                float:right;                cursor:pointer;            }            #new_inc{                width: 100%;            }            #inc_detail{                width: 100%;            }            #inc_registrar{                background-color:#d51b23;                color:white;                padding: 0.3em;                float:right;                margin-top:0.5em;            }            #inc_registrar:hover{                background-color:whitesmoke;                color:black;            }            .inc_item{                cursor:pointer;            }            .inc_item > .status-icon{                float:left;                margin-right:0.3em;            }            .inc_item > .remove-icon{                float:right;                color:gray            }            .inc_item > .remove-icon:hover{                color:black            }            .inc_item:hover{                background-color:whitesmoke;            }            #old_inc_body{                overflow-y: auto;                height:130px;            }          '+'</style>'),a('body').append('            <div                 id="ases_incident_system_box"                title="Reporte de incidencias">                <i id="inc_icon" class="glyphicon glyphicon-wrench ases-glyphicon ases-glyphicon-wrench"></i>                <span id="inc_text"><strong>Incidencias</strong></span>            </div>            '),a('body').append('            <div id="incident_box" >                <div class="inc_header">                    <i class="glyphicon glyphicon-wrench ases-glyphicon ases-glyphicon-wrench"></i>                    <span><strong>Incidencias</strong></span>                    <i id="close_incident_box" class="glyphicon glyphicon-remove ases-glyphicon ases-glyphicon-remove"></i>                </div>                <div class="inc_body">                    <div id="prev_inc_selector">                    </div>                    <div id="new_inc">                        <span><strong>Registro de nueva incidencia</strong></span>                        <hr style="margin:5px;">                        <input id="inc_title" class="form-control ases-form-control" placeholder="T\xEDtulo corto" type="text">                        <textarea id="inc_detail" class="form-control ases-form-control" name="" placeholder="Descripci\xF3n detallada de la incidencia" cols="" rows="2"></textarea>                        <a id="inc_registrar" href="javascript:void(0)">Registrar</a>                    </div>                    <hr style="margin-bottom:5px;margin-top:50px;">                    <div id="old_inc">                        <span><strong>Incidencias previas</strong></span>                    </div>                    <hr style="margin:5px;">                    <div id="old_inc_body">                    </div>                    <hr style="margin:5px;">                </div>            </div>            '),console.log('ases_incident_system loaded'),{init:function init(){function i(){d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'get_logged_user_incidents',params:[]}),success:function success(j){d.hide();var k='';j.data_response.forEach(function(l){var n=JSON.parse(l.estados),o={change_order:-1,status:''};n.forEach(function(t){o.change_order<parseInt(t.change_order)&&(o=t)});var p=null,q=null,r=JSON.parse(l.comentarios);r.forEach(function(t){if(0==parseInt(t.message_number))return p=t.message.title,void(q=t.message.commentary)});var s='';'solved'!=o.status&&(s='<i class="remove-icon glyphicon glyphicon-remove-sign ases-glyphicon ases-glyphicon-remove-sign" data-id="'+l.id+'" title="Eliminar"></i>'),k+='                                    <div class="inc_item col-xs-12 col-sm-12 col-md-12 col-lg-12 ases-col-xs-12 ases-col-sm-12 ases-col-md-12 ases-col-lg-12">                                        <i class="status-icon glyphicon glyphicon-record ases-glyphicon ases-glyphicon-record" style="color:'+{solved:'#239f07',waiting:'#ff9a00',closed:'#000'}[o.status]+'" title="'+o.status+'"></i>                                        '+s+'                                        <div class="item-title" data-id="'+l.id+'" data-title="'+p+'" data-detail="'+q+'">#'+l.id+' - '+p+'</div>                                    </div>                                    '}),a('#old_inc_body').html(''),a('#old_inc_body').append(k)},error:function error(j,k,l){d.hide(),console.log('some error '+k+' '+l),console.log(j)}})}a(document).ready(function(){i(),setInterval(function(){a('#inc_text').fadeOut(700)},3e3)}),a(document).on('click','#ases_incident_system_box',function(){a('#ases_incident_system_box').hide(0),a('#incident_box').show(100)}),a(document).on('click','#close_incident_box',function(){a('#incident_box').hide(),a('#ases_incident_system_box').show(100)}),a(document).on('click','.item-title',function(){var j=a(this).data('id'),k=a(this).data('title'),l=a(this).data('detail');swal({html:!0,title:'Ticket #'+j,text:'<span style="font-size:1.5em;">'+k+'</span><br><br>                                   <strong>Detalle:</strong>'+l+'<br>',type:'info'})}),a(document).on('click','.remove-icon',function(){var j=a(this).data('id');swal({html:!0,title:'Confirmaci\xF3n',text:'<strong>Nota importante!</strong>: Est\xE1 cerrando una incidencia que aun no est\xE1 resuelta.',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, cerrar!'},function(k){k&&(d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'close_logged_user_incident',params:[j]}),success:function success(l){d.hide(),i(),0===l.status_code?swal('\xC9xito!','Se ha cerrado correctamente la incidencia','success'):swal('Error!','Oops!: Al parece no existe la incidencia','error')},error:function error(l,m,n){d.hide(),console.log('some error '+m+' '+n),console.log(l)}}))})}),a(document).on('click','#inc_registrar',function(){var j=a('html').html(),k={title:a('#inc_title').val(),commentary:a('#inc_detail').val()};''!=k.title&&''!=k.commentary?(d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'create_incident',params:[k,j]}),success:function success(l){d.hide(),0===l.status_code?(swal('\xC9xito!','Se ha registrado correctamente la incidencia, ticket #'+l.data_response,'success'),i()):swal('Error!','Oops!: '+l.data_response,'error')},error:function error(l,m,n){d.hide(),console.log('some error '+m+' '+n),console.log(l)}})):swal('Oops!','Verifica que tanto el t\xEDtulo como la descripci\xF3n no est\xE9n vac\xEDos.','warning')})}}});