'use strict';define(['jquery','core/notification','block_ases/global_grade_book','core/templates','block_ases/jquery.dataTables'],function(a,b,c,e){return{init:function init(){a(document).ready(function(){})},load_report:function load_report(f){function g(){a('.gradeparent').parent().css('background','#cccccc')}function h(v,w){var x=[],y;for(y=0;y<w.length;y++)v.includes(w[y])&&x.push(y);return x}function k(v){a('#tableFinalgradesReport th').each(function(w){a(this).attr('title',v[w].description)})}function l(){a('#tableFinalgradesReport tbody').on('click','td.details-control',function(){var v=a(this).closest('tr'),w=u.row(v);if(w.child.isShown())w.child.hide(),v.removeClass('shown');else{w.child('<img class="icon-loading" src="../icon/loading.gif"/>').show();var x=function(y,z){y.child(z).show(),c.read_only_view_styles(),g()};n(w,x,v),v.addClass('shown')}})}function n(v,w,x){var y=v.data(),z={function:'grade_table',params:{course_id:y.curso_id,course_caller_id:q,instance_id:r}};a.ajax({method:'POST',url:'../managers/grades/grades_api.php',data:z,dataType:'html'}).fail(function(A){b.alert('Error, debe informar a un programador, adjunte esta informaci\xF3n',A.responseText,'Aceptar'),x.removeClass('shown')}).done(function(A){w(v,A)})}a('#tableFinalgradesReport').html('<img class="icon-loading" src="../icon/loading.gif"/>');var o=function(){function v(w,x,y){this.cursos_al_un_est_ases=w?w:0,this.cursos_al_item_calif=x?x:0,this.cursos_al_un_item=y?y:0}return v.return_critic_and_no_critic_report=function(w){for(var B,x=new v,y=new v,z=0,A=w;z<A.length;z++){if(B=A[z],0<B.items_con_almenos_una_nota)switch(B.critica){case'SI':y.cursos_al_item_calif++;break;case'NO':x.cursos_al_item_calif++;}if(0<B.cantidad_items)switch(B.critica){case'SI':y.cursos_al_un_item++;break;case'NO':x.cursos_al_un_item++;}if(0<B.cantidad_estudiantes_ases)switch(B.critica){case'SI':y.cursos_al_un_est_ases++;break;case'NO':x.cursos_al_un_est_ases++;}}return{critic_report:y,no_critic_report:x}},v}(),p={},q=f.course_id,r=f.instance_id,t=['critica','nombre_profesor'],u=null;(function(){a.ajax({method:'GET',url:'../managers/course_and_teacher_report/course_and_teacher_report_api.php/'+r,dataType:'json'}).done(function(v){p=o.return_critic_and_no_critic_report(v.data),e.render('block_ases/course_and_teacher_report_summary',{resume_report:p}).then(function(w,x){e.appendNodeContents('.course_and_teacher_report .summary',w,x)}).fail(function(){}),u=a('#tableFinalgradesReport').DataTable({data:v.data,bsort:v.bsort,columns:v.columns,language:v.language,order:v.order,initComplete:function initComplete(){var w=v.columns.map(function(y){return y.name?y.name:null}),x=h(t,w);this.api().columns(x).every(function(){var y=this,z=a('<select><option value=""></option></select>').appendTo(a(y.header())).on('change',function(){var A=a.fn.dataTable.util.escapeRegex(a(this).val());y.search(A?'^'+A+'$':'',!0,!1).draw()});y.data().unique().sort().each(function(A){z.append('<option value="'+A+'">'+A+'</option>')})})}}),k(v.columns),l()}).fail(function(v){console.log(v)})})()}}});