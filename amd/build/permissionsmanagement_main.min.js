define(["jquery","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e){return{init:function(){function b(){a("#profiles_user").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0,placeholder:"Seleccionar perfil"})}function c(){var b=a("#nombre").val().trim(),c=a("#descripcion").val().trim(),d=a("#functions").val(),e="";0==b.length&&(e="Nombre no puede ser nulo"),0==c.length&&(e+="\nDescripcion no puede ser nulo"),0==d.length&&(e+="\nFuncionalidad no puede ser nulo"),0==b.length||0==c.length?alert(e):a.ajax({type:"POST",data:{nombre:b,descripcion:c,id_funcionalidad:d},url:"../managers/ActionCreateAction.php",async:!1,success:function(b){a("#formAction")[0].reset(),alert(b)}})}function d(){var b=a("#nombre_funcionalidad").val().trim(),c=a("#descripcion_funcionalidad").val().trim(),d="";0==b.length&&(d="Nombre no puede ser nulo"),0==c.length&&(d+="\nDescripcion no puede ser nulo"),0==b.length||0==c.length?alert(d):a.ajax({type:"POST",data:{nombre_funcionalidad:b,descripcion_funcionalidad:c},url:"../managers/ActionCreateAction.php",success:function(b){a("#formFuncion")[0].reset(),alert(b)}})}function e(){var b=a("#nombre_perfil").val().trim(),c=a("#descripcion_perfil").val().trim(),d="";0==b.length&&(d="Nombre del perfil no puede ser nulo"),0==c.length&&(d+="\nDescripcion del perfil no puede ser nulo"),0==b.length||0==c.length?alert(d):a.ajax({type:"POST",data:{nombre_perfil:b,descripcion_perfil:c},url:"../managers/ActionCreateAction.php",async:!1,success:function(b){a("#formPerfil")[0].reset(),alert(b)}})}function f(b){var c=a("#profiles_user").val(),d=[],e=(a("input[name='actions[]']:checked").each(function(){d.push(a(this).val())}),JSON.stringify(d));""==c?swal({title:"Error",text:"Seleccione el rol del usuario",type:"error",confirmButtonColor:"#d51b23"}):a.ajax({type:"POST",data:{profile:c,actions:e,"function":"assign_role",instance:b},url:"../managers/ActionCreateAction.php",async:!1,success:function(a){alert(a)}})}function g(b,c){a.ajax({type:"POST",data:{id:b,source:"delete_record",type:c},url:"../managers/permissions_management/permissions_report.php",success:function(a){swal({title:a.title,html:!0,text:a.text,type:a.type,confirmButtonColor:"#d51b23"}),k(),l(n)},dataType:"json",cache:"false",error:function(a){alert("Error al eliminar registro")}})}function h(){a.ajax({type:"POST",url:"../managers/permissions_management/load_function.php",success:function(b){a("#div_functions").empty(),a("#div_functions").append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableFunctions").DataTable(b);a("#div_functions #modify_function").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){alert("Error al cargar funcionalidades")}})}function i(){a.ajax({type:"POST",url:"../managers/permissions_management/load_actions.php",success:function(b){a("#div_actions").empty(),a("#div_actions").append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableActions").DataTable(b);a("#div_actions #delete_action").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){alert("Error al cargar acciones")}})}function j(){a.ajax({type:"POST",url:"../managers/permissions_management/load_profiles.php",success:function(b){a("#div_profiles").empty(),a("#div_profiles").append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableProfiles").DataTable(b);a("#div_profiles #delete_profiles").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){alert("Error al cargar roles")}})}function k(){a.ajax({type:"POST",data:{source:"update_functionality_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(b){a("#funct1").html(b[0]),a("#funct2").html(b[1])},error:function(a){alert("Error actualizar las funcionalidades")}})}function l(b){a.ajax({type:"POST",data:{source:"update_general_table",instance:b},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(b){a("#lista_funcionalidades").html(b)},error:function(a){alert("Error actualizar tabla de asignación de permisos y roles")}})}function m(){a.ajax({type:"POST",data:{source:"update_role_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(c){a("#profiles_user").html(c),b()},error:function(a){alert("Error actualizar roles")}})}b(),a("#profiles_prof").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"40%",dropdownAutoWidth:!0}),a("#actions").select2({dropdownAutoWidth:!0,width:"100%",multiple:!0,language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0});var n;a(document).ready(function(){for(var b=window.location.search.split("&"),g=0;g<b.length;g++){var o=b[g].split("=");"?instanceid"!=o[0]&&"instanceid"!=o[0]||(n=o[1])}i(),h(),j(),a("#add_accion").on("click",function(){c(),i(),l(n)}),a("#add_function").on("click",function(){d(),h(),l(n),k()}),a("#add_profile").on("click",function(){e(),j(),m()}),a("#assign_user_profile").on("click",function(){f(n)})}),a("input[name='actions[]']").change(function(){a(this).attr("checked",!0)}),a("#profiles_user").change(function(){var b=a("#profiles_user").val(),c="permissions_management";a.ajax({type:"POST",data:{user:b,source:c},url:"../managers/permissions_management/permissions_report.php",success:function(b){a("input[name='actions[]'").prop("checked",!1),a.each(b,function(b,c){a("input[value='"+c+"']").prop("checked",!0)})},dataType:"json",cache:"false",error:function(a){alert("Error al cargar gestion de permisos y roles")}})}),a("body").on("click","tbody tr td .red.glyphicon.glyphicon-pencil",function(){var b=a(this).parents().eq(3).attr("id"),c=a("#"+b).DataTable(),d=c.cell(c.row(a(this).parent()).index(),0).data(),e=c.cell(c.row(a(this).parent()).index(),1).data(),f=c.cell(c.row(a(this).parent()).index(),2).data();a("#nombre_editar").val(d),a("#descripcion_editar").val(e),"tableActions"==b?(a(".form-pilos.func").removeClass("hide"),a("#save_seg").attr("name",this.id+"_accion"),a("#functions_table option").filter(function(){return a(this).text()==f}).prop("selected",!0)):"tableFunctions"==b?(a("#save_seg").attr("name",this.id+"_funcionalidad"),a(".form-pilos.func").addClass("hide")):(a("#save_seg").attr("name",this.id+"_rol"),a(".form-pilos.func").addClass("hide"))}),a(document).on("click","#save_seg",function(){var b=this.name.split("_"),c=b[0],d=b[1],e=a("#nombre_editar").val(),f=a("#descripcion_editar").val(),g="";"accion"==d&&(g=a("#functions_table").val()),a.ajax({type:"POST",data:{id:c,table:d,source:"modify_register",nombre:e,descripcion:f,funcionalidad:g},url:"../managers/permissions_management/permissions_report.php",success:function(a){swal({title:a.title,html:!0,text:a.text,type:a.type,confirmButtonColor:"#d51b23"}),i(),h(),j(),k(),l(n),m()},dataType:"json",cache:"false",error:function(a){swal({title:"Error",html:!0,text:"Se presento un inconveniente al modificar registro",type:"error",confirmButtonColor:"#d51b23"})}})}),a("#div_actions").on("click","#delete_action",function(){var b=a("#div_actions #tableActions").DataTable(),c=a(this).parent(),d=a(this).children("span").attr("id"),e=(b.cell(c).index().column,b.cell(b.row(c).index(),0).data());b.cell(b.row(c).index(),1).data();swal({title:"Estas seguro/a?",text:"La acción <strong>"+e+"</strong> se eliminará",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(a){a&&(g(d,"accion"),i())})})}}});