'use strict';function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}define(['jquery','block_ases/bootstrap','block_ases/datatables.net','block_ases/sweetalert','block_ases/select2'],function(a){return{init:function init(){function f(){a('#profiles_user').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}},width:'36%',dropdownAutoWidth:!0,placeholder:'Seleccionar perfil'})}function g(){var u=a('#nombre').val().trim(),v=a('#descripcion').val().trim(),w=a('#functions').val(),x='';0==u.length&&(x='Nombre no puede ser nulo'),0==v.length&&(x+='\nDescripcion no puede ser nulo'),0==w.length&&(x+='\nFuncionalidad no puede ser nulo'),0==u.length||0==v.length?alert(x):a.ajax({type:'POST',data:{nombre:u,descripcion:v,id_funcionalidad:w},url:'../managers/ActionCreateAction.php',async:!1,success:function success(y){a('#formAction')[0].reset(),alert(y)}})}function h(){var u=a('#nombre_funcionalidad').val().trim(),v=a('#descripcion_funcionalidad').val().trim(),w='';0==u.length&&(w='Nombre no puede ser nulo'),0==v.length&&(w+='\nDescripcion no puede ser nulo'),0==u.length||0==v.length?alert(w):a.ajax({type:'POST',data:{nombre_funcionalidad:u,descripcion_funcionalidad:v},url:'../managers/ActionCreateAction.php',success:function success(x){a('#formFuncion')[0].reset(),alert(x)}})}function j(){var u=a('#nombre_perfil').val().trim(),v=a('#descripcion_perfil').val().trim(),w='';0==u.length&&(w='Nombre del perfil no puede ser nulo'),0==v.length&&(w+='\nDescripcion del perfil no puede ser nulo'),0==u.length||0==v.length?alert(w):a.ajax({type:'POST',data:{nombre_perfil:u,descripcion_perfil:v},url:'../managers/ActionCreateAction.php',async:!1,success:function success(x){a('#formPerfil')[0].reset(),alert(x)}})}function l(u){var v=a('#profiles_user').val(),w=[],x=a('input[name=\'actions[]\']:checked').each(function(){w.push(a(this).val())}),y=JSON.stringify(w);''==v?swal({title:'Error',text:'Seleccione el rol del usuario',type:'error',confirmButtonColor:'#d51b23'}):a.ajax({type:'POST',data:{profile:v,actions:y,function:'assign_role',instance:u},url:'../managers/ActionCreateAction.php',async:!1,success:function success(z){alert(z)}})}function m(u,v){a.ajax({type:'POST',data:{id:u,source:'delete_record',type:v},url:'../managers/permissions_management/permissions_report.php',success:function success(w){swal({title:w.title,html:!0,text:w.text,type:w.type,confirmButtonColor:'#d51b23'}),q(),r(t)},dataType:'json',cache:'false',error:function error(){alert('Error al eliminar registro')}})}function n(){a.ajax({type:'POST',url:'../managers/permissions_management/load_function.php',success:function success(u){a('#div_functions').empty(),a('#div_functions').append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableFunctions').DataTable(u);a('#div_functions #modify_function').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar funcionalidades')}})}function o(){a.ajax({type:'POST',url:'../managers/permissions_management/load_actions.php',success:function success(u){a('#div_actions').empty(),a('#div_actions').append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableActions').DataTable(u);a('#div_actions #delete_action').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar acciones')}})}function p(){a.ajax({type:'POST',url:'../managers/permissions_management/load_profiles.php',success:function success(u){a('#div_profiles').empty(),a('#div_profiles').append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableProfiles').DataTable(u);a('#div_profiles #delete_profiles').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar roles')}})}function q(){a.ajax({type:'POST',data:{source:'update_functionality_select'},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(u){a('#funct1').html(u[0]),a('#funct2').html(u[1])},error:function error(){alert('Error actualizar las funcionalidades')}})}function r(u){a.ajax({type:'POST',data:{source:'update_general_table',instance:u},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(v){a('#lista_funcionalidades').html(v)},error:function error(){alert('Error actualizar tabla de asignaci\xF3n de permisos y roles')}})}function s(){a.ajax({type:'POST',data:{source:'update_role_select'},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(u){a('#userol').html(u),f()},error:function error(){alert('Error actualizar roles')}})}f(),a('#profiles_prof').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}},width:'40%',dropdownAutoWidth:!0}),a('#actions').select2(_defineProperty({dropdownAutoWidth:!0,width:'100%',multiple:!0,language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}},'dropdownAutoWidth',!0));var t;a(document).ready(function(){for(var w,u=window.location.search.split('&'),v=0;v<u.length;v++)w=u[v].split('='),('?instanceid'==w[0]||'instanceid'==w[0])&&(t=w[1]);o(),n(),p(),a('#add_accion').on('click',function(){g(),o(),r(t)}),a('#add_function').on('click',function(){h(),n(),r(t),q()}),a('#add_profile').on('click',function(){j(),p(),s()}),a('#assign_user_profile').on('click',function(){l(t)})}),a('input[name=\'actions[]\']').change(function(){a(this).attr('checked',!0)}),a('#profiles_user').change(function(){var u=a('#profiles_user').val();a.ajax({type:'POST',data:{user:u,source:'permissions_management'},url:'../managers/permissions_management/permissions_report.php',success:function success(w){a('input[name=\'actions[]\'').prop('checked',!1),a.each(w,function(x,y){a('input[value=\''+y+'\']').prop('checked',!0)})},dataType:'json',cache:'false',error:function error(){alert('Error al cargar gestion de permisos y roles')}})}),a('body').on('click','tbody tr td .red.glyphicon.glyphicon-pencil',function(){var u=a(this).parents().eq(3).attr('id'),v=a('#'+u).DataTable(),w=v.cell(v.row(a(this).parent()).index(),0).data(),x=v.cell(v.row(a(this).parent()).index(),1).data(),y=v.cell(v.row(a(this).parent()).index(),2).data();a('#nombre_editar').val(w),a('#descripcion_editar').val(x),'tableActions'==u?(a('.form-pilos.func').removeClass('hide'),a('#save_seg').attr('name',this.id+'_accion'),a('#functions_table option').filter(function(){return a(this).text()==y}).prop('selected',!0)):'tableFunctions'==u?(a('#save_seg').attr('name',this.id+'_funcionalidad'),a('.form-pilos.func').addClass('hide')):(a('#save_seg').attr('name',this.id+'_rol'),a('.form-pilos.func').addClass('hide'))}),a(document).on('click','#save_seg',function(){var u=this.name.split('_'),v=u[0],w=u[1],x=a('#nombre_editar').val(),y=a('#descripcion_editar').val(),z='';'accion'==w&&(z=a('#functions_table').val()),a.ajax({type:'POST',data:{id:v,table:w,source:'modify_register',nombre:x,descripcion:y,funcionalidad:z},url:'../managers/permissions_management/permissions_report.php',success:function success(A){swal({title:A.title,html:!0,text:A.text,type:A.type,confirmButtonColor:'#d51b23'}),o(),n(),p(),q(),r(t),s()},dataType:'json',cache:'false',error:function error(){swal({title:'Error',html:!0,text:'Se presento un inconveniente al modificar registro',type:'error',confirmButtonColor:'#d51b23'})}})}),a('#div_actions').on('click','#delete_action',function(){var u=a('#div_actions #tableActions').DataTable(),v=a(this).parent(),w=a(this).children('span').attr('id'),x=u.cell(v).index().column,y=u.cell(u.row(v).index(),0).data(),z=u.cell(u.row(v).index(),1).data();swal({title:'Estas seguro/a?',text:'La acci\xF3n <strong>'+y+'</strong> se eliminar\xE1',type:'warning',html:!0,showCancelButton:!0,confirmButtonColor:'#d51b23',confirmButtonText:'Si!',cancelButtonText:'No',closeOnConfirm:!0},function(A){A&&(m(w,'accion'),o())})})}}});