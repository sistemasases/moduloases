'use strict';function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}define(['jquery','block_ases/bootstrap','block_ases/datatables.net','block_ases/datatables.net-buttons','block_ases/buttons.flash','block_ases/jszip','block_ases/pdfmake','block_ases/buttons.html5','block_ases/buttons.print','block_ases/sweetalert','block_ases/select2'],function(a){return{init:function init(){function m(){a('#profiles_user').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}},width:'36%',dropdownAutoWidth:!0,placeholder:'Seleccionar perfil'})}function n(){var A=a('#nombre').val().trim(),B=a('#descripcion').val().trim(),C=a('#functions').val(),D='';0==A.length&&(D='Nombre no puede ser nulo'),0==B.length&&(D+='\nDescripcion no puede ser nulo'),0==C.length&&(D+='\nFuncionalidad no puede ser nulo'),0==A.length||0==B.length?alert(D):a.ajax({type:'POST',data:{nombre:A,descripcion:B,id_funcionalidad:C},url:'../managers/ActionCreateAction.php',async:!1,success:function success(E){a('#formAction')[0].reset(),alert(E)}})}function o(){var A=a('#nombre_funcionalidad').val().trim(),B=a('#descripcion_funcionalidad').val().trim(),C='';0==A.length&&(C='Nombre no puede ser nulo'),0==B.length&&(C+='\nDescripcion no puede ser nulo'),0==A.length||0==B.length?alert(C):a.ajax({type:'POST',data:{nombre_funcionalidad:A,descripcion_funcionalidad:B},url:'../managers/ActionCreateAction.php',success:function success(D){a('#formFuncion')[0].reset(),alert(D)}})}function p(){var A=a('#nombre_perfil').val().trim(),B=a('#descripcion_perfil').val().trim(),C='';0==A.length&&(C='Nombre del perfil no puede ser nulo'),0==B.length&&(C+='\nDescripcion del perfil no puede ser nulo'),0==A.length||0==B.length?alert(C):a.ajax({type:'POST',data:{nombre_perfil:A,descripcion_perfil:B},url:'../managers/ActionCreateAction.php',async:!1,success:function success(D){a('#formPerfil')[0].reset(),alert(D)}})}function r(A){var B=a('#profiles_user').val(),C=[],D=a('input[name=\'actions[]\']:checked').each(function(){C.push(a(this).val())}),E=JSON.stringify(C);''==B?swal({title:'Error',text:'Seleccione el rol del usuario',type:'error',confirmButtonColor:'#d51b23'}):a.ajax({type:'POST',data:{profile:B,actions:E,function:'assign_role',instance:A},url:'../managers/ActionCreateAction.php',async:!1,success:function success(F){alert(F)}})}function s(A,B){a.ajax({type:'POST',data:{id:A,source:'delete_record',type:B},url:'../managers/permissions_management/permissions_report.php',success:function success(C){swal({title:C.title,html:!0,text:C.text,type:C.type,confirmButtonColor:'#d51b23'}),w(),x(z)},dataType:'json',cache:'false',error:function error(){alert('Error al eliminar registro')}})}function t(){a.ajax({type:'POST',url:'../managers/permissions_management/load_function.php',success:function success(A){a('#div_functions').empty(),a('#div_functions').append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableFunctions').DataTable(A);a('#div_functions #modify_function').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar funcionalidades')}})}function u(){a.ajax({type:'POST',url:'../managers/permissions_management/load_actions.php',success:function success(A){a('#div_actions').empty(),a('#div_actions').append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableActions').DataTable(A);a('#div_actions #delete_action').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar acciones')}})}function v(){a.ajax({type:'POST',url:'../managers/permissions_management/load_profiles.php',success:function success(A){a('#div_profiles').empty(),a('#div_profiles').append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a('#tableProfiles').DataTable(A);a('#div_profiles #delete_profiles').css('cursor','pointer')},dataType:'json',cache:'false',error:function error(){alert('Error al cargar roles')}})}function w(){a.ajax({type:'POST',data:{source:'update_functionality_select'},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(A){a('#funct1').html(A[0]),a('#funct2').html(A[1])},error:function error(){alert('Error actualizar las funcionalidades')}})}function x(A){a.ajax({type:'POST',data:{source:'update_general_table',instance:A},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(B){a('#lista_funcionalidades').html(B)},error:function error(){alert('Error actualizar tabla de asignaci\xF3n de permisos y roles')}})}function y(){a.ajax({type:'POST',data:{source:'update_role_select'},url:'../managers/permissions_management/permissions_report.php',dataType:'json',cache:'false',success:function success(A){a('#userol').html(A),m()},error:function error(){alert('Error actualizar roles')}})}m(),a('#profiles_prof').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}},width:'40%',dropdownAutoWidth:!0}),a('#actions').select2(_defineProperty({dropdownAutoWidth:!0,width:'100%',multiple:!0,language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}},'dropdownAutoWidth',!0));var z;a(document).ready(function(){for(var C,A=window.location.search.split('&'),B=0;B<A.length;B++)C=A[B].split('='),('?instanceid'==C[0]||'instanceid'==C[0])&&(z=C[1]);u(),t(),v(),a('#add_accion').on('click',function(){n(),u(),x(z)}),a('#add_function').on('click',function(){o(),t(),x(z),w()}),a('#add_profile').on('click',function(){p(),v(),y()}),a('#assign_user_profile').on('click',function(){r(z)})}),a('input[name=\'actions[]\']').change(function(){a(this).attr('checked',!0)}),a('#profiles_user').change(function(){var A=a('#profiles_user').val();a.ajax({type:'POST',data:{user:A,source:'permissions_management'},url:'../managers/permissions_management/permissions_report.php',success:function success(C){a('input[name=\'actions[]\'').prop('checked',!1),a.each(C,function(D,E){a('input[value=\''+E+'\']').prop('checked',!0)})},dataType:'json',cache:'false',error:function error(){alert('Error al cargar gestion de permisos y roles')}})}),a('body').on('click','tbody tr td .red.glyphicon.glyphicon-pencil',function(){var A=a(this).parents().eq(3).attr('id'),B=a('#'+A).DataTable(),C=B.cell(B.row(a(this).parent()).index(),0).data(),D=B.cell(B.row(a(this).parent()).index(),1).data(),E=B.cell(B.row(a(this).parent()).index(),2).data();a('#nombre_editar').val(C),a('#descripcion_editar').val(D),'tableActions'==A?(a('.form-pilos.func').removeClass('hide'),a('#save_seg').attr('name',this.id+'_accion'),a('#functions_table option').filter(function(){return a(this).text()==E}).prop('selected',!0)):'tableFunctions'==A?(a('#save_seg').attr('name',this.id+'_funcionalidad'),a('.form-pilos.func').addClass('hide')):(a('#save_seg').attr('name',this.id+'_rol'),a('.form-pilos.func').addClass('hide'))}),a(document).on('click','#save_seg',function(){var A=this.name.split('_'),B=A[0],C=A[1],D=a('#nombre_editar').val(),E=a('#descripcion_editar').val(),F='';'accion'==C&&(F=a('#functions_table').val()),a.ajax({type:'POST',data:{id:B,table:C,source:'modify_register',nombre:D,descripcion:E,funcionalidad:F},url:'../managers/permissions_management/permissions_report.php',success:function success(G){swal({title:G.title,html:!0,text:G.text,type:G.type,confirmButtonColor:'#d51b23'}),u(),t(),v(),w(),x(z),y()},dataType:'json',cache:'false',error:function error(){swal({title:'Error',html:!0,text:'Se presento un inconveniente al modificar registro',type:'error',confirmButtonColor:'#d51b23'})}})}),a('#div_actions').on('click','#delete_action',function(){var A=a('#div_actions #tableActions').DataTable(),B=a(this).parent(),C=a(this).children('span').attr('id'),D=A.cell(B).index().column,E=A.cell(A.row(B).index(),0).data(),F=A.cell(A.row(B).index(),1).data();swal({title:'Estas seguro/a?',text:'La acci\xF3n <strong>'+E+'</strong> se eliminar\xE1',type:'warning',html:!0,showCancelButton:!0,confirmButtonColor:'#d51b23',confirmButtonText:'Si!',cancelButtonText:'No',closeOnConfirm:!0},function(G){G&&(s(C,'accion'),u())})})}}});