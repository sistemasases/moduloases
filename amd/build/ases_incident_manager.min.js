'use strict';define(['jquery','block_ases/sweetalert','block_ases/jqueryui','block_ases/loading_indicator','block_ases/_general_modal_manager'],function(a,b,c,d,e){function f(g){var i=g.getDate(),j=g.getMonth(),k=g.getFullYear(),l=g.getHours(),m=g.getMinutes(),n=g.getSeconds();return i+'-'+['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'][j]+'-'+k+', '+l+':'+m+':'+n}return a(document).on('click','#new-incident',function(){e.generate_modal('modal-new-incident','Registro de incidencia interna','                <div id="incident_box" style="padding:1em; margin-bottom:1.2em;" >                    <input id="new_inc_title" class="form-control" placeholder="T\xEDtulo corto" type="text">                    <textarea id="new_inc_detail" class="form-control" name="" placeholder="Descripci\xF3n detallada de la incidencia" rows="5"></textarea>                    <a id="new_inc_registrar" class="btn btn-info" style="float:right; margin-top:0.5em;" href="javascript:void(0)">Registrar</a>                </div>            ','modal-body-new-incident',function(){e.show_modal('.modal-new-incident',300)})}),a(document).on('click','#new_inc_registrar',function(){var h={title:a('#new_inc_title').val(),commentary:a('#new_inc_detail').val()};''!=h.title&&''!=h.commentary?(d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'create_incident',params:[h,'<h1>Incidencia interna</h1>']}),success:function success(i){d.hide(),0===i.status_code?swal({title:'\xC9xito',text:'Se ha registrado correctamente la incidencia, ticket #'+i.data_response,type:'success'},function(){location.reload()}):swal('Error!','Oops!: '+i.data_response,'error')},error:function error(i,j,k){d.hide(),console.log('some error '+j+' '+k),console.log(i)}})):swal('Oops!','Verifica que tanto el t\xEDtulo como la descripci\xF3n no est\xE9n vac\xEDos.','warning')}),console.log('ases_incident_manager loaded'),{init:function init(){function g(i){d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'get_incident',params:[i]}),async:!1,success:function success(j){d.hide();var k=a('#extras').data('url-base'),l=JSON.parse(JSON.parse(j.data_response).comentarios),m=JSON.parse(j.data_response).usuario_registra,n=JSON.parse(j.data_response).usuario_cierra,o=l[0].message.title,p=l[0].message.commentary,q=JSON.parse(j.data_response).cerrada,r=f(new Date(1e3*JSON.parse(j.data_response).fecha_hora_registro));a('.inc_detail').html('<strong>Detalle: </strong>'+p),a('.opened_by').html('<strong>Abierta por:</strong> '+m.firstname+' '+m.lastname+' - '+m.username),a('.inc_preview').find('a').attr('href','ases_incidents_preview.php?incident_id='+i),a('.record_datetime').html('<strong>Fecha y hora:</strong> '+r),a('#close_incident').attr('data-id',i),a('.send_message').html('<strong>Mensajes: </strong> [ <a target="_blank" rel="noopener noreferrer" href="'+k+'/message/index.php?id='+m.id+'">Ir al chat con el usuario</a> ].'),a('.inc_preview').show(),1==q?(a('.inc_opc').hide(),a('.inc_title').html('<h2>Ticket #'+i+' [Cerrada] - '+o+'</h2>'),a('.closed_by').html('<strong>Cerrada por:</strong> '+n.firstname+' '+n.lastname)):(a('.inc_title').html('<h2>Ticket #'+i+' - '+o+'</h2>'),a('.inc_opc').show())},error:function error(j,k,l){d.hide(),console.log('some error '+k+' '+l),console.log(j)}})}function h(i){swal({html:!0,title:'Confirmaci\xF3n',text:'<strong>Nota importante!</strong>: Est\xE1 cerrando una incidencia.',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, cerrar!'},function(j){j&&(d.show(),a.ajax({method:'POST',url:'../managers/incident_manager/incident_api.php',contentType:'application/json',dataType:'json',data:JSON.stringify({'function':'close_logged_user_incident',params:[i]}),success:function success(k){d.hide(),0===k.status_code?swal({title:'\xC9xito',text:'Se ha cerrado correctamente la incidencia',type:'success'},function(){location.reload()}):swal('Error!','Oops!: Al parece no existe la incidencia','error')},error:function error(k,l,m){d.hide(),console.log('some error '+l+' '+m),console.log(k)}}))})}a(document).on('click','.inc_item',function(){var i=a(this).data('id');g(i)}),a(document).on('click','#close_incident',function(){var i=a(this).data('id');h(i)})}}});