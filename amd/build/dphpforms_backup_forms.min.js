'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};define(['jquery','block_ases/jszip','block_ases/jquery.dataTables','block_ases/dataTables.autoFill','block_ases/dataTables.buttons','block_ases/buttons.html5','block_ases/buttons.flash','block_ases/buttons.print','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2','block_ases/loading_indicator','block_ases/_general_modal_manager'],function(a,b,c,d,f,g,h,j,k,l,m,n,o,p){return{init:function init(){function q(B,C){o.show(),a.ajax({type:'POST',data:{loadF:'get_like',cadena:B,atributo:C},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(D){if(o.hide(),0===D.length)swal('ATTRIBUTE NOT FOUND','Oooops! Zero results','warning');else{a('#div_table_forms').empty(),a('#div_table_forms').append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>');a('#tableBackupForms').DataTable(D);a('#div_table_forms').css('cursor','pointer')}},cache:!1,async:!0,failure:function failure(){o.hide(),alert('No encontrado')}})}function r(B,C){var D=[];D.push(B),D.push(C),o.show(),a.ajax({type:'POST',data:{loadF:'get_id_user',params:D},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(E){o.hide(),0===E.length?swal('USER NOT FOUND','Oooops! Incorrect code','warning'):(a('#div_code_user').empty(),a('#div_code_user').append('<strong>Usuario: </strong>'+E[0].cod_user),a('#div_name_user').empty(),a('#div_name_user').append(E[0].name_user+' '+E[0].last_name_user))},cache:!1,async:!0,failure:function failure(){o.hide(),alert('No encontrado')}})}function t(B){o.show(),a.ajax({type:'POST',data:{loadF:'get_values',params:B},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(C){if(o.hide(),0===C.length)swal('QUESTION NOT FOUND','Oooops! Incorrect code','warning');else{opciones=C[0].options_c,tipo_campo=C[0].tipo_campo;var D='"respuesta":"MODIFIQUE ESTE VALOR","opciones":"'+opciones+'","tipo_campo":"'+tipo_campo+'","id_pregunta":"'+a('#typekey_select').val()+'"';a('#filtroLike').val(D)}},cache:!1,async:!0,failure:function failure(){o.hide(),alert('No encontrado')}})}function u(B,C){o.show(),a.ajax({type:'POST',data:{loadF:B,params:C},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',dataType:'json',cache:!1,async:!0,success:function success(D){if(o.hide(),''!=D[C].datos_previos){var E=JSON.parse(D[C].datos_previos);if('get_form'==B&&(D[C].datos_previos=E),'get_form_general_logs'==B)if(Array.isArray(E))D[C].datos_previos=E;else{var F=[];for(data in E){var G={};G[data]=E[data],F.push(G)}D[C].datos_previos=F}}''!=D[C].datos_enviados&&(D[C].datos_enviados=JSON.parse(D[C].datos_enviados)),''!=D[C].datos_almacenados&&(D[C].datos_almacenados=JSON.parse(D[C].datos_almacenados)),w(D)},failure:function failure(){o.hide()}})}function w(B){a('#div_JSONform').empty();var C=JSON.stringify(B);a('#div_JSONform').append(C),a('#div_JSONform').beautifyJSON({type:'flexible',hoverable:!0,collapsible:!0,color:!0});var D=Object.keys(B)[0],E=B[D];a('#json_record_dwarehouse_selected').attr('value',JSON.stringify(E)),-1==E.id_registro_respuesta_form?(a('.dphpforms-peer-record').attr('disabled',!0),a('.dphpforms-restore').attr('disabled',!0),a('.dphpforms-compare').attr('disabled',!0),a('.dphpforms-peer-record').hide(),a('.dphpforms-restore').hide(),a('.dphpforms-compare').hide()):'DELETE'==E.accion?(a('.dphpforms-peer-record').attr('data-record-id',E.id_registro_respuesta_form),a('.dphpforms-restore').attr('data-record-id',D),a('.dphpforms-restore').attr('data-estado',1),a('.dphpforms-peer-record').attr('disabled',!1),a('.dphpforms-restore').attr('disabled',!1),a('.dphpforms-compare').attr('disabled',!1),a('.dphpforms-peer-record').hide(),a('.dphpforms-restore').show(),a('.dphpforms-compare').show()):'INSERT'==E.accion||'UPDATE'==E.accion||'RESTORE'==E.accion?(a('.dphpforms-peer-record').attr('data-record-id',E.id_registro_respuesta_form),a('.dphpforms-peer-record').attr('disabled',!1),a('.dphpforms-restore').attr('disabled',!0),a('.dphpforms-compare').attr('disabled',!1),a('.dphpforms-peer-record').hide(),a('.dphpforms-restore').show(),a('.dphpforms-compare').show()):(a('.dphpforms-peer-record').attr('disabled',!0),a('.dphpforms-restore').attr('disabled',!0),a('.dphpforms-compare').attr('disabled',!0),a('.dphpforms-peer-record').hide(),a('.dphpforms-restore').hide(),a('.dphpforms-compare').hide()),a('#modal_JSON').fadeIn(300)}function x(B){o.show(),a.ajax({type:'POST',data:{loadF:'restore_dwarehouse_record',params:B},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(C){o.hide(),C?swal('RESTORED SUCCESSFULLY','SUCCESS','success'):swal('NOT RESTORED SUCCESSFULLY','Oooops! Error','warning')},cache:!1,async:!0,error:function error(){o.hide(),swal('SYSTEM ERROR','Report to Systems office','error')}})}function y(B,C){var D,E,F,G,H;for(campo_b in H='',F=B.length,D='',E='',C){for(campo_a in G=0,B)if(G++,C[campo_b].local_alias==B[campo_a].local_alias){C[campo_b].respuesta==B[campo_a].respuesta?(E+='<div data-id-pregunta='+B[campo_a].id_pregunta+' data-id-relacion-form-pregunta='+B[campo_a].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div class = "text_json">Alias: '+B[campo_a].local_alias+'  </div> ',E+='<div class = "text_json">Respuesta: '+B[campo_a].respuesta+'  </div> </div>',D+='<div data-id-pregunta='+C[campo_b].id_pregunta+' data-id-relacion-form-pregunta='+C[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div class = "text_json">Alias: '+C[campo_b].local_alias+'  </div> ',D+='<div class = "text_json">Respuesta: '+C[campo_b].respuesta+'  </div> </div>'):(E+='<div data-id-pregunta='+B[campo_a].id_pregunta+' data-id-relacion-form-pregunta='+B[campo_a].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: '+B[campo_a].local_alias+'  </div> ',E+='<div class = "text_json data_estado_json_different" >Respuesta: '+B[campo_a].respuesta+'  </div> </div>',D+='<div  data-id-pregunta='+C[campo_b].id_pregunta+' data-id-relacion-form-pregunta='+C[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: '+C[campo_b].local_alias+'  </div> ',D+='<div class = "text_json data_estado_json_different">Respuesta: '+C[campo_b].respuesta+'  </div> </div>');break}else G==F&&(E+='<div data-id-pregunta='+C[campo_b].id_pregunta+' data-id-relacion-form-pregunta='+C[campo_b].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: No registra en esta versi\xF3n</div> ',E+='<div  class = "text_json">Respuesta: No registra en esta versi\xF3n</div> </div>',D+='<div  data-id-pregunta='+C[campo_b].id_pregunta+' data-id-relacion-form-pregunta='+C[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json">Alias: '+C[campo_b].local_alias+'  </div> ',D+='<div  class = "text_json">Respuesta: '+C[campo_b].respuesta+'  </div> </div>');H+='<div class="contenedor" >'+E+D+'</div>',E='',D=''}return H}function z(B){var C='';for(campo in B)C+='<div class="contenedor" >',C+='<div data-id-pregunta='+B[campo].id_pregunta+' data-id-relacion-form-pregunta='+B[campo].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div >Alias: No registra en esta versi\xF3n</div> ',C+='<div>Respuesta: No registra en esta versi\xF3n</div> </div>',C+='<div data-id-pregunta='+B[campo].id_pregunta+' data-id-relacion-form-pregunta='+B[campo].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div>Alias: '+B[campo].local_alias+'  </div> ',C+='<div>Respuesta: '+B[campo].respuesta+'  </div> </div>',C+='</div>';return C}function A(B,C,D){var E=[];E.push(B),E.push(C),E.push(JSON.stringify(D)),a.ajax({type:'POST',data:{loadF:'get_student_code_to_url',params:E},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',cache:!1,success:function success(F){var G='',H,I,J,K,L,M;if(0===F.length)G='<strong>Enlace(s) no disponible(s)</strong>',a('.url_students').empty(),a('.url_students').append(G);else{for(student_data in F){J=F[student_data],M=Object.keys(J)[0],H=J[M].username,I=J[M].firstname+' '+J[M].lastname,K=J[M].courseid,L=J[M].instanceid;var N=void 0;N='student_profile.php?courseid='+K+'&instanceid='+L+'&student_code='+H,G+='<div> Estudiante: <a href="'+N+'"  target="_blank" ><strong>'+I+' '+H+'</strong></a></div>'}a('.url_students').empty(),a('.url_students').append(G)}},error:function error(){swal('TYPE FORM NOT FOUND','Oooops! Is not a valid form to create url','warning')}})}a(document).on('mousedown','.slider.round',function(){var C=a(this).data('status');'off'==C?(a(this).data('status','on'),a('#busqueda-simplificada').hide(),a('#busqueda-avanzada').show()):(a(this).data('status','off'),a('#busqueda-avanzada').hide(),a('#busqueda-simplificada').show())}),a(document).on('click','#generarFiltroSimplificado',function(){var B=a('#simple_cod_user').val(),C=a('#simple_criteria_select option:selected').val();o.show(),a.ajax({type:'POST',data:{loadF:'get_records_simple',username:B,is_student:C},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',cache:!1,async:!0,success:function success(D){if(o.hide(),0===D.length)swal('ATTRIBUTE NOT FOUND','Oooops! Zero results','warning');else{a('#div_table_forms').empty(),a('#div_table_forms').append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>');a('#tableBackupForms').DataTable(D);a('#div_table_forms').css('cursor','pointer')}},failure:function failure(){o.hide(),alert('No encontrado')}})}),a(document).ready(function(){o.show(),a.ajax({type:'POST',data:{loadF:'loadForms'},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(B){o.hide(),a('#div_table_forms').empty(),a('#div_table_forms').append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>');a('#tableBackupForms').DataTable(B);a('#div_table_forms').css('cursor','pointer')},dataType:'json',cache:!1,async:!0,failure:function failure(){o.hide()}}),a.ajax({type:'POST',data:{loadF:'loadGeneralLogs'},url:'../managers/dphpforms/dphpforms_dwarehouse_api.php',success:function success(B){a('#div_table_general_logs').empty(),a('#div_table_general_logs').append('<table id="tableBackupGeneralLogs" class="display" cellspacing="0" width="100%"><thead><thead></table>');a('#tableBackupGeneralLogs').DataTable(B);a('#div_table_general_logs').css('cursor','pointer')},dataType:'json',cache:!1,async:!0,failure:function failure(){}})}),a(document).on('click','#tableBackupForms tbody tr td',function(){var B='';B=a(this).parents('tr').find('td:first').html(),u('get_form',B)}),a(document).on('click','#tableBackupGeneralLogs tbody tr td',function(){var B='';B=a(this).parents('tr').find('td:first').html(),u('get_form_general_logs',B)}),a('#generarFiltro').on('click',function(){var B=document.getElementById('filtroCodigoUsuario').value,C=document.getElementById('selectTable').value;r(B,C)}),a('#load_like').on('click',function(){var B=document.getElementById('typecolumn_select').value,C=document.getElementById('filtroLike').value;q(C,B)}),a('#typecolumn_select').on('click',function(){'datos_previos'==a('#typecolumn_select').val()||'datos_enviados'==a('#typecolumn_select').val()||'datos_almacenados'==a('#typecolumn_select').val()?a('#typekey_select').parent().parent().show():a('#typekey_select').parent().parent().hide()}),a('#typekey_select').on('click',function(){if('datos_enviados'==a('#typecolumn_select').val()){var B='"id":"'+a(this).val()+'","valor":"MODIFIQUE ESTE VALOR"';a('#filtroLike').val(B)}('datos_previos'==a('#typecolumn_select').val()||'datos_almacenados'==a('#typecolumn_select').val())&&t(a(this).val())}),a('.dphpforms-restore').on('click',function(){if(!a(this).attr('disabled')&&1==a(this).attr('data-estado')){var B=a(this).attr('data-record-id');x(B)}}),a('.dphpforms-compare').on('click',function(){if(!a(this).attr('disabled')){var B,C,D,E,F,G,H;D=JSON.parse(a('#json_record_dwarehouse_selected').val()),E=D.id_usuario_moodle,F=D.accion,G=D.fecha_hora_registro,H=D.url_request;var I,K,J='';if(B=D.datos_previos,''==B||null==B?I='<div class = "data_estado_json text_json"> No hay datos previos </div>':(B=B.record,I='<div class="data_estado_json text_json"> Alias formulario:        '+B.alias+'</div>'),C=D.datos_almacenados,''==C||null==C?K='<div class = "data_estado_json text_json"> No hay datos almacenados </div>':(C=C.record,K='<div class="data_estado_json text_json"> Alias formulario:        '+C.alias+'</div>'),J+='<div class="contenedor" >'+I+K+'</div>',''!=B&&null!=B&&''!=C&&null!=C){var L=y(B.campos,C.campos);J+=L}else''!=B&&null!=B?J+=z(B.campos):''!=C&&null!=C&&(J+=z(C.campos));var M='<div class="grid_dphpforms_compare">';M+='<div class="general_info_record_dwarehouse"> ',M+='<div class= "title_data">Informaci\xF3n del registro </div>',M+='<div class="data_general text_json">  Realizado por:        '+E+'</div>',M+='<div class="data_general text_json">  Acci\xF3n del registro: <strong style= "font-size: 18px;"> '+F+'</strong></div>',M+='<div class="data_general text_json">  Fecha:                '+G+'</div>',M+='<div class="url_students data_general text_json"> </div>',M+='                            </div>',M+='<div class = "json_data_compare">',M+='<div class="contenedor" >',M+='<div class="title_data text_json"> Datos previos</div>',M+='<div class="title_data text_json"> Datos almacenados</div>',M+='</div>',M+=J,M+='                                    </div>',M+='</div>',M+='<hr style="background-color: red; height: 1px; border: 0">',p.generate_modal('modal_to_compare','Comparaci\xF3n de estados',M,null,function(){p.show_modal('.modal_to_compare')}),A(D.id_registro_respuesta_form,F,D)}}),a('.outside').click(function(){var B=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(C){C&&(a(B).parent('.mymodal').fadeOut(300),console.log(a(this).parent('.mymodal')))})}),function(B){B.fn.beautifyJSON=function(C){var E=jQuery.extend({},{type:'strict',hoverable:!0,collapsible:!0,color:!0},C);this.each(function(){if('plain'==E.type){var Q=function(V){var W=V.pop();return V.push(W),W},F='&ensp;&ensp;&ensp;',G=[],H='',I=this.innerHTML,J=I.split('"').map(function(V,W){return W%2?V:V.replace(/\s/g,'')}).join('"'),K='';for(i=0;i<I.length;i++)if('{'==I.charAt(i))G.push(I.charAt(i)),K+=I.charAt(i)+'<br>',H+=F,K+=H;else if('"'==I.charAt(i)&&'"'!=Q(G))K+=I.charAt(i),G.push(I.charAt(i));else if('['==I.charAt(i)&&']'==I.charAt(i+1))G.push(I.charAt(i)),K+=I.charAt(i),H+=F;else if('['==I.charAt(i))G.push(I.charAt(i)),K+=I.charAt(i)+'<br>',H+=F,K+=H;else if(']'==I.charAt(i))H=H.substring(0,H.length-18),K+='<br>'+H,K+=I.charAt(i),G.pop();else if('}'==I.charAt(i))H=H.substring(0,H.length-18),K+='<br>'+H+I.charAt(i),G.pop(),0!=G.length&&'['!=Q(G)&&'{'!=Q(G)&&(K+=H);else if('"'==I.charAt(i)&&'"'==Q(G))K+=I.charAt(i),G.pop();else if(','==I.charAt(i)&&'"'!=Q(G))K+=I.charAt(i)+'<br>',K+=H;else if('\n'==I.charAt(i));else if(' '==I.charAt(i)&&'"'!=Q(G));else K+=I.charAt(i);this.innerHTML=K}else if('flexible'==E.type){var R=function(V){var W=V.pop();return V.push(W),W},G=[],L=[],I=this.innerHTML,K='';if(E.collapsible)var M='<span class=\'ellipsis\'></span><div class=\'collapser\'></div><ul class=\'array collapsible\'>';else var M='<div></div><ul class=\'array\'>';if(E.hoverable)var N='<div class=\'hoverable\'>';else var N='<div>';for(K+='<div id=\'json\'>',L.push('</div>'),i=0;i<I.length;i++)if('{'==I.charAt(i))G.push(I.charAt(i)),K+=I.charAt(i),K+=M,L.push('</ul>'),K+='<li>'+N,L.push('</div></li>');else if('"'==I.charAt(i)&&'"'!=R(G))K+=I.charAt(i),G.push(I.charAt(i));else if('['==I.charAt(i)&&']'==I.charAt(i+1))G.push(I.charAt(i)),K+=I.charAt(i),K+=M,L.push('</ul>'),K+='<li>'+N,L.push('</div></li>');else if('['==I.charAt(i))G.push(I.charAt(i)),K+=I.charAt(i),K+=M,L.push('</ul>'),K+='<li>'+N,L.push('</div></li>');else if(']'==I.charAt(i))K+=L.pop()+L.pop(),K+=I.charAt(i),G.pop();else if('}'==I.charAt(i))K+=L.pop()+L.pop(),K+=I.charAt(i),G.pop(),0!=G.length&&'['!=R(G)&&'{'!=R(G)&&(K+=L.pop());else if('"'==I.charAt(i)&&'"'==R(G))K+=I.charAt(i),G.pop();else if(','==I.charAt(i)&&'"'!=R(G))K+=I.charAt(i),K+=L.pop(),K+='<li>'+N,L.push('</div></li>');else if('\n'==I.charAt(i));else if(' '==I.charAt(i)&&'"'!=R(G));else K+=I.charAt(i);this.innerHTML=K}else{var T=function(V){B.each(V,function(W,X){null==X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-null\'>'+X+'</span></div></li>':X instanceof Array?(K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: ['+M,L.push('</li>'),L.push('</div>'),L.push('</ul>'),U(X)):'object'==('undefined'==typeof X?'undefined':_typeof(X))?(K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: {'+O,L.push('</li>'),L.push('</div>'),L.push('</ul>'),T(X)):'number'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-number\'>'+X+'</span></div></li>':'string'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-string\'>"'+X+'"</span></div></li>':'boolean'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-boolean\'>'+X+'</span></div></li>':K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: '+X+'</div></li>'}),K+=L.pop()+'}'+L.pop()+L.pop()},U=function(V){B.each(V,function(W,X){null==X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-null\'>'+X+'</span></div></li>':X instanceof Array?(K+='<li>'+N+'['+M,L.push('</li>'),L.push('</div>'),L.push('</ul>'),U(X)):'object'==('undefined'==typeof X?'undefined':_typeof(X))?(K+='<li>'+N+'{'+O,L.push('</li>'),L.push('</div>'),L.push('</ul>'),T(X)):'number'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-number\'>'+X+'</span></div></li>':'string'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-string\'>"'+X+'"</span></div></li>':'boolean'==typeof X?K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: <span class=\'type-boolean\'>'+X+'</span></div></li>':K+='<li>'+N+'<span class=\'property\'>'+W+'</span>: '+X+'</div></li>'}),K+=L.pop()+']'+L.pop()+L.pop()},K='',L=[];if(E.collapsible)var M='<span class=\'ellipsis\'></span><div class=\'collapser\'></div><ul class=\'array collapsible\'>',O='<span class=\'ellipsis\'></span><div class=\'collapser\'></div><ul class=\'obj collapsible\'>';else var M='<div></div><ul class=\'array\'>',O='<div></div><ul class=\'obj\'>';if(E.hoverable)var N='<div class=\'hoverable\'>';else var N='<div>';var I=this.innerHTML,P=jQuery.parseJSON(I);K='',K+='<div id=\'json\'>',K+=N+'{'+O,L.push(''),L.push('</div>'),L.push('</ul>'),T(P),K+='</ul></div></div>',this.innerHTML=K}B('.hoverable').hover(function(V){V.stopPropagation(),B('.hoverable').removeClass('hovered'),B(this).addClass('hovered')},function(V){V.stopPropagation(),B(this).addClass('hovered')}),B('.collapser').off().click(function(){B(this).parent('.hoverable').toggleClass('collapsed')})})}}(jQuery),a('.mymodal-close').click(function(){a('#modal_JSON').hide()}),a('.btn-danger-close').click(function(){a('#modal_JSON').hide()})}}});