define(["jquery","block_ases/jszip","block_ases/pdfmake","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var b=a("#form_general_report").serializeArray();b.push({name:"instance_id",value:o()}),a("#not_assigned_students").html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:"POST",data:b,url:"../managers/ases_report/load_not_assigned_students.php",success:function(b){a("#not_assigned_students").html(""),a("#not_assigned_students").fadeIn(1e3).append('<table id="tableAssign" class="display" cellspacing="0" width="100%"><thead> </thead></table>');a("#tableAssign").DataTable(b)},dataType:"json",cache:"false",error:function(a){alert("Error al cargar estudiantes no asignados")}})}function n(){var b=a("#form_general_report").serializeArray();b.push({name:"instance_id",value:o()}),a("#div_table").html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:"POST",data:b,url:"../managers/ases_report/asesreport_server_processing.php",success:function(b){a("#div_table").html(""),a("#div_table").fadeIn(1e3).append('<table id="tableResult" class="display" cellspacing="0" width="100%"><thead> </thead></table>'),a("#tableResult").DataTable(b),a("#tableResult tr").each(function(){a.each(this.cells,function(){"Bajo"==a(this).html()?a(this).addClass("bajo"):"Medio"==a(this).html()?a(this).addClass("medio"):"Alto"==a(this).html()&&a(this).addClass("alto")})}),a("#tableResult").bind("DOMSubtreeModified",function(){a("#tableResult tr").each(function(){a.each(this.cells,function(){"bajo"==a(this).html()?a(this).addClass("bajo"):"medio"==a(this).html()?a(this).addClass("medio"):"alto"==a(this).html()&&a(this).addClass("alto")})})})},dataType:"json",cache:"false",error:function(a){alert("Error al conectar con el servidor")}})}function o(){var a=location.search.split("&");for(x in a)if(a[x].indexOf("instanceid")>=0){var b=a[x].split("=");return b[1]}return 0}return{init:function(){window.JSZip=b,a("#send_form_btn").on("click",function(){n(),m()}),a(document).on("click","#tableAssign tbody tr td #student_assign",function(){var b=a("#tableAssign").DataTable(),c=b.row(a(this).parents("tr")).data(),d=o(),e=c.username,f=a(this).closest("tr").find("#monitors").val(),g=a(this).closest("tr").find("#practicants").val(),h=!0,i="";"-1"==f&&(h=!1,i+="* Debe elegir monitor a asignar \n"),"-1"==g&&(h=!1,i+="*Debe elegir practicantes a asignar"),h?a.ajax({type:"POST",data:{type:"assign_student",monitor:f,practicant:g,instance:d,student:e},url:"../managers/ases_report/asesreport.php",success:function(a){alert(a)},dataType:"text",cache:"false",error:function(a){console.log("Error al asignar estudiantes"+a)}}):alert(i)}),a(document).on("click","#tableResult tbody tr td",function(){var b="student_profile.php",c=a("#tableResult").DataTable(),d=c.cell(this).index().column;d<=2&&(a("#formulario").each(function(){this.reset}),location.href=b+location.search+"&student_code="+c.cell(c.row(this).index(),0).data())}),a(document).on("change","#tableResult thead tr th select",function(){var b=a("#tableResult").DataTable(),c=a(this).parent().index()+1;a(this).parent().find(":selected").text();b.columns(c-1).search(this.value).draw()}),a(document).on("change","#tableAssign tbody tr td select#practicants",function(){var b=a(this).val(),c="list_monitors",d=o();a.ajax({type:"POST",data:{user:b,instance:d,source:c},url:"../managers/ases_report/asesreport.php",success:function(b){a("select#monitors").find("option").remove().end(),a("select#monitors").append(b)},dataType:"json",cache:"false",error:function(a){alert("Error al cargar monitores con practicante seleccionado")}})})},load_defaults_students:function(b){a("#div_table").html(""),a("#div_table").fadeIn(1e3).append('<table id="tableResult" class="display" cellspacing="0" width="100%"><thead> </thead></table>'),a("#tableResult").DataTable(b)},create_table:function(){},get_id_instance:function(){var a=location.search.split("&");for(x in a)if(a[x].indexOf("instanceid")>=0){var b=a[x].split("=");return b[1]}return 0}}});