'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function g(){var o=location.search.split('&');for(var p in o)if(0<=o[p].indexOf('student_code')){var q=o[p].split('=');return q[1].split('-')[0]}return 0}function h(){var p=k('.seg_geo_nivel_riesgo'),q=a('.seg_geo_observaciones').find('textarea').val();if('3'==p){var r={'function':'send_email_dphpforms',student_code:g(),risks:[{name:'Geogr\xE1fico',risk_lvl:p,observation:q}],date:a('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(r)),a.ajax({type:'POST',data:JSON.stringify(r),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(s){console.log(s)},dataType:'text',cache:'false',error:function error(s){console.log(s)}})}}function j(){var p=k('.puntuacion_riesgo_individual'),q=a('.comentarios_individual').find('textarea').val();var r=k('.puntuacion_riesgo_familiar'),s=a('.comentarios_familiar').find('textarea').val(),t=k('.puntuacion_riesgo_academico'),u=a('.comentarios_academico').find('textarea').val(),v=k('.puntuacion_riesgo_economico'),w=a('.comentarios_economico').find('textarea').val(),y=k('.puntuacion_vida_uni'),A=a('.comentarios_vida_uni').find('textarea').val();if('3'==p||'3'==r||'3'==t||'3'==v||'3'==y){var B={'function':'send_email_dphpforms',student_code:g(),risks:[{name:'Individual',risk_lvl:p,observation:q},{name:'Familiar',risk_lvl:r,observation:s},{name:'Acad\xE9mico',risk_lvl:t,observation:u},{name:'Econ\xF3mico',risk_lvl:v,observation:w},{name:'Vida Universitaria',risk_lvl:y,observation:A}],date:a('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(B)),a.ajax({type:'POST',data:JSON.stringify(B),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(C){console.log(C)},dataType:'text',cache:'false',error:function error(C){console.log(C)}})}}function k(o){var p=0;return a(o).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(p=a(this).find('label').find('input').val())}),p}function l(o,p){if('primer_acercamiento'==o&&'insert'==p);else if('primer_acercamiento'==o&&'update'==p);else if('seguimiento_pares'==o&&'insert'==p);else if('seguimiento_pares'==o&&'update'==p){var q=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),r=a('#dphpforms_role_support').attr('data-info');q&&'sistemas'!=r&&a('.btn-dphpforms-update').remove();var s=a('.dphpforms-record .btn-dphpforms-univalle').length;1==s?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-a('.dphpforms-record .btn-dphpforms-close').outerWidth()/2+'px'}):2==s?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==s&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_geografico_'==o&&'insert'==p)a('.seg_geo_origen').find('input').prop('disabled',!1);else if('seguimiento_geografico_'==o&&'update'==p);else if('seguimiento_grupal_'==o&&'insert'==p){var t=a('modal_v2_edit_groupal_tracking').find('input:checked').length,u='',v='';a('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),a('#modal_v2_edit_groupal_tracking').find('input:checked').each(function(){var y=a(this).parent().parent().find('>:first-child').text(),A=y.split('-');u+=A[0]+','}),a('#modal_v2_groupal_tracking').find('input:checked').each(function(){var y=a(this).parent().parent().find('>:first-child').text(),A=y.split('-');v+=A[0]+','}),a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(u.slice(0,-1)),a('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(v.slice(0,-1))}else if('seguimiento_grupal_'==o&&'update'==p);}function m(o){students_code=o.split(','),console.log('.id_estudiante :'+students_code);var p=[];a('#list_students_attendance_1 > tbody  > tr').each(function(){var r=a(this).children('td').first().html().split('-');p.push(r[0])}),console.log('lista total de id_estudiantes :'+p),console.log('lista de estudiantes seleccin : '+students_code),a.each(students_code,function(q,r){var s=p.indexOf(r);if(-1!=s){var t=a('#list_students_attendance_1 tbody>tr:eq(\''+s+'\')'),u=t.find('td').eq(3).children('input');a('input[type=checkbox][value=\''+u.val()+'\']').prop('checked',!0)}})}function n(o,p){a('.div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id='+o+'&record_id='+p,function(q){a('#body_editor').html(''),a('#body_editor').append(q);var r=a('#list_grupal_seg_consult').clone().prop('id','list_grupal_seg_consult_1');a('#modal_v2_edit_groupal_tracking').find('form').find('h1').after(r),a('#list_grupal_seg_consult_1 > #list_students_attendance').prop('id','list_students_attendance_1'),a('#list_grupal_seg_consult_1  input[type=checkbox]').prop('checked',!1);var s=a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input');s.val()!=void 0&&m(s.val()),a('#permissions_informationr').html('');var t=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),u=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');(t||u)&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var v=JSON.parse(a('#permissions_information').text()),w=0;w<v.behaviors_permissions.length;w++){for(var C,y=v.behaviors_permissions[w].behaviors[0],A=y.behaviors_accessibility,B=0;B<A.length;B++)C=A[B].disabled,'true'==C?C=!0:'false'==C&&(C=!1),a('.dphpforms-record').find('#'+A[B].id).prop('disabled',C),a('.dphpforms-record').find('.'+A[B]['class']).prop('disabled',C);for(var D=y.behaviors_fields_to_remove,B=0;B<D.length;B++)a('.dphpforms-record').find('#'+D[B].id).remove(),a('.dphpforms-record').find('.'+D[B]['class']).remove();for(var E=y.limpiar_to_eliminate,B=0;B<E.length;B++)a('.dphpforms-record').find('.'+E[B]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('');var F=q.indexOf('primer_acercamiento_');-1!=F&&l('primer_acercamiento','update');var G=q.indexOf('seguimiento_de_pares_');-1!=G&&l('seguimiento_pares','update')})}a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var o=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(p){p&&(a(o).parent('.mymodal').fadeOut(300),console.log(a(this).parent('.mymodal')))})}),a(document).ready(function(){a('.seg_geo_origen').find('input').prop('disabled',!0)}),a(document).on('change',a('.seg_geo_vive_zona_riesgo').find('label').find('input'),function(){a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1))}),a('.seg_geo_vive_zona_riesgo').find('label').find('input').change(function(){a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1))}),a('#button_actualizar_primer_acercamiento').click(function(){a('.div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id='+a(this).attr('data-record-id'),function(o){a('#primer_acercamiento_form').html(''),a('#primer_acercamiento_form').append(o),a('#modal_primer_acercamiento').fadeIn(300);var p=a('#modal_primer_acercamiento').find('.pa_id_creado_por').find('input').val();a.get('../managers/user_management/api_user.php?function=get_user_information&arg='+p,function(q){var r=q.firstname+' '+q.lastname;a('#modal_primer_acercamiento').find('h1').after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+r+'</strong></h3>');var s=a('.dphpforms-record .btn-dphpforms-univalle').length;2==s?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==s&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})})})}),a('#button_update_geographic_track').click(function(){a('.div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=seguimiento_geografico&record_id='+a(this).attr('data-record-id'),function(o){a('#seguimiento_geografico_form').html(''),a('#seguimiento_geografico_form').append(o),a('#modal_seguimiento_geografico').fadeIn(300),a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1));var p=a('.dphpforms-record .btn-dphpforms-univalle').length;2==p&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}),3==p&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})})});a('.btn.btn-danger.btn-univalle.btn-card').click(function(){var o=a(this).attr('data-container'),p=a('#'+o).height();if(0==p)a(this).find('span').removeClass('glyphicon-chevron-left'),a(this).find('span').addClass('glyphicon-chevron-down');else{for(;0>p;)p=a('#'+o).height();a(this).find('span').removeClass('glyphicon-chevron-down'),a(this).find('span').addClass('glyphicon-chevron-left')}}),a('#button_add_v2_track').on('click',function(){a('.div').removeClass('regla_incumplida'),a('#modal_v2_peer_tracking').fadeIn(300),a('.id_estudiante').find('input').val(g());var o=a('#current_user_id').val();a('.id_creado_por').find('input').val(o),a('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('.dphpforms-response').width()/2-a('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('.dphpforms-response .btn-dphpforms-close').outerWidth()/2+'px'})}),a('#button_add_groupal_track').on('click',function(){a('#modal_v2_groupal_tracking').fadeIn(300);var o=a('#current_user_id').val();a('.id_creado_por').find('input').val(o),a('.id_estudiante').find('input').val('-'),a('#list_grupal_seg_consult  input[type=checkbox]').prop('checked',!1)}),a('#button_primer_acercamiento').on('click',function(){a('.div').removeClass('regla_incumplida'),a('#modal_primer_acercamiento').fadeIn(300),a('.primer_acerca_id_estudiante_field').find('input').val(g());var o=a('#current_user_id').val();a('.primer_acerca_id_creado_por_field').find('input').val(o),a('#primer_acercamiento_form').find('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('#primer_acercamiento_form').find('.dphpforms-response').width()/2-a('#primer_acercamiento_form').find('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('#primer_acercamiento_form').find('.btn-dphpforms-close').outerWidth()/2+'px'})}),a('#button_add_geographic_track').on('click',function(){a('.div').removeClass('regla_incumplida'),a('#modal_seguimiento_geografico').fadeIn(300),a('.seg_geo_id_estudiante').find('input').val(g());var o=a('#current_user_id').val();a('.seg_geo_id_creado_por').find('input').val(o),a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1)),a('#seguimiento_geografico_form').find('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('#seguimiento_geografico_form').find('.dphpforms-response').width()/2-a('#seguimiento_geografico_form').find('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('#seguimiento_geografico_form').find('.btn-dphpforms-close').outerWidth()/2+'px'})}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300),a('#list_grupal_seg_consult_1').remove()}),a('.dphpforms-peer-record').on('click',function(){var o=a(this).attr('data-record-id');n('seguimiento_pares',o),a('#modal_v2_edit_peer_tracking').fadeIn(300)}),a('.dphpforms-groupal-record').on('click',function(){var o=a(this).attr('data-record-id');n('seguimiento_grupal',o),a('#modal_v2_edit_groupal_tracking').fadeIn(300)}),a('.limpiar').click(function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('click','.limpiar',function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('submit','.dphpforms',function(o){o.preventDefault();var p=a(this).attr('id').indexOf('seguimiento_geografico_'),q=a(this).attr('id').indexOf('seguimiento_grupal_');-1!=p&&l('seguimiento_geografico_','insert'),-1!=q&&(a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),l('seguimiento_grupal_','insert')),a('.seg_geo_origen').find('input').prop('disabled',!1),a(':disabled').prop('disabled',!1);var r=new FormData(this),s=a(this),t=s.attr('action');'procesador.php'==s.attr('action')&&(t='../managers/dphpforms/procesador.php'),a(s).find('button').prop('disabled',!0),a(s).find('a').attr('disabled',!0),console.log(s),a.ajax({type:'POST',url:t,data:r,cache:!1,contentType:!1,processData:!1,success:function success(u){console.log(u);var v=JSON.parse(u);if(0==v.status){var w='';'Stored'==v.message?w='Almacenado':'Updated'==v.message&&(w='Actualizado'),j(),h(),swal({title:'Informaci\xF3n',text:w,type:'success'},function(){'Updated'==v.message?(a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3),location.reload()):(a('.dphpforms-response').trigger('reset'),location.reload())}),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300),a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+g(),function(B){console.log(B)}),a(s).find('button').prop('disabled',!1),a(s).find('a').attr('disabled',!1)}else if(-2==v.status){a(s).find('button').prop('disabled',!1),a(s).find('a').attr('disabled',!1);var w='';if('Without changes'==v.message)w='No hay cambios que registrar',a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300);else if('Unfulfilled rules'==v.message){var y=v.data.id_form_pregunta_a,A=v.data.id_form_pregunta_b;a('div').removeClass('regla_incumplida'),a('.div-'+y).addClass('regla_incumplida'),a('.div-'+A).addClass('regla_incumplida'),w='Ups, revise los campos que se acaban de colorear en rojo.'}swal('Alerta',w,'warning')}else-1==v.status&&(console.log(u),swal('ERROR!','Oops!, informe de este error','error'))},error:function error(u){console.log(u),swal('Error!','Oops!, informe de este error','error'),a(s).find('button').prop('disabled',!1),a(s).find('a').attr('disabled',!1)}})}),a(document).on('click','.btn-dphpforms-delete-record',function(){swal({title:'Confirmaci\xF3n',text:'Est\xE1 eliminando este registro, \xBFdesea continuar?',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, Eliminar!'},function(o){if(o){var p=a('.btn-dphpforms-delete-record').attr('data-record-id');a.get('../managers/dphpforms/dphpforms_delete_record.php?record_id='+p,function(q){var r=q;0==r.status?swal({title:'Informaci\xF3n',text:'Eliminado',type:'success'},function(){a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),location.reload()}):-1==r.status&&swal('Error!',r.message,'error')})}})})}}});